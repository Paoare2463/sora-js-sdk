{"version":3,"file":"sora.min.js","sources":["../packages/e2ee/dist/sora_e2ee.mjs","../packages/go-wasm/src/wasm_exec.js","../node_modules/fflate/esm/browser.js","../packages/sdk/src/utils.ts","../packages/sdk/src/base.ts","../packages/sdk/src/publisher.ts","../packages/sdk/src/subscriber.ts","../packages/sdk/src/sora.ts","../packages/sdk/src/helpers.ts"],"sourcesContent":["/**\n * @sora/e2ee\n * WebRTC SFU Sora JavaScript E2EE Library\n * @version: 2021.1.0\n * @author: Shiguredo Inc.\n * @license: Apache-2.0\n **/\n\nimport WasmExec from '@sora/go-wasm';\n\nconst WORKER_SCRIPT = \"InVzZSBzdHJpY3QiOwovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi8KY29uc3QgY29ubmVjdGlvbklkTGVuZ3RoID0gMjY7CmZ1bmN0aW9uIGJ5dGVDb3VudChuKSB7CiAgICBpZiAobiA9PSAwKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICAvLyBsb2cyNTYoeCkgPSBsb2coeCkgLyBsb2coMjU2KQogICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5sb2cobikgLyBNYXRoLmxvZygyICoqIDgpICsgMSk7Cn0KZnVuY3Rpb24gYXJyYXlCdWZmZXJUb051bWJlcihhcnJheUJ1ZmZlcikgewogICAgLy8gMzJiaXQg44G+44Gn44KS5oOz5a6aIChCaWdJbnQg44G444Gu5pu444GN5o+b44GI5pmC44Gr6KaB5L+u5q2jKQogICAgY29uc3QgbmV3QXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgY29uc3QgbmV3RGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcobmV3QXJyYXlCdWZmZXIpOwogICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyYXlCdWZmZXIpOwogICAgY29uc3QgcGFkZGluZ0xlbmd0aCA9IFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UIC0gZGF0YVZpZXcuYnl0ZUxlbmd0aDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFkZGluZ0xlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgbmV3RGF0YVZpZXcuc2V0VWludDgoaSwgMCk7CiAgICB9CiAgICBmb3IgKGxldCBpID0gcGFkZGluZ0xlbmd0aCwgaiA9IDA7IGkgPCBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDsgaSArPSAxLCBqICs9IDEpIHsKICAgICAgICBuZXdEYXRhVmlldy5zZXRVaW50OChpLCBkYXRhVmlldy5nZXRVaW50OChqKSk7CiAgICB9CiAgICByZXR1cm4gbmV3RGF0YVZpZXcuZ2V0VWludDMyKDApOwp9CmZ1bmN0aW9uIGVuY29kZVNGcmFtZUhlYWRlcihzLCBjb3VudCwga2V5SWQpIHsKICAgIC8vICAwIDEgMiAzIDQgNSA2IDcKICAgIC8vICstKy0rLSstKy0rLSstKy0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICAgIC8vIHxTfExFTiAgfDF8S0xFTiB8ICAgS0lELi4uIChsZW5ndGg9S0xFTikgICAgfCAgICBDVFIuLi4gKGxlbmd0aD1MRU4pICAgIHwKICAgIC8vICstKy0rLSstKy0rLSstKy0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKICAgIC8vIFM6IDEgYml0CiAgICAvLyBMRU46IDMgYml0CiAgICAvLyBYOiAxIGJpdAogICAgLy8gS0xFTjogMyBiaXQKICAgIC8vIEtJRDogS0xFTiBieXRlCiAgICAvLyBDVFI6IExFTiBieXRlCiAgICAvLyBUT0RPOiBrZXlJZCAoS0lEKSDjgYwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsIDcgYnl0ZSDjgpLotoXjgYjjgabjgYTjgZ/loLTlkIjjga/jgqjjg6njg7zjgYvkvovlpJYKICAgIC8vIFRPRE86IGNvdW50IChDVFIpIOOBjCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgNyBieXRlIOOCkui2heOBiOOBpuOBhOOBn+WgtOWQiOOBr+OCqOODqeODvOOBi+S+i+WklgogICAgaWYgKG1heEtleUlkIDwga2V5SWQgfHwgbWF4Q291bnQgPCBjb3VudCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRVhDRUVERUQtTUFYSU1VTS1CUk9BRENBU1RJTkctVElNRSIpOwogICAgfQogICAgY29uc3Qga2xlbiA9IGJ5dGVDb3VudChrZXlJZCk7CiAgICBjb25zdCBsZW4gPSBieXRlQ291bnQoY291bnQpOwogICAgY29uc3QgaGVhZGVyQnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDEgKyBrbGVuICsgbGVuKTsKICAgIGNvbnN0IGhlYWRlckRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGhlYWRlckJ1ZmZlcik7CiAgICAvLyBTLCBMRU4sIDEsIEtMRU4g44GnIDEgYnl0ZQogICAgaGVhZGVyRGF0YVZpZXcuc2V0VWludDgoMCwgKHMgPDwgNykgKyAobGVuIDw8IDQpICsgKDEgPDwgMykgKyBrbGVuKTsKICAgIGNvbnN0IGhlYWRlclVpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheShoZWFkZXJCdWZmZXIpOwogICAgY29uc3Qga2V5SWRCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpOwogICAgY29uc3Qga2V5SWREYXRhVmlldyA9IG5ldyBEYXRhVmlldyhrZXlJZEJ1ZmZlcik7CiAgICBrZXlJZERhdGFWaWV3LnNldFVpbnQzMigwLCBrZXlJZCk7CiAgICBjb25zdCBrZXlJZFVpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheShrZXlJZEJ1ZmZlcik7CiAgICBoZWFkZXJVaW50OEFycmF5LnNldChrZXlJZFVpbnQ4QXJyYXkuc3ViYXJyYXkoVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgLSBrbGVuKSwgMSk7CiAgICBjb25zdCBjb3VudEJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCk7CiAgICBjb25zdCBjb3VudERhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGNvdW50QnVmZmVyKTsKICAgIGNvdW50RGF0YVZpZXcuc2V0VWludDMyKDAsIGNvdW50KTsKICAgIGNvbnN0IGNvdW50VWludDhBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvdW50QnVmZmVyKTsKICAgIGhlYWRlclVpbnQ4QXJyYXkuc2V0KGNvdW50VWludDhBcnJheS5zdWJhcnJheShVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAtIGxlbiksIGtsZW4gKyAxKTsKICAgIHJldHVybiBoZWFkZXJVaW50OEFycmF5Owp9CmZ1bmN0aW9uIHNwbGl0SGVhZGVyKHNmcmFtZSkgewogICAgY29uc3Qgc2ZyYW1lRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoc2ZyYW1lKTsKICAgIGNvbnN0IGhlYWRlciA9IHNmcmFtZURhdGFWaWV3LmdldFVpbnQ4KDApOwogICAgY29uc3QgbGVuID0gKGhlYWRlciAmIDB4NzApID4+IDQ7CiAgICBjb25zdCBrbGVuID0gaGVhZGVyICYgMHgwNzsKICAgIGNvbnN0IHNmcmFtZUhlYWRlckxlbmd0aCA9IDEgKyBrbGVuICsgbGVuOwogICAgY29uc3Qgc2ZyYW1lSGVhZGVyID0gc2ZyYW1lLnNsaWNlKDAsIHNmcmFtZUhlYWRlckxlbmd0aCk7CiAgICBpZiAoc2ZyYW1lSGVhZGVyLmJ5dGVMZW5ndGggPCBzZnJhbWVIZWFkZXJMZW5ndGgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtU0ZSQU1FLUxFTkdUSCIpOwogICAgfQogICAgY29uc3QgY29ubmVjdGlvbklkID0gc2ZyYW1lLnNsaWNlKHNmcmFtZUhlYWRlckxlbmd0aCwgc2ZyYW1lSGVhZGVyTGVuZ3RoICsgY29ubmVjdGlvbklkTGVuZ3RoKTsKICAgIGNvbnN0IGVuY3J5cHRlZEZyYW1lID0gc2ZyYW1lLnNsaWNlKHNmcmFtZUhlYWRlckxlbmd0aCArIGNvbm5lY3Rpb25JZExlbmd0aCwgc2ZyYW1lLmJ5dGVMZW5ndGgpOwogICAgcmV0dXJuIFtzZnJhbWVIZWFkZXIsIGNvbm5lY3Rpb25JZCwgZW5jcnlwdGVkRnJhbWVdOwp9CmZ1bmN0aW9uIHBhcnNlU0ZyYW1lSGVhZGVyKHNmcmFtZUhlYWRlcikgewogICAgY29uc3Qgc2ZyYW1lSGVhZGVyRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoc2ZyYW1lSGVhZGVyKTsKICAgIGNvbnN0IGhlYWRlciA9IHNmcmFtZUhlYWRlckRhdGFWaWV3LmdldFVpbnQ4KDApOwogICAgY29uc3QgcyA9IChoZWFkZXIgJiAweDgwKSA+PiA3OwogICAgY29uc3QgbGVuID0gKGhlYWRlciAmIDB4NzApID4+IDQ7CiAgICBjb25zdCB4ID0gKGhlYWRlciAmIDB4MDgpID4+IDM7CiAgICBjb25zdCBrbGVuID0gaGVhZGVyICYgMHgwNzsKICAgIC8vIHggZmxhZwogICAgaWYgKHggIT09IDEpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtWC1GTEFHIik7CiAgICB9CiAgICBjb25zdCBoZWFkZXJMZW5ndGggPSAxICsga2xlbiArIGxlbjsKICAgIGlmIChzZnJhbWVIZWFkZXJEYXRhVmlldy5ieXRlTGVuZ3RoIDwgaGVhZGVyTGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVTkVYUEVDVEVELVNGUkFNRS1IRUFERVItTEVOR1RIIik7CiAgICB9CiAgICBjb25zdCBrZXlJZEJ1ZmZlciA9IHNmcmFtZUhlYWRlci5zbGljZSgxLCAxICsga2xlbik7CiAgICBjb25zdCBrZXlJZCA9IGFycmF5QnVmZmVyVG9OdW1iZXIoa2V5SWRCdWZmZXIpOwogICAgY29uc3QgY291bnRCdWZmZXIgPSBzZnJhbWVIZWFkZXIuc2xpY2UoMSArIGtsZW4sIGhlYWRlckxlbmd0aCk7CiAgICBjb25zdCBjb3VudCA9IGFycmF5QnVmZmVyVG9OdW1iZXIoY291bnRCdWZmZXIpOwogICAgcmV0dXJuIFtzLCBjb3VudCwga2V5SWRdOwp9Ci8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC90cmlwbGUtc2xhc2gtcmVmZXJlbmNlLCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMgKi8KLy8vIDxyZWZlcmVuY2UgcGF0aD0iLi9zZnJhbWUudHMiLz4KLy8gVE9ETzog5omx44GG5pWw5YCk44GM5aSn44GN44GE566H5omA44Gn44GvIE51bWJlciDjgYvjgokgQmlnSW50IOOBq+e9ruOBjeaPm+OBiOOCiwovLyBUT0RPOiBCaWdJbnQg44Gr572u44GN5o+b44GI44KL6Zqb44Gr5aSJ5pu044GZ44KLCmNvbnN0IG1heEtleUlkID0gMiAqKiAzMjsKY29uc3QgbWF4Q291bnQgPSAyICoqIDMyOwpjb25zdCBzZWxmRGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwpjb25zdCBjb3VudE1hcCA9IG5ldyBNYXAoKTsKY29uc3Qgd3JpdGVJVk1hcCA9IG5ldyBNYXAoKTsKY29uc3QgcmVtb3RlRGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwpjb25zdCBsYXRlc3RSZW1vdGVLZXlJZE1hcCA9IG5ldyBNYXAoKTsKY29uc3QgbGl0dGxlRW5kaWFuID0gdHJ1ZTsKY29uc3QgYmlnRW5kaWFuID0gIWxpdHRsZUVuZGlhbjsKY29uc3QgdGV4dEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKY29uc3QgdGV4dERlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKLy8gVlA4IOOBruOBvwovLyBUT0RPKG5ha2FpKTogVlA5IC8gQVYxIOOCguWwhuadpeeahOOBq+WvvuW/nOOCguiAg+OBiOOCiwpjb25zdCB1bmVuY3J5cHRlZEJ5dGVzID0gewogICAgLy8gSSDjg5Xjg6zjg7zjg6AKICAgIGtleTogMTAsCiAgICAvLyDpnZ4gSSDjg5Xjg6zjg7zjg6AKICAgIGRlbHRhOiAzLAogICAgLy8g44Kq44O844OH44Kj44KqCiAgICB1bmRlZmluZWQ6IDEsCn07CmZ1bmN0aW9uIGdldENvdW50KGNvbm5lY3Rpb25JZCkgewogICAgcmV0dXJuIGNvdW50TWFwLmdldChjb25uZWN0aW9uSWQpIHx8IDA7Cn0KZnVuY3Rpb24gc2V0Q291bnQoY29ubmVjdGlvbklkLCBjb3VudCkgewogICAgcmV0dXJuIGNvdW50TWFwLnNldChjb25uZWN0aW9uSWQsIGNvdW50KTsKfQpmdW5jdGlvbiBnZXRSZW1vdGVEZXJpdmVLZXkoY29ubmVjdGlvbklkLCBrZXlJZCkgewogICAgaWYgKCFyZW1vdGVEZXJpdmVLZXlNYXAuaGFzKGNvbm5lY3Rpb25JZCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJFTU9URS1ERVJJVkVLRVktTUFQLU5PVC1GT1VORCIpOwogICAgfQogICAgY29uc3QgZGVyaXZlS2V5TWFwID0gcmVtb3RlRGVyaXZlS2V5TWFwLmdldChjb25uZWN0aW9uSWQpOwogICAgaWYgKCFkZXJpdmVLZXlNYXApIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICByZXR1cm4gZGVyaXZlS2V5TWFwLmdldChrZXlJZCk7Cn0KZnVuY3Rpb24gc2V0UmVtb3RlRGVyaXZlS2V5KGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSkgewogICAgbGV0IGRlcml2ZUtleU1hcCA9IHJlbW90ZURlcml2ZUtleU1hcC5nZXQoY29ubmVjdGlvbklkKTsKICAgIGlmICghZGVyaXZlS2V5TWFwKSB7CiAgICAgICAgZGVyaXZlS2V5TWFwID0gbmV3IE1hcCgpOwogICAgfQogICAgZGVyaXZlS2V5TWFwLnNldChrZXlJZCwgZGVyaXZlS2V5KTsKICAgIHJlbW90ZURlcml2ZUtleU1hcC5zZXQoY29ubmVjdGlvbklkLCBkZXJpdmVLZXlNYXApOwp9CmZ1bmN0aW9uIHNldExhdGVzdFJlbW90ZUtleUlkKGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIGNvbnN0IGxhdGVzdFJlbW90ZUtleUlkID0gbGF0ZXN0UmVtb3RlS2V5SWRNYXAuZ2V0KGNvbm5lY3Rpb25JZCk7CiAgICBpZiAobGF0ZXN0UmVtb3RlS2V5SWQpIHsKICAgICAgICBpZiAobGF0ZXN0UmVtb3RlS2V5SWQgPCBrZXlJZCkgewogICAgICAgICAgICBsYXRlc3RSZW1vdGVLZXlJZE1hcC5zZXQoY29ubmVjdGlvbklkLCBrZXlJZCk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgbGF0ZXN0UmVtb3RlS2V5SWRNYXAuc2V0KGNvbm5lY3Rpb25JZCwga2V5SWQpOwogICAgfQp9CmZ1bmN0aW9uIHJlbW92ZU9sZFJlbW90ZURlcml2ZUtleXMoKSB7CiAgICBsYXRlc3RSZW1vdGVLZXlJZE1hcC5mb3JFYWNoKChsYXRlc3RLZXlJZCwgY29ubmVjdGlvbklkKSA9PiB7CiAgICAgICAgY29uc3QgZGVyaXZlS2V5TWFwID0gcmVtb3RlRGVyaXZlS2V5TWFwLmdldChjb25uZWN0aW9uSWQpOwogICAgICAgIGlmIChkZXJpdmVLZXlNYXApIHsKICAgICAgICAgICAgZGVyaXZlS2V5TWFwLmZvckVhY2goKF8sIGtleUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobGF0ZXN0S2V5SWQgIT09IGtleUlkKSB7CiAgICAgICAgICAgICAgICAgICAgZGVyaXZlS2V5TWFwLmRlbGV0ZShrZXlJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwp9CmZ1bmN0aW9uIHJlbW92ZURlcml2ZUtleShjb25uZWN0aW9uSWQpIHsKICAgIGxhdGVzdFJlbW90ZUtleUlkTWFwLmRlbGV0ZShjb25uZWN0aW9uSWQpOwogICAgcmVtb3RlRGVyaXZlS2V5TWFwLmRlbGV0ZShjb25uZWN0aW9uSWQpOwp9CmZ1bmN0aW9uIGdldExhdGVzdFNlbGZEZXJpdmVLZXkoKSB7CiAgICBjb25zdCBkZXJpdmVLZXkgPSBzZWxmRGVyaXZlS2V5TWFwLmdldCgibGF0ZXN0Iik7CiAgICBpZiAoIWRlcml2ZUtleSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiTEFURVNULVNFTEYtREVSSVZFS0VZLU5PVF9GT1VORCIpOwogICAgfQogICAgcmV0dXJuIGRlcml2ZUtleTsKfQpmdW5jdGlvbiBzZXRTZWxmRGVyaXZlS2V5KGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSkgewogICAgY29uc3QgY3VycmVudFNlbGZEZXJpdmVLZXkgPSBzZWxmRGVyaXZlS2V5TWFwLmdldCgibGF0ZXN0Iik7CiAgICBpZiAoY3VycmVudFNlbGZEZXJpdmVLZXkpIHsKICAgICAgICBpZiAoY3VycmVudFNlbGZEZXJpdmVLZXlbImtleUlkIl0gPCBrZXlJZCkgewogICAgICAgICAgICBjb25zdCBuZXh0U2VsZkRlcml2ZUtleSA9IHsgY29ubmVjdGlvbklkLCBrZXlJZCwgZGVyaXZlS2V5IH07CiAgICAgICAgICAgIHNlbGZEZXJpdmVLZXlNYXAuc2V0KCJsYXRlc3QiLCBuZXh0U2VsZkRlcml2ZUtleSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgY29uc3QgbmV4dFNlbGZEZXJpdmVLZXkgPSB7IGNvbm5lY3Rpb25JZCwga2V5SWQsIGRlcml2ZUtleSB9OwogICAgICAgIHNlbGZEZXJpdmVLZXlNYXAuc2V0KCJsYXRlc3QiLCBuZXh0U2VsZkRlcml2ZUtleSk7CiAgICB9Cn0KZnVuY3Rpb24gc2lsZW5jZUZyYW1lKGVuY29kZWRGcmFtZSkgewogICAgLy8gY29ubmVjdGlvbi5jcmVhdGVkLCByZWNlaXZlTWVzc2FnZSDlj5fkv6HliY3jga7loLTlkIgKICAgIGlmIChlbmNvZGVkRnJhbWUudHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8g6Z+z5aOw44Gv5pqX5Y+35YyW44Gv44GE44KL44Go6IGe44GR44Gf44KC44Gu44GY44KD44Gq44GE44Gu44Gn572u44GN5o+b44GI44KLCiAgICAgICAgY29uc3QgbmV3RGF0YSA9IG5ldyBBcnJheUJ1ZmZlcigzKTsKICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgIC8vIE9wdXMg44K144Kk44Os44Oz44K544OV44Os44O844OgCiAgICAgICAgbmV3VWludDguc2V0KFsweGQ4LCAweGZmLCAweGZlXSk7CiAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgLy8g5pig5YOP44GM5q2j5bi444GY44KD44Gq44GE44Gf44KBIFBMSSDjgrnjg4jjg7zjg6DjgYznmbrnlJ/jgZfjgabjgZfjgb7jgYYKICAgICAgICAvLyDjgZ3jga7jgZ/jgoEgMzIweDI0MCDjga7nnJ/jgaPpu5LjgarnlLvpnaLjgavnva7jgY3mj5vjgYjjgosKICAgICAgICBjb25zdCBuZXdEYXRhID0gbmV3IEFycmF5QnVmZmVyKDYwKTsKICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgIC8vIHByZXR0aWVyLWlnbm9yZQogICAgICAgIG5ld1VpbnQ4LnNldChbMHhiMCwgMHgwNSwgMHgwMCwgMHg5ZCwgMHgwMSwgMHgyYSwgMHhhMCwgMHgwMCwgMHg1YSwgMHgwMCwKICAgICAgICAgICAgMHgzOSwgMHgwMywgMHgwMCwgMHgwMCwgMHgxYywgMHgyMiwgMHgxNiwgMHgxNiwgMHgyMiwgMHg2NiwKICAgICAgICAgICAgMHgxMiwgMHgyMCwgMHgwNCwgMHg5MCwgMHg0MCwgMHgwMCwgMHhjNSwgMHgwMSwgMHhlMCwgMHg3YywKICAgICAgICAgICAgMHg0ZCwgMHgyZiwgMHhmYSwgMHhkZCwgMHg0ZCwgMHhhNSwgMHg3ZiwgMHg4OSwgMHhhNSwgMHhmZiwKICAgICAgICAgICAgMHg1YiwgMHhhOSwgMHhiNCwgMHhhZiwgMHhmMSwgMHgzNCwgMHhiZiwgMHhlYiwgMHg3NSwgMHgzNiwKICAgICAgICAgICAgMHg5NSwgMHhmZSwgMHgyNiwgMHg5NiwgMHg2MCwgMHhmZSwgMHhmZiwgMHhiYSwgMHhmZiwgMHg0MCwKICAgICAgICBdKTsKICAgICAgICBlbmNvZGVkRnJhbWUuZGF0YSA9IG5ld0RhdGE7CiAgICB9CiAgICByZXR1cm4gZW5jb2RlZEZyYW1lOwp9CmZ1bmN0aW9uIHNldFdyaXRlSVYoY29ubmVjdGlvbklkLCBrZXlJZCwgd3JpdGVJVikgewogICAgY29uc3Qga2V5ID0gW2Nvbm5lY3Rpb25JZCwga2V5SWQudG9TdHJpbmcoKV0uam9pbigiOiIpOwogICAgd3JpdGVJVk1hcC5zZXQoa2V5LCB3cml0ZUlWKTsKfQpmdW5jdGlvbiBnZXRXcml0ZUlWKGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIGNvbnN0IGtleSA9IFtjb25uZWN0aW9uSWQsIGtleUlkLnRvU3RyaW5nKCldLmpvaW4oIjoiKTsKICAgIHJldHVybiB3cml0ZUlWTWFwLmdldChrZXkpOwp9CmZ1bmN0aW9uIGdlbmVyYXRlSVYoY291bnQsIGNvbm5lY3Rpb25JZCwga2V5SWQpIHsKICAgIC8vIFRPRE86IGtleUlkIOOBjCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgNyBieXRlIOOCkui2heOBiOOBpuOBhOOBn+WgtOWQiOOBr+OCqOODqeODvOOBi+S+i+WklgogICAgLy8gVE9ETzogY291bnQg44GMIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLCA3IGJ5dGUg44KS6LaF44GI44Gm44GE44Gf5aC05ZCI44Gv44Ko44Op44O844GL5L6L5aSWCiAgICAvLyAzMiBiaXQg44G+44GnCiAgICBpZiAobWF4S2V5SWQgPCBrZXlJZCB8fCBtYXhDb3VudCA8IGNvdW50KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFWENFRURFRC1NQVhJTVVNLUJST0FEQ0FTVElORy1USU1FIik7CiAgICB9CiAgICBjb25zdCB3cml0ZUlWID0gZ2V0V3JpdGVJVihjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgIGlmICghd3JpdGVJVikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiV1JJVEVJVi1OT1QtRk9VTkQiKTsKICAgIH0KICAgIGNvbnN0IHBhZGRpbmdMZW5ndGggPSBObiAtIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwogICAgY29uc3QgY291bnRXaXRoUGFkZGluZ0J1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihObik7CiAgICBjb25zdCBjb3VudFdpdGhQYWRkaW5nRGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoY291bnRXaXRoUGFkZGluZ0J1ZmZlcik7CiAgICBjb3VudFdpdGhQYWRkaW5nRGF0YVZpZXcuc2V0VWludDMyKHBhZGRpbmdMZW5ndGgsIGNvdW50LCBiaWdFbmRpYW4pOwogICAgY29uc3QgaXYgPSBuZXcgVWludDhBcnJheShObik7CiAgICBjb25zdCBjb3VudFdpdGhQYWRkaW5nID0gbmV3IFVpbnQ4QXJyYXkoY291bnRXaXRoUGFkZGluZ0J1ZmZlcik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5uOyBpKyspIHsKICAgICAgICBpdltpXSA9IHdyaXRlSVZbaV0gXiBjb3VudFdpdGhQYWRkaW5nW2ldOwogICAgfQogICAgcmV0dXJuIGl2Owp9CmZ1bmN0aW9uIHBhcnNlUGF5bG9hZChwYXlsb2FkVHlwZSwgcGF5bG9hZCkgewogICAgcmV0dXJuIFsKICAgICAgICBuZXcgVWludDhBcnJheShwYXlsb2FkLCAwLCB1bmVuY3J5cHRlZEJ5dGVzW3BheWxvYWRUeXBlXSksCiAgICAgICAgbmV3IFVpbnQ4QXJyYXkocGF5bG9hZCwgdW5lbmNyeXB0ZWRCeXRlc1twYXlsb2FkVHlwZV0pLAogICAgXTsKfQpmdW5jdGlvbiBlbmNvZGVGcmFtZUFkZChoZWFkZXIsIHNmcmFtZUhlYWRlciwgY29ubmVjdGlvbklkKSB7CiAgICBjb25zdCBjb25uZWN0aW9uSWREYXRhID0gdGV4dEVuY29kZXIuZW5jb2RlKGNvbm5lY3Rpb25JZCk7CiAgICBjb25zdCBmcmFtZUFkZCA9IG5ldyBVaW50OEFycmF5KGhlYWRlci5ieXRlTGVuZ3RoICsgc2ZyYW1lSGVhZGVyLmJ5dGVMZW5ndGggKyBjb25uZWN0aW9uSWREYXRhLmJ5dGVMZW5ndGgpOwogICAgZnJhbWVBZGQuc2V0KGhlYWRlciwgMCk7CiAgICBmcmFtZUFkZC5zZXQoc2ZyYW1lSGVhZGVyLCBoZWFkZXIuYnl0ZUxlbmd0aCk7CiAgICBmcmFtZUFkZC5zZXQoY29ubmVjdGlvbklkRGF0YSwgaGVhZGVyLmJ5dGVMZW5ndGggKyBzZnJhbWVIZWFkZXIuYnl0ZUxlbmd0aCk7CiAgICByZXR1cm4gZnJhbWVBZGQ7Cn0KYXN5bmMgZnVuY3Rpb24gZW5jcnlwdEZ1bmN0aW9uKGVuY29kZWRGcmFtZSwgY29udHJvbGxlcikgewogICAgY29uc3QgeyBjb25uZWN0aW9uSWQsIGtleUlkLCBkZXJpdmVLZXkgfSA9IGdldExhdGVzdFNlbGZEZXJpdmVLZXkoKTsKICAgIGlmICghZGVyaXZlS2V5KSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY3VycmVudENvdW50ID0gZ2V0Q291bnQoY29ubmVjdGlvbklkKTsKICAgIC8vIGNvdW50IOOBjCAzMiBiaXQg5Lul5LiK44Gu5aC05ZCI44Gv5YGc5q2i44GZ44KLCiAgICBpZiAoY3VycmVudENvdW50ID4gbWF4Q291bnQpIHsKICAgICAgICBwb3N0TWVzc2FnZSh7IHR5cGU6ICJkaXNjb25uZWN0IiB9KTsKICAgIH0KICAgIGNvbnN0IGl2ID0gZ2VuZXJhdGVJVihjdXJyZW50Q291bnQsIGNvbm5lY3Rpb25JZCwga2V5SWQpOwogICAgaWYgKCFpdikgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtoZWFkZXIsIHBheWxvYWRdID0gcGFyc2VQYXlsb2FkKGVuY29kZWRGcmFtZS50eXBlLCBlbmNvZGVkRnJhbWUuZGF0YSk7CiAgICBjb25zdCBzZnJhbWVIZWFkZXIgPSBlbmNvZGVTRnJhbWVIZWFkZXIoMCwgY3VycmVudENvdW50LCBrZXlJZCk7CiAgICBjb25zdCBmcmFtZUFkZCA9IGVuY29kZUZyYW1lQWRkKGhlYWRlciwgc2ZyYW1lSGVhZGVyLCBjb25uZWN0aW9uSWQpOwogICAgY3J5cHRvLnN1YnRsZQogICAgICAgIC5lbmNyeXB0KHsKICAgICAgICBuYW1lOiAiQUVTLUdDTSIsCiAgICAgICAgaXY6IGl2LAogICAgICAgIC8vIOaal+WPt+WMluOBleOCjOOBpuOBhOOBquOBhOmDqOWIhgogICAgICAgIGFkZGl0aW9uYWxEYXRhOiBmcmFtZUFkZCwKICAgIH0sIGRlcml2ZUtleSwgcGF5bG9hZCkKICAgICAgICAudGhlbigoY2lwaGVyVGV4dCkgPT4gewogICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgQXJyYXlCdWZmZXIoZnJhbWVBZGQuYnl0ZUxlbmd0aCArIGNpcGhlclRleHQuYnl0ZUxlbmd0aCk7CiAgICAgICAgY29uc3QgbmV3RGF0YVVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkobmV3RGF0YSk7CiAgICAgICAgbmV3RGF0YVVpbnQ4LnNldChmcmFtZUFkZCwgMCk7CiAgICAgICAgbmV3RGF0YVVpbnQ4LnNldChuZXcgVWludDhBcnJheShjaXBoZXJUZXh0KSwgZnJhbWVBZGQuYnl0ZUxlbmd0aCk7CiAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVkRnJhbWUpOwogICAgfSk7CiAgICBzZXRDb3VudChjb25uZWN0aW9uSWQsIGN1cnJlbnRDb3VudCArIDEpOwp9CmFzeW5jIGZ1bmN0aW9uIGRlY3J5cHRGdW5jdGlvbihlbmNvZGVkRnJhbWUsIGNvbnRyb2xsZXIpIHsKICAgIC8vIOepuuODleODrOODvOODoOWvvuW/nAogICAgaWYgKGVuY29kZWRGcmFtZS5kYXRhLmJ5dGVMZW5ndGggPCAxKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgICBjb25zdCBmcmFtZU1ldGFkYXRhQnVmZmVyID0gZW5jb2RlZEZyYW1lLmRhdGEuc2xpY2UoMCwgdW5lbmNyeXB0ZWRCeXRlc1tlbmNvZGVkRnJhbWUudHlwZV0pOwogICAgICAgIGNvbnN0IGZyYW1lTWV0YWRhdGEgPSBuZXcgVWludDhBcnJheShmcmFtZU1ldGFkYXRhQnVmZmVyKTsKICAgICAgICBjb25zdCBbc2ZyYW1lSGVhZGVyQnVmZmVyLCBjb25uZWN0aW9uSWRCdWZmZXIsIGVuY3J5cHRlZEZyYW1lQnVmZmVyXSA9IHNwbGl0SGVhZGVyKGVuY29kZWRGcmFtZS5kYXRhLnNsaWNlKHVuZW5jcnlwdGVkQnl0ZXNbZW5jb2RlZEZyYW1lLnR5cGVdKSk7CiAgICAgICAgY29uc3Qgc2ZyYW1lSGVhZGVyID0gbmV3IFVpbnQ4QXJyYXkoc2ZyYW1lSGVhZGVyQnVmZmVyKTsKICAgICAgICBjb25zdCBjb25uZWN0aW9uSWQgPSB0ZXh0RGVjb2Rlci5kZWNvZGUoY29ubmVjdGlvbklkQnVmZmVyKTsKICAgICAgICBjb25zdCBbcywgY291bnQsIGtleUlkXSA9IHBhcnNlU0ZyYW1lSGVhZGVyKHNmcmFtZUhlYWRlckJ1ZmZlcik7CiAgICAgICAgLy8g5LuK5Zue44GvIHMgZmxhZyDjga8gMCDjga7jgb8KICAgICAgICBpZiAocyAhPT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVORVhQRUNURUQtUy1GTEFHIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRlcml2ZUtleSA9IGdldFJlbW90ZURlcml2ZUtleShjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgICAgICBpZiAoIWRlcml2ZUtleSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGl2ID0gZ2VuZXJhdGVJVihjb3VudCwgY29ubmVjdGlvbklkLCBrZXlJZCk7CiAgICAgICAgaWYgKCFpdikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZyYW1lQWRkID0gZW5jb2RlRnJhbWVBZGQoZnJhbWVNZXRhZGF0YSwgc2ZyYW1lSGVhZGVyLCBjb25uZWN0aW9uSWQpOwogICAgICAgIGNyeXB0by5zdWJ0bGUKICAgICAgICAgICAgLmRlY3J5cHQoewogICAgICAgICAgICBuYW1lOiAiQUVTLUdDTSIsCiAgICAgICAgICAgIGl2OiBpdiwKICAgICAgICAgICAgYWRkaXRpb25hbERhdGE6IGZyYW1lQWRkLAogICAgICAgIH0sIGRlcml2ZUtleSwgbmV3IFVpbnQ4QXJyYXkoZW5jcnlwdGVkRnJhbWVCdWZmZXIpKQogICAgICAgICAgICAudGhlbigocGxhaW5UZXh0KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgQXJyYXlCdWZmZXIoZnJhbWVNZXRhZGF0YUJ1ZmZlci5ieXRlTGVuZ3RoICsgcGxhaW5UZXh0LmJ5dGVMZW5ndGgpOwogICAgICAgICAgICBjb25zdCBuZXdVaW50OCA9IG5ldyBVaW50OEFycmF5KG5ld0RhdGEpOwogICAgICAgICAgICBuZXdVaW50OC5zZXQobmV3IFVpbnQ4QXJyYXkoZnJhbWVNZXRhZGF0YUJ1ZmZlciwgMCwgdW5lbmNyeXB0ZWRCeXRlc1tlbmNvZGVkRnJhbWUudHlwZV0pKTsKICAgICAgICAgICAgbmV3VWludDguc2V0KG5ldyBVaW50OEFycmF5KHBsYWluVGV4dCksIHVuZW5jcnlwdGVkQnl0ZXNbZW5jb2RlZEZyYW1lLnR5cGVdKTsKICAgICAgICAgICAgZW5jb2RlZEZyYW1lLmRhdGEgPSBuZXdEYXRhOwogICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoZW5jb2RlZEZyYW1lKTsKICAgICAgICB9KTsKICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgICAgLy8g5oOz5a6a5aSW44Gu44OR44Kx44OD44OI44OV44Kp44O844Oe44OD44OI44KS5Y+X5L+h44GX44Gf5aC05ZCICiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHNpbGVuY2VGcmFtZShlbmNvZGVkRnJhbWUpKTsKICAgIH0KfQovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvdHJpcGxlLXNsYXNoLXJlZmVyZW5jZSAqLwovLy8gPHJlZmVyZW5jZSBwYXRoPSIuL2UyZWUudHMiLz4KLy8gbm9uY2Ug44K144Kk44K6CmNvbnN0IE5uID0gMTI7Ci8vIGtleSDjgrXjgqTjgroKY29uc3QgTmsgPSAxNjsKLy8ga2V5IOOCteOCpOOCuu+8iGJpdO+8iQpjb25zdCBrZXlMZW5ndGggPSBOayAqIDg7CmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRGVyaXZlS2V5KG1hdGVyaWFsKSB7CiAgICBjb25zdCBzYWx0ID0gdGV4dEVuY29kZXIuZW5jb2RlKCJTRnJhbWUxMCIpOwogICAgY29uc3QgaW5mbyA9IHRleHRFbmNvZGVyLmVuY29kZSgia2V5Iik7CiAgICBjb25zdCBkZXJpdmVLZXkgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRlcml2ZUtleSh7CiAgICAgICAgbmFtZTogIkhLREYiLAogICAgICAgIHNhbHQ6IHNhbHQsCiAgICAgICAgaGFzaDogIlNIQS0yNTYiLAogICAgICAgIGluZm86IGluZm8sCiAgICB9LCBtYXRlcmlhbCwgewogICAgICAgIG5hbWU6ICJBRVMtR0NNIiwKICAgICAgICBsZW5ndGg6IGtleUxlbmd0aCwKICAgIH0sIGZhbHNlLCBbImVuY3J5cHQiLCAiZGVjcnlwdCJdKTsKICAgIHJldHVybiBkZXJpdmVLZXk7Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXcml0ZUlWKG1hdGVyaWFsKSB7CiAgICBjb25zdCBzYWx0ID0gdGV4dEVuY29kZXIuZW5jb2RlKCJTRnJhbWUxMCIpOwogICAgY29uc3QgaW5mbyA9IHRleHRFbmNvZGVyLmVuY29kZSgic2FsdCIpOwogICAgY29uc3Qgd3JpdGVJVkJ1ZmZlciA9IGF3YWl0IGNyeXB0by5zdWJ0bGUuZGVyaXZlQml0cyh7CiAgICAgICAgbmFtZTogIkhLREYiLAogICAgICAgIHNhbHQ6IHNhbHQsCiAgICAgICAgaGFzaDogIlNIQS0zODQiLAogICAgICAgIGluZm86IGluZm8sCiAgICB9LCBtYXRlcmlhbCwgCiAgICAvLyBJViDjga8gOTYg44OT44OD44OI44Gq44Gu44GnCiAgICBObiAqIDgpOwogICAgY29uc3Qgd3JpdGVJViA9IG5ldyBVaW50OEFycmF5KHdyaXRlSVZCdWZmZXIpOwogICAgcmV0dXJuIHdyaXRlSVY7Cn0KbGV0IHJlbW92YWxUaW1lb3V0SWQgPSAwOwpvbm1lc3NhZ2UgPSAoZXZlbnQpID0+IHsKICAgIGNvbnN0IHsgdHlwZSB9ID0gZXZlbnQuZGF0YTsKICAgIGlmICh0eXBlID09PSAic2VsZlNlY3JldEtleU1hdGVyaWFsIikgewogICAgICAgIGNvbnN0IHsgc2VsZlNlY3JldEtleU1hdGVyaWFsLCBzZWxmQ29ubmVjdGlvbklkLCBzZWxmS2V5SWQsIHdhaXRpbmdUaW1lIH0gPSBldmVudC5kYXRhOwogICAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBjcnlwdG8uc3VidGxlCiAgICAgICAgICAgICAgICAuaW1wb3J0S2V5KCJyYXciLCBzZWxmU2VjcmV0S2V5TWF0ZXJpYWwuYnVmZmVyLCAiSEtERiIsIGZhbHNlLCBbImRlcml2ZUJpdHMiLCAiZGVyaXZlS2V5Il0pCiAgICAgICAgICAgICAgICAudGhlbigobWF0ZXJpYWwpID0+IHsKICAgICAgICAgICAgICAgIGdlbmVyYXRlRGVyaXZlS2V5KG1hdGVyaWFsKS50aGVuKChkZXJpdmVLZXkpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRTZWxmRGVyaXZlS2V5KHNlbGZDb25uZWN0aW9uSWQsIHNlbGZLZXlJZCwgZGVyaXZlS2V5KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZ2VuZXJhdGVXcml0ZUlWKG1hdGVyaWFsKS50aGVuKCh3cml0ZUlWKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2V0V3JpdGVJVihzZWxmQ29ubmVjdGlvbklkLCBzZWxmS2V5SWQsIHdyaXRlSVYpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwgd2FpdGluZ1RpbWUgfHwgMCk7CiAgICAgICAgLy8gVE9ETzogKzEwMDAg44Gn6Y2155Sf5oiQ5b6M44Gr5a6f6KGM44GV44KM44KL44KI44GG44Gr44GX44Gm44GE44KL44GM55+t44GE5aC05ZCI44Gv5Ly444Gw44GZCiAgICAgICAgY29uc3QgcmVtb3ZhbFdhaXRpbmdUaW1lID0gKHdhaXRpbmdUaW1lIHx8IDApICsgMTAwMDsKICAgICAgICBpZiAocmVtb3ZhbFRpbWVvdXRJZCkgewogICAgICAgICAgICAvLyDli5XkvZzmuIjjgb/jgr/jgqTjg57jg7zmnInjgooKICAgICAgICAgICAgaWYgKHdhaXRpbmdUaW1lKSB7CiAgICAgICAgICAgICAgICAvLyBjb25uZWN0aW9uLmRlc3Ryb3llZAogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHJlbW92YWxUaW1lb3V0SWQpOwogICAgICAgICAgICAgICAgcmVtb3ZhbFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJlbW92ZU9sZFJlbW90ZURlcml2ZUtleXMoKTsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVtb3ZhbFRpbWVvdXRJZCk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZhbFRpbWVvdXRJZCA9IDA7CiAgICAgICAgICAgICAgICB9LCByZW1vdmFsV2FpdGluZ1RpbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyDli5XkvZzmuIjjgb/jgr/jgqTjg57jg7zjgarjgZcKICAgICAgICAgICAgLy8gY29ubmVjdGlvbi5jcmVhdGVkIOOBruWgtOWQiOOCguWwkeOBl+Wun+ihjOOCkumBheOCieOBm+OCiwogICAgICAgICAgICByZW1vdmFsVGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICByZW1vdmVPbGRSZW1vdGVEZXJpdmVLZXlzKCk7CiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQocmVtb3ZhbFRpbWVvdXRJZCk7CiAgICAgICAgICAgICAgICByZW1vdmFsVGltZW91dElkID0gMDsKICAgICAgICAgICAgfSwgcmVtb3ZhbFdhaXRpbmdUaW1lKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09PSAicmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxzIikgewogICAgICAgIGNvbnN0IHsgcmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxzIH0gPSBldmVudC5kYXRhOwogICAgICAgIGZvciAoY29uc3QgW2Nvbm5lY3Rpb25JZCwgcmVtb3RlU2VjcmV0S2V5TWF0ZXJpYWxdIG9mIE9iamVjdC5lbnRyaWVzKHJlbW90ZVNlY3JldEtleU1hdGVyaWFscykpIHsKICAgICAgICAgICAgY29uc3QgeyBrZXlJZCwgc2VjcmV0S2V5TWF0ZXJpYWwgfSA9IHJlbW90ZVNlY3JldEtleU1hdGVyaWFsOwogICAgICAgICAgICBjcnlwdG8uc3VidGxlCiAgICAgICAgICAgICAgICAuaW1wb3J0S2V5KCJyYXciLCBzZWNyZXRLZXlNYXRlcmlhbC5idWZmZXIsICJIS0RGIiwgZmFsc2UsIFsiZGVyaXZlQml0cyIsICJkZXJpdmVLZXkiXSkKICAgICAgICAgICAgICAgIC50aGVuKChtYXRlcmlhbCkgPT4gewogICAgICAgICAgICAgICAgZ2VuZXJhdGVEZXJpdmVLZXkobWF0ZXJpYWwpLnRoZW4oKGRlcml2ZUtleSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNldFJlbW90ZURlcml2ZUtleShjb25uZWN0aW9uSWQsIGtleUlkLCBkZXJpdmVLZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZVdyaXRlSVYobWF0ZXJpYWwpLnRoZW4oKHdyaXRlSVYpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZXRXcml0ZUlWKGNvbm5lY3Rpb25JZCwga2V5SWQsIHdyaXRlSVYpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXRMYXRlc3RSZW1vdGVLZXlJZChjb25uZWN0aW9uSWQsIGtleUlkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAodHlwZSA9PT0gInJlbW92ZVJlbW90ZURlcml2ZUtleSIpIHsKICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb25JZCB9ID0gZXZlbnQuZGF0YTsKICAgICAgICByZW1vdmVEZXJpdmVLZXkoY29ubmVjdGlvbklkKTsKICAgIH0KICAgIGVsc2UgaWYgKHR5cGUgPT09ICJlbmNyeXB0IikgewogICAgICAgIGNvbnN0IHsgcmVhZGFibGVTdHJlYW0sIHdyaXRhYmxlU3RyZWFtIH0gPSBldmVudC5kYXRhOwogICAgICAgIGNvbnN0IHRyYW5zZm9ybVN0cmVhbSA9IG5ldyBUcmFuc2Zvcm1TdHJlYW0oewogICAgICAgICAgICB0cmFuc2Zvcm06IGVuY3J5cHRGdW5jdGlvbiwKICAgICAgICB9KTsKICAgICAgICByZWFkYWJsZVN0cmVhbS5waXBlVGhyb3VnaCh0cmFuc2Zvcm1TdHJlYW0pLnBpcGVUbyh3cml0YWJsZVN0cmVhbSk7CiAgICB9CiAgICBlbHNlIGlmICh0eXBlID09PSAiZGVjcnlwdCIpIHsKICAgICAgICBjb25zdCB7IHJlYWRhYmxlU3RyZWFtLCB3cml0YWJsZVN0cmVhbSB9ID0gZXZlbnQuZGF0YTsKICAgICAgICBjb25zdCB0cmFuc2Zvcm1TdHJlYW0gPSBuZXcgVHJhbnNmb3JtU3RyZWFtKHsKICAgICAgICAgICAgdHJhbnNmb3JtOiBkZWNyeXB0RnVuY3Rpb24sCiAgICAgICAgfSk7CiAgICAgICAgcmVhZGFibGVTdHJlYW0ucGlwZVRocm91Z2godHJhbnNmb3JtU3RyZWFtKS5waXBlVG8od3JpdGFibGVTdHJlYW0pOwogICAgfQogICAgZWxzZSBpZiAodHlwZSA9PT0gImNsZWFyIikgewogICAgICAgIGNvdW50TWFwLmNsZWFyKCk7CiAgICAgICAgd3JpdGVJVk1hcC5jbGVhcigpOwogICAgICAgIHJlbW90ZURlcml2ZUtleU1hcC5jbGVhcigpOwogICAgICAgIGxhdGVzdFJlbW90ZUtleUlkTWFwLmNsZWFyKCk7CiAgICAgICAgc2VsZkRlcml2ZUtleU1hcC5jbGVhcigpOwogICAgfQp9Owo=\";\nclass SoraE2EE {\n    constructor() {\n        // 対応しているかどうかの判断\n        // @ts-ignore トライアル段階の API なので無視する\n        const supportsInsertableStreams = !!RTCRtpSender.prototype.createEncodedStreams;\n        if (!supportsInsertableStreams) {\n            throw new Error(\"E2EE is not supported in this browser.\");\n        }\n        this.worker = null;\n        this.onWorkerDisconnect = null;\n    }\n    // worker を起動する\n    startWorker() {\n        // ワーカーを起動する\n        const workerScript = atob(WORKER_SCRIPT);\n        this.worker = new Worker(URL.createObjectURL(new Blob([workerScript], { type: \"application/javascript\" })));\n        this.worker.onmessage = (event) => {\n            const { operation } = event.data;\n            if (operation === \"disconnect\" && typeof this.onWorkerDisconnect === \"function\") {\n                this.onWorkerDisconnect();\n            }\n        };\n    }\n    // worker の掃除をする\n    clearWorker() {\n        if (this.worker) {\n            this.worker.postMessage({\n                type: \"clear\",\n            });\n        }\n    }\n    // worker を終了する\n    terminateWorker() {\n        if (this.worker) {\n            this.worker.terminate();\n        }\n    }\n    // 初期化処理\n    async init() {\n        const { preKeyBundle } = await window.e2ee.init();\n        return preKeyBundle;\n    }\n    setupSenderTransform(sender) {\n        if (!sender.track) {\n            return;\n        }\n        // @ts-ignore トライアル段階の API なので無視する\n        const senderStreams = sender.createEncodedStreams();\n        const readableStream = senderStreams.readableStream || senderStreams.readable;\n        const writableStream = senderStreams.writableStream || senderStreams.writable;\n        if (!this.worker) {\n            throw new Error(\"Worker is null. Call startWorker in advance.\");\n        }\n        const message = {\n            type: \"encrypt\",\n            readableStream: readableStream,\n            writableStream: writableStream,\n        };\n        this.worker.postMessage(message, [readableStream, writableStream]);\n    }\n    setupReceiverTransform(receiver) {\n        // @ts-ignore トライアル段階の API なので無視する\n        const receiverStreams = receiver.createEncodedStreams();\n        const readableStream = receiverStreams.readableStream || receiverStreams.readable;\n        const writableStream = receiverStreams.writableStream || receiverStreams.writable;\n        if (!this.worker) {\n            throw new Error(\"Worker is null. Call startWorker in advance.\");\n        }\n        const message = {\n            type: \"decrypt\",\n            readableStream: readableStream,\n            writableStream: writableStream,\n        };\n        this.worker.postMessage(message, [readableStream, writableStream]);\n    }\n    postRemoteSecretKeyMaterials(result) {\n        if (!this.worker) {\n            throw new Error(\"Worker is null. Call startWorker in advance.\");\n        }\n        this.worker.postMessage({\n            type: \"remoteSecretKeyMaterials\",\n            remoteSecretKeyMaterials: result.remoteSecretKeyMaterials,\n        });\n    }\n    postRemoveRemoteDeriveKey(connectionId) {\n        if (!this.worker) {\n            throw new Error(\"Worker is null. Call startWorker in advance.\");\n        }\n        this.worker.postMessage({\n            type: \"removeRemoteDeriveKey\",\n            connectionId: connectionId,\n        });\n    }\n    postSelfSecretKeyMaterial(selfConnectionId, selfKeyId, selfSecretKeyMaterial, waitingTime = 0) {\n        if (!this.worker) {\n            throw new Error(\"Worker is null. Call startWorker in advance.\");\n        }\n        this.worker.postMessage({\n            type: \"selfSecretKeyMaterial\",\n            selfConnectionId: selfConnectionId,\n            selfKeyId: selfKeyId,\n            selfSecretKeyMaterial: selfSecretKeyMaterial,\n            waitingTime: waitingTime,\n        });\n    }\n    startSession(connectionId, preKeyBundle) {\n        const [result, err] = window.e2ee.startSession(connectionId, preKeyBundle.identityKey, preKeyBundle.signedPreKey, preKeyBundle.preKeySignature);\n        if (err) {\n            throw err;\n        }\n        return result;\n    }\n    stopSession(connectionId) {\n        const [result, err] = window.e2ee.stopSession(connectionId);\n        if (err) {\n            throw err;\n        }\n        return result;\n    }\n    receiveMessage(message) {\n        const [result, err] = window.e2ee.receiveMessage(message);\n        if (err) {\n            throw err;\n        }\n        return result;\n    }\n    start(selfConnectionId) {\n        const [result, err] = window.e2ee.start(selfConnectionId);\n        if (err) {\n            throw err;\n        }\n        return result;\n    }\n    addPreKeyBundle(connectionId, preKeyBundle) {\n        const err = window.e2ee.addPreKeyBundle(connectionId, preKeyBundle.identityKey, preKeyBundle.signedPreKey, preKeyBundle.preKeySignature);\n        if (err) {\n            throw err;\n        }\n    }\n    selfFingerprint() {\n        return window.e2ee.selfFingerprint();\n    }\n    remoteFingerprints() {\n        return window.e2ee.remoteFingerprints();\n    }\n    static async loadWasm(wasmUrl) {\n        if (!window.e2ee === undefined) {\n            console.warn(\"E2ee wasm is already loaded. Will not be reload.\");\n            return;\n        }\n        WasmExec();\n        if (!window.Go) {\n            throw new Error(`Failed to load module Go. window.Go is ${window.Go}.`);\n        }\n        const go = new Go();\n        const { instance } = await WebAssembly.instantiateStreaming(fetch(wasmUrl), go.importObject);\n        go.run(instance);\n        if (!window.e2ee) {\n            throw new Error(`Failed to load module e2ee. window.e2ee is ${window.e2ee}.`);\n        }\n    }\n    static version() {\n        return \"2021.1.0\";\n    }\n    static wasmVersion() {\n        return window.e2ee.version();\n    }\n}\n\nexport { SoraE2EE as default };\n","// Copyright 2018 The Go Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\nexport default function () {\n\t(() => {\n\t\t// Map multiple JavaScript environments to a single common API,\n\t\t// preferring web standards over Node.js API.\n\t\t//\n\t\t// Environments considered:\n\t\t// - Browsers\n\t\t// - Node.js\n\t\t// - Electron\n\t\t// - Parcel\n\t\n\t\tif (typeof global !== \"undefined\") {\n\t\t\t// global already exists\n\t\t} else if (typeof window !== \"undefined\") {\n\t\t\twindow.global = window;\n\t\t} else if (typeof self !== \"undefined\") {\n\t\t\tself.global = self;\n\t\t} else {\n\t\t\tthrow new Error(\"cannot export Go (neither global, window nor self is defined)\");\n\t\t}\n\t\n\t\tif (!global.require && typeof require !== \"undefined\") {\n\t\t\tglobal.require = require;\n\t\t}\n\t\n\t\tif (!global.fs && global.require) {\n\t\t\tconst fs = require(\"fs\");\n\t\t\tif (Object.keys(fs) !== 0) {\n\t\t\t\tglobal.fs = fs;\n\t\t\t}\n\t\t}\n\t\n\t\tconst enosys = () => {\n\t\t\tconst err = new Error(\"not implemented\");\n\t\t\terr.code = \"ENOSYS\";\n\t\t\treturn err;\n\t\t};\n\t\n\t\tif (!global.fs) {\n\t\t\tlet outputBuf = \"\";\n\t\t\tglobal.fs = {\n\t\t\t\tconstants: { O_WRONLY: -1, O_RDWR: -1, O_CREAT: -1, O_TRUNC: -1, O_APPEND: -1, O_EXCL: -1 }, // unused\n\t\t\t\twriteSync(fd, buf) {\n\t\t\t\t\toutputBuf += decoder.decode(buf);\n\t\t\t\t\tconst nl = outputBuf.lastIndexOf(\"\\n\");\n\t\t\t\t\tif (nl != -1) {\n\t\t\t\t\t\tconsole.log(outputBuf.substr(0, nl));\n\t\t\t\t\t\toutputBuf = outputBuf.substr(nl + 1);\n\t\t\t\t\t}\n\t\t\t\t\treturn buf.length;\n\t\t\t\t},\n\t\t\t\twrite(fd, buf, offset, length, position, callback) {\n\t\t\t\t\tif (offset !== 0 || length !== buf.length || position !== null) {\n\t\t\t\t\t\tcallback(enosys());\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst n = this.writeSync(fd, buf);\n\t\t\t\t\tcallback(null, n);\n\t\t\t\t},\n\t\t\t\tchmod(path, mode, callback) { callback(enosys()); },\n\t\t\t\tchown(path, uid, gid, callback) { callback(enosys()); },\n\t\t\t\tclose(fd, callback) { callback(enosys()); },\n\t\t\t\tfchmod(fd, mode, callback) { callback(enosys()); },\n\t\t\t\tfchown(fd, uid, gid, callback) { callback(enosys()); },\n\t\t\t\tfstat(fd, callback) { callback(enosys()); },\n\t\t\t\tfsync(fd, callback) { callback(null); },\n\t\t\t\tftruncate(fd, length, callback) { callback(enosys()); },\n\t\t\t\tlchown(path, uid, gid, callback) { callback(enosys()); },\n\t\t\t\tlink(path, link, callback) { callback(enosys()); },\n\t\t\t\tlstat(path, callback) { callback(enosys()); },\n\t\t\t\tmkdir(path, perm, callback) { callback(enosys()); },\n\t\t\t\topen(path, flags, mode, callback) { callback(enosys()); },\n\t\t\t\tread(fd, buffer, offset, length, position, callback) { callback(enosys()); },\n\t\t\t\treaddir(path, callback) { callback(enosys()); },\n\t\t\t\treadlink(path, callback) { callback(enosys()); },\n\t\t\t\trename(from, to, callback) { callback(enosys()); },\n\t\t\t\trmdir(path, callback) { callback(enosys()); },\n\t\t\t\tstat(path, callback) { callback(enosys()); },\n\t\t\t\tsymlink(path, link, callback) { callback(enosys()); },\n\t\t\t\ttruncate(path, length, callback) { callback(enosys()); },\n\t\t\t\tunlink(path, callback) { callback(enosys()); },\n\t\t\t\tutimes(path, atime, mtime, callback) { callback(enosys()); },\n\t\t\t};\n\t\t}\n\t\n\t\tif (!global.process) {\n\t\t\tglobal.process = {\n\t\t\t\tgetuid() { return -1; },\n\t\t\t\tgetgid() { return -1; },\n\t\t\t\tgeteuid() { return -1; },\n\t\t\t\tgetegid() { return -1; },\n\t\t\t\tgetgroups() { throw enosys(); },\n\t\t\t\tpid: -1,\n\t\t\t\tppid: -1,\n\t\t\t\tumask() { throw enosys(); },\n\t\t\t\tcwd() { throw enosys(); },\n\t\t\t\tchdir() { throw enosys(); },\n\t\t\t}\n\t\t}\n\t\n\t\tif (!global.crypto) {\n\t\t\tconst nodeCrypto = require(\"crypto\");\n\t\t\tglobal.crypto = {\n\t\t\t\tgetRandomValues(b) {\n\t\t\t\t\tnodeCrypto.randomFillSync(b);\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\n\t\tif (!global.performance) {\n\t\t\tglobal.performance = {\n\t\t\t\tnow() {\n\t\t\t\t\tconst [sec, nsec] = process.hrtime();\n\t\t\t\t\treturn sec * 1000 + nsec / 1000000;\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\n\t\tif (!global.TextEncoder) {\n\t\t\tglobal.TextEncoder = require(\"util\").TextEncoder;\n\t\t}\n\t\n\t\tif (!global.TextDecoder) {\n\t\t\tglobal.TextDecoder = require(\"util\").TextDecoder;\n\t\t}\n\t\n\t\t// End of polyfills for common API.\n\t\n\t\tconst encoder = new TextEncoder(\"utf-8\");\n\t\tconst decoder = new TextDecoder(\"utf-8\");\n\t\n\t\tglobal.Go = class {\n\t\t\tconstructor() {\n\t\t\t\tthis.argv = [\"js\"];\n\t\t\t\tthis.env = {};\n\t\t\t\tthis.exit = (code) => {\n\t\t\t\t\tif (code !== 0) {\n\t\t\t\t\t\tconsole.warn(\"exit code:\", code);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis._exitPromise = new Promise((resolve) => {\n\t\t\t\t\tthis._resolveExitPromise = resolve;\n\t\t\t\t});\n\t\t\t\tthis._pendingEvent = null;\n\t\t\t\tthis._scheduledTimeouts = new Map();\n\t\t\t\tthis._nextCallbackTimeoutID = 1;\n\t\n\t\t\t\tconst setInt64 = (addr, v) => {\n\t\t\t\t\tthis.mem.setUint32(addr + 0, v, true);\n\t\t\t\t\tthis.mem.setUint32(addr + 4, Math.floor(v / 4294967296), true);\n\t\t\t\t}\n\t\n\t\t\t\tconst getInt64 = (addr) => {\n\t\t\t\t\tconst low = this.mem.getUint32(addr + 0, true);\n\t\t\t\t\tconst high = this.mem.getInt32(addr + 4, true);\n\t\t\t\t\treturn low + high * 4294967296;\n\t\t\t\t}\n\t\n\t\t\t\tconst loadValue = (addr) => {\n\t\t\t\t\tconst f = this.mem.getFloat64(addr, true);\n\t\t\t\t\tif (f === 0) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (!isNaN(f)) {\n\t\t\t\t\t\treturn f;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tconst id = this.mem.getUint32(addr, true);\n\t\t\t\t\treturn this._values[id];\n\t\t\t\t}\n\t\n\t\t\t\tconst storeValue = (addr, v) => {\n\t\t\t\t\tconst nanHead = 0x7FF80000;\n\t\n\t\t\t\t\tif (typeof v === \"number\" && v !== 0) {\n\t\t\t\t\t\tif (isNaN(v)) {\n\t\t\t\t\t\t\tthis.mem.setUint32(addr + 4, nanHead, true);\n\t\t\t\t\t\t\tthis.mem.setUint32(addr, 0, true);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.mem.setFloat64(addr, v, true);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (v === undefined) {\n\t\t\t\t\t\tthis.mem.setFloat64(addr, 0, true);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tlet id = this._ids.get(v);\n\t\t\t\t\tif (id === undefined) {\n\t\t\t\t\t\tid = this._idPool.pop();\n\t\t\t\t\t\tif (id === undefined) {\n\t\t\t\t\t\t\tid = this._values.length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._values[id] = v;\n\t\t\t\t\t\tthis._goRefCounts[id] = 0;\n\t\t\t\t\t\tthis._ids.set(v, id);\n\t\t\t\t\t}\n\t\t\t\t\tthis._goRefCounts[id]++;\n\t\t\t\t\tlet typeFlag = 0;\n\t\t\t\t\tswitch (typeof v) {\n\t\t\t\t\t\tcase \"object\":\n\t\t\t\t\t\t\tif (v !== null) {\n\t\t\t\t\t\t\t\ttypeFlag = 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\t\ttypeFlag = 2;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"symbol\":\n\t\t\t\t\t\t\ttypeFlag = 3;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"function\":\n\t\t\t\t\t\t\ttypeFlag = 4;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tthis.mem.setUint32(addr + 4, nanHead | typeFlag, true);\n\t\t\t\t\tthis.mem.setUint32(addr, id, true);\n\t\t\t\t}\n\t\n\t\t\t\tconst loadSlice = (addr) => {\n\t\t\t\t\tconst array = getInt64(addr + 0);\n\t\t\t\t\tconst len = getInt64(addr + 8);\n\t\t\t\t\treturn new Uint8Array(this._inst.exports.mem.buffer, array, len);\n\t\t\t\t}\n\t\n\t\t\t\tconst loadSliceOfValues = (addr) => {\n\t\t\t\t\tconst array = getInt64(addr + 0);\n\t\t\t\t\tconst len = getInt64(addr + 8);\n\t\t\t\t\tconst a = new Array(len);\n\t\t\t\t\tfor (let i = 0; i < len; i++) {\n\t\t\t\t\t\ta[i] = loadValue(array + i * 8);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\n\t\t\t\tconst loadString = (addr) => {\n\t\t\t\t\tconst saddr = getInt64(addr + 0);\n\t\t\t\t\tconst len = getInt64(addr + 8);\n\t\t\t\t\treturn decoder.decode(new DataView(this._inst.exports.mem.buffer, saddr, len));\n\t\t\t\t}\n\t\n\t\t\t\tconst timeOrigin = Date.now() - performance.now();\n\t\t\t\tthis.importObject = {\n\t\t\t\t\tgo: {\n\t\t\t\t\t\t// Go's SP does not change as long as no Go code is running. Some operations (e.g. calls, getters and setters)\n\t\t\t\t\t\t// may synchronously trigger a Go event handler. This makes Go code get executed in the middle of the imported\n\t\t\t\t\t\t// function. A goroutine can switch to a new stack if the current stack is too small (see morestack function).\n\t\t\t\t\t\t// This changes the SP, thus we have to update the SP used by the imported function.\n\t\n\t\t\t\t\t\t// func wasmExit(code int32)\n\t\t\t\t\t\t\"runtime.wasmExit\": (sp) => {\n\t\t\t\t\t\t\tconst code = this.mem.getInt32(sp + 8, true);\n\t\t\t\t\t\t\tthis.exited = true;\n\t\t\t\t\t\t\tdelete this._inst;\n\t\t\t\t\t\t\tdelete this._values;\n\t\t\t\t\t\t\tdelete this._goRefCounts;\n\t\t\t\t\t\t\tdelete this._ids;\n\t\t\t\t\t\t\tdelete this._idPool;\n\t\t\t\t\t\t\tthis.exit(code);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func wasmWrite(fd uintptr, p unsafe.Pointer, n int32)\n\t\t\t\t\t\t\"runtime.wasmWrite\": (sp) => {\n\t\t\t\t\t\t\tconst fd = getInt64(sp + 8);\n\t\t\t\t\t\t\tconst p = getInt64(sp + 16);\n\t\t\t\t\t\t\tconst n = this.mem.getInt32(sp + 24, true);\n\t\t\t\t\t\t\tfs.writeSync(fd, new Uint8Array(this._inst.exports.mem.buffer, p, n));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func resetMemoryDataView()\n\t\t\t\t\t\t\"runtime.resetMemoryDataView\": (sp) => {\n\t\t\t\t\t\t\tthis.mem = new DataView(this._inst.exports.mem.buffer);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func nanotime1() int64\n\t\t\t\t\t\t\"runtime.nanotime1\": (sp) => {\n\t\t\t\t\t\t\tsetInt64(sp + 8, (timeOrigin + performance.now()) * 1000000);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func walltime1() (sec int64, nsec int32)\n\t\t\t\t\t\t\"runtime.walltime1\": (sp) => {\n\t\t\t\t\t\t\tconst msec = (new Date).getTime();\n\t\t\t\t\t\t\tsetInt64(sp + 8, msec / 1000);\n\t\t\t\t\t\t\tthis.mem.setInt32(sp + 16, (msec % 1000) * 1000000, true);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func scheduleTimeoutEvent(delay int64) int32\n\t\t\t\t\t\t\"runtime.scheduleTimeoutEvent\": (sp) => {\n\t\t\t\t\t\t\tconst id = this._nextCallbackTimeoutID;\n\t\t\t\t\t\t\tthis._nextCallbackTimeoutID++;\n\t\t\t\t\t\t\tthis._scheduledTimeouts.set(id, setTimeout(\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis._resume();\n\t\t\t\t\t\t\t\t\twhile (this._scheduledTimeouts.has(id)) {\n\t\t\t\t\t\t\t\t\t\t// for some reason Go failed to register the timeout event, log and try again\n\t\t\t\t\t\t\t\t\t\t// (temporary workaround for https://github.com/golang/go/issues/28975)\n\t\t\t\t\t\t\t\t\t\tconsole.warn(\"scheduleTimeoutEvent: missed timeout event\");\n\t\t\t\t\t\t\t\t\t\tthis._resume();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgetInt64(sp + 8) + 1, // setTimeout has been seen to fire up to 1 millisecond early\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\tthis.mem.setInt32(sp + 16, id, true);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func clearTimeoutEvent(id int32)\n\t\t\t\t\t\t\"runtime.clearTimeoutEvent\": (sp) => {\n\t\t\t\t\t\t\tconst id = this.mem.getInt32(sp + 8, true);\n\t\t\t\t\t\t\tclearTimeout(this._scheduledTimeouts.get(id));\n\t\t\t\t\t\t\tthis._scheduledTimeouts.delete(id);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func getRandomData(r []byte)\n\t\t\t\t\t\t\"runtime.getRandomData\": (sp) => {\n\t\t\t\t\t\t\tcrypto.getRandomValues(loadSlice(sp + 8));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func finalizeRef(v ref)\n\t\t\t\t\t\t\"syscall/js.finalizeRef\": (sp) => {\n\t\t\t\t\t\t\tconst id = this.mem.getUint32(sp + 8, true);\n\t\t\t\t\t\t\tthis._goRefCounts[id]--;\n\t\t\t\t\t\t\tif (this._goRefCounts[id] === 0) {\n\t\t\t\t\t\t\t\tconst v = this._values[id];\n\t\t\t\t\t\t\t\tthis._values[id] = null;\n\t\t\t\t\t\t\t\tthis._ids.delete(v);\n\t\t\t\t\t\t\t\tthis._idPool.push(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func stringVal(value string) ref\n\t\t\t\t\t\t\"syscall/js.stringVal\": (sp) => {\n\t\t\t\t\t\t\tstoreValue(sp + 24, loadString(sp + 8));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueGet(v ref, p string) ref\n\t\t\t\t\t\t\"syscall/js.valueGet\": (sp) => {\n\t\t\t\t\t\t\tconst result = Reflect.get(loadValue(sp + 8), loadString(sp + 16));\n\t\t\t\t\t\t\tsp = this._inst.exports.getsp(); // see comment above\n\t\t\t\t\t\t\tstoreValue(sp + 32, result);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueSet(v ref, p string, x ref)\n\t\t\t\t\t\t\"syscall/js.valueSet\": (sp) => {\n\t\t\t\t\t\t\tReflect.set(loadValue(sp + 8), loadString(sp + 16), loadValue(sp + 32));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueDelete(v ref, p string)\n\t\t\t\t\t\t\"syscall/js.valueDelete\": (sp) => {\n\t\t\t\t\t\t\tReflect.deleteProperty(loadValue(sp + 8), loadString(sp + 16));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueIndex(v ref, i int) ref\n\t\t\t\t\t\t\"syscall/js.valueIndex\": (sp) => {\n\t\t\t\t\t\t\tstoreValue(sp + 24, Reflect.get(loadValue(sp + 8), getInt64(sp + 16)));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// valueSetIndex(v ref, i int, x ref)\n\t\t\t\t\t\t\"syscall/js.valueSetIndex\": (sp) => {\n\t\t\t\t\t\t\tReflect.set(loadValue(sp + 8), getInt64(sp + 16), loadValue(sp + 24));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueCall(v ref, m string, args []ref) (ref, bool)\n\t\t\t\t\t\t\"syscall/js.valueCall\": (sp) => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\n\t\t\t\t\t\t\t\tconst m = Reflect.get(v, loadString(sp + 16));\n\t\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 32);\n\t\t\t\t\t\t\t\tconst result = Reflect.apply(m, v, args);\n\t\t\t\t\t\t\t\tsp = this._inst.exports.getsp(); // see comment above\n\t\t\t\t\t\t\t\tstoreValue(sp + 56, result);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 64, 1);\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\tstoreValue(sp + 56, err);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 64, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueInvoke(v ref, args []ref) (ref, bool)\n\t\t\t\t\t\t\"syscall/js.valueInvoke\": (sp) => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\n\t\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 16);\n\t\t\t\t\t\t\t\tconst result = Reflect.apply(v, undefined, args);\n\t\t\t\t\t\t\t\tsp = this._inst.exports.getsp(); // see comment above\n\t\t\t\t\t\t\t\tstoreValue(sp + 40, result);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\tstoreValue(sp + 40, err);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueNew(v ref, args []ref) (ref, bool)\n\t\t\t\t\t\t\"syscall/js.valueNew\": (sp) => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst v = loadValue(sp + 8);\n\t\t\t\t\t\t\t\tconst args = loadSliceOfValues(sp + 16);\n\t\t\t\t\t\t\t\tconst result = Reflect.construct(v, args);\n\t\t\t\t\t\t\t\tsp = this._inst.exports.getsp(); // see comment above\n\t\t\t\t\t\t\t\tstoreValue(sp + 40, result);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\n\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\tstoreValue(sp + 40, err);\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueLength(v ref) int\n\t\t\t\t\t\t\"syscall/js.valueLength\": (sp) => {\n\t\t\t\t\t\t\tsetInt64(sp + 16, parseInt(loadValue(sp + 8).length));\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// valuePrepareString(v ref) (ref, int)\n\t\t\t\t\t\t\"syscall/js.valuePrepareString\": (sp) => {\n\t\t\t\t\t\t\tconst str = encoder.encode(String(loadValue(sp + 8)));\n\t\t\t\t\t\t\tstoreValue(sp + 16, str);\n\t\t\t\t\t\t\tsetInt64(sp + 24, str.length);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// valueLoadString(v ref, b []byte)\n\t\t\t\t\t\t\"syscall/js.valueLoadString\": (sp) => {\n\t\t\t\t\t\t\tconst str = loadValue(sp + 8);\n\t\t\t\t\t\t\tloadSlice(sp + 16).set(str);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func valueInstanceOf(v ref, t ref) bool\n\t\t\t\t\t\t\"syscall/js.valueInstanceOf\": (sp) => {\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 24, (loadValue(sp + 8) instanceof loadValue(sp + 16)) ? 1 : 0);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func copyBytesToGo(dst []byte, src ref) (int, bool)\n\t\t\t\t\t\t\"syscall/js.copyBytesToGo\": (sp) => {\n\t\t\t\t\t\t\tconst dst = loadSlice(sp + 8);\n\t\t\t\t\t\t\tconst src = loadValue(sp + 32);\n\t\t\t\t\t\t\tif (!(src instanceof Uint8Array || src instanceof Uint8ClampedArray)) {\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst toCopy = src.subarray(0, dst.length);\n\t\t\t\t\t\t\tdst.set(toCopy);\n\t\t\t\t\t\t\tsetInt64(sp + 40, toCopy.length);\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t// func copyBytesToJS(dst ref, src []byte) (int, bool)\n\t\t\t\t\t\t\"syscall/js.copyBytesToJS\": (sp) => {\n\t\t\t\t\t\t\tconst dst = loadValue(sp + 8);\n\t\t\t\t\t\t\tconst src = loadSlice(sp + 16);\n\t\t\t\t\t\t\tif (!(dst instanceof Uint8Array || dst instanceof Uint8ClampedArray)) {\n\t\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 0);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst toCopy = src.subarray(0, dst.length);\n\t\t\t\t\t\t\tdst.set(toCopy);\n\t\t\t\t\t\t\tsetInt64(sp + 40, toCopy.length);\n\t\t\t\t\t\t\tthis.mem.setUint8(sp + 48, 1);\n\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t\"debug\": (value) => {\n\t\t\t\t\t\t\tconsole.log(value);\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\n\t\t\tasync run(instance) {\n\t\t\t\tthis._inst = instance;\n\t\t\t\tthis.mem = new DataView(this._inst.exports.mem.buffer);\n\t\t\t\tthis._values = [ // JS values that Go currently has references to, indexed by reference id\n\t\t\t\t\tNaN,\n\t\t\t\t\t0,\n\t\t\t\t\tnull,\n\t\t\t\t\ttrue,\n\t\t\t\t\tfalse,\n\t\t\t\t\tglobal,\n\t\t\t\t\tthis,\n\t\t\t\t];\n\t\t\t\tthis._goRefCounts = new Array(this._values.length).fill(Infinity); // number of references that Go has to a JS value, indexed by reference id\n\t\t\t\tthis._ids = new Map([ // mapping from JS values to reference ids\n\t\t\t\t\t[0, 1],\n\t\t\t\t\t[null, 2],\n\t\t\t\t\t[true, 3],\n\t\t\t\t\t[false, 4],\n\t\t\t\t\t[global, 5],\n\t\t\t\t\t[this, 6],\n\t\t\t\t]);\n\t\t\t\tthis._idPool = [];   // unused ids that have been garbage collected\n\t\t\t\tthis.exited = false; // whether the Go program has exited\n\t\n\t\t\t\t// Pass command line arguments and environment variables to WebAssembly by writing them to the linear memory.\n\t\t\t\tlet offset = 4096;\n\t\n\t\t\t\tconst strPtr = (str) => {\n\t\t\t\t\tconst ptr = offset;\n\t\t\t\t\tconst bytes = encoder.encode(str + \"\\0\");\n\t\t\t\t\tnew Uint8Array(this.mem.buffer, offset, bytes.length).set(bytes);\n\t\t\t\t\toffset += bytes.length;\n\t\t\t\t\tif (offset % 8 !== 0) {\n\t\t\t\t\t\toffset += 8 - (offset % 8);\n\t\t\t\t\t}\n\t\t\t\t\treturn ptr;\n\t\t\t\t};\n\t\n\t\t\t\tconst argc = this.argv.length;\n\t\n\t\t\t\tconst argvPtrs = [];\n\t\t\t\tthis.argv.forEach((arg) => {\n\t\t\t\t\targvPtrs.push(strPtr(arg));\n\t\t\t\t});\n\t\t\t\targvPtrs.push(0);\n\t\n\t\t\t\tconst keys = Object.keys(this.env).sort();\n\t\t\t\tkeys.forEach((key) => {\n\t\t\t\t\targvPtrs.push(strPtr(`${key}=${this.env[key]}`));\n\t\t\t\t});\n\t\t\t\targvPtrs.push(0);\n\t\n\t\t\t\tconst argv = offset;\n\t\t\t\targvPtrs.forEach((ptr) => {\n\t\t\t\t\tthis.mem.setUint32(offset, ptr, true);\n\t\t\t\t\tthis.mem.setUint32(offset + 4, 0, true);\n\t\t\t\t\toffset += 8;\n\t\t\t\t});\n\t\n\t\t\t\tthis._inst.exports.run(argc, argv);\n\t\t\t\tif (this.exited) {\n\t\t\t\t\tthis._resolveExitPromise();\n\t\t\t\t}\n\t\t\t\tawait this._exitPromise;\n\t\t\t}\n\t\n\t\t\t_resume() {\n\t\t\t\tif (this.exited) {\n\t\t\t\t\tthrow new Error(\"Go program has already exited\");\n\t\t\t\t}\n\t\t\t\tthis._inst.exports.resume();\n\t\t\t\tif (this.exited) {\n\t\t\t\t\tthis._resolveExitPromise();\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t_makeFuncWrapper(id) {\n\t\t\t\tconst go = this;\n\t\t\t\treturn function () {\n\t\t\t\t\tconst event = { id: id, this: this, args: arguments };\n\t\t\t\t\tgo._pendingEvent = event;\n\t\t\t\t\tgo._resume();\n\t\t\t\t\treturn event.result;\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\n\t\tif (\n\t\t\tglobal.require &&\n\t\t\tglobal.require.main === module &&\n\t\t\tglobal.process &&\n\t\t\tglobal.process.versions &&\n\t\t\t!global.process.versions.electron\n\t\t) {\n\t\t\tif (process.argv.length < 3) {\n\t\t\t\tconsole.error(\"usage: go_js_wasm_exec [wasm binary] [arguments]\");\n\t\t\t\tprocess.exit(1);\n\t\t\t}\n\t\n\t\t\tconst go = new Go();\n\t\t\tgo.argv = process.argv.slice(2);\n\t\t\tgo.env = Object.assign({ TMPDIR: require(\"os\").tmpdir() }, process.env);\n\t\t\tgo.exit = process.exit;\n\t\t\tWebAssembly.instantiate(fs.readFileSync(process.argv[2]), go.importObject).then((result) => {\n\t\t\t\tprocess.on(\"exit\", (code) => { // Node.js exits if no event handler is pending\n\t\t\t\t\tif (code === 0 && !go.exited) {\n\t\t\t\t\t\t// deadlock, make Go print error and stack traces\n\t\t\t\t\t\tgo._pendingEvent = { id: 0 };\n\t\t\t\t\t\tgo._resume();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn go.run(result.instance);\n\t\t\t}).catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t\tprocess.exit(1);\n\t\t\t});\n\t\t}\n\t})();\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    if (!sl || (st && st.f && !st.l))\n        return buf || new u8(0);\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [et, 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[pos >> 3] = lst;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            // deopt when i > s - 3 - at end, deopt acceptable\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst && pos & 7)\n            pos = wfblk(w, pos + 1, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return ((d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) | (d[l - 1] << 24)) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if (d[1] & 32)\n        err(6, 'invalid zlib data: preset dictionaries not supported');\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = this.p.length > 3 ? gzs(this.p) : 4;\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                err(6, 'invalid gzip data');\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return [r, slc(d, i - 1)];\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), ch = _a[0], np = _a[1];\n        if (final) {\n            if (np.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = np;\n        this.ondata(ch, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td)\n        return td.decode(dat);\n    else {\n        var _a = dutf8(dat), out = _a[0], ext = _a[1];\n        if (ext.length)\n            err(8);\n        return out;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c == null && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1)), b += 4;\n    if (c != null) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this_1 = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this_1.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this_1 = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this_1.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this_1.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this_1.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this_1.ondata(err, dat, final);\n                    _this_1.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this_1 = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this_1.d & 1))\n                        return;\n                    _this_1.u.splice(-1, 1);\n                    _this_1.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, f.c, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this_1 = this;\n        this.i = new Inflate(function (dat, final) {\n            _this_1.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this_1 = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this_1.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this_1.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this_1 = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this_1.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this_1.k[0] == chks_3 && _this_1.c)\n                                        _this_1.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295;\n        if (z) {\n            e = b4(data, e - 12);\n            if (b4(data, e) != 0x6064B50) {\n                cbd(err(13, 0, 1), null);\n                return tAll;\n            }\n            c = lft = b4(data, e + 32);\n            o = b4(data, e + 48);\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    if (sc < 320000) {\n                        try {\n                            cbl(null, inflateSync(infl, new u8(su)));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            err(13);\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n","import { unzlibSync } from \"fflate\";\n\nimport {\n  ConnectionOptions,\n  Browser,\n  JSONType,\n  DataChannelConfiguration,\n  DataChannelEvent,\n  DataChannelMessageEvent,\n  PreKeyBundle,\n  SignalingConnectMessage,\n  SignalingConnectDataChannel,\n  SignalingEvent,\n  SignalingNotifyMetadata,\n  SignalingNotifyConnectionCreated,\n  SignalingNotifyConnectionDestroyed,\n  TimelineEvent,\n  TimelineEventLogType,\n  TransportType,\n} from \"./types\";\n\nfunction browser(): Browser {\n  const ua = window.navigator.userAgent.toLocaleLowerCase();\n  if (ua.indexOf(\"edge\") !== -1) {\n    return \"edge\";\n  } else if (ua.indexOf(\"chrome\") !== -1 && ua.indexOf(\"edge\") === -1) {\n    return \"chrome\";\n  } else if (ua.indexOf(\"safari\") !== -1 && ua.indexOf(\"chrome\") === -1) {\n    return \"safari\";\n  } else if (ua.indexOf(\"opera\") !== -1) {\n    return \"opera\";\n  } else if (ua.indexOf(\"firefox\") !== -1) {\n    return \"firefox\";\n  }\n  return null;\n}\n\nfunction enabledSimulcast(): boolean {\n  const REQUIRED_HEADER_EXTEMSIONS = [\n    \"urn:ietf:params:rtp-hdrext:sdes:mid\",\n    \"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\",\n    \"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\",\n  ];\n\n  if (!window.RTCRtpSender) {\n    return false;\n  }\n  if (!RTCRtpSender.getCapabilities) {\n    return false;\n  }\n  const capabilities = RTCRtpSender.getCapabilities(\"video\");\n  if (!capabilities) {\n    return false;\n  }\n  const headerExtensions = capabilities.headerExtensions.map((h) => h.uri);\n  const hasAllRequiredHeaderExtensions = REQUIRED_HEADER_EXTEMSIONS.every((h) => headerExtensions.includes(h));\n  return hasAllRequiredHeaderExtensions;\n}\n\nfunction parseDataChannelConfiguration(dataChannelConfiguration: unknown): SignalingConnectDataChannel {\n  if (typeof dataChannelConfiguration !== \"object\" || dataChannelConfiguration === null) {\n    throw new Error(\"Failed to parse options dataChannels. Options dataChannels element must be type 'object'\");\n  }\n  const configuration = dataChannelConfiguration as DataChannelConfiguration;\n  const result: SignalingConnectDataChannel = {};\n  if (typeof configuration.label === \"string\") {\n    result.label = configuration.label;\n  }\n  if (typeof configuration.direction === \"string\") {\n    result.direction = configuration.direction;\n  }\n  if (typeof configuration.ordered === \"boolean\") {\n    result.ordered = configuration.ordered;\n  }\n  if (typeof configuration.compress === \"boolean\") {\n    result.compress = configuration.compress;\n  }\n  if (typeof configuration.maxPacketLifeTime === \"number\") {\n    result.max_packet_life_time = configuration.maxPacketLifeTime;\n  }\n  if (typeof configuration.maxRetransmits === \"number\") {\n    result.max_retransmits = configuration.maxRetransmits;\n  }\n  if (typeof configuration.protocol === \"string\") {\n    result.protocol = configuration.protocol;\n  }\n  return result;\n}\n\nfunction parseDataChannelConfigurations(dataChannelConfigurations: unknown[]): SignalingConnectDataChannel[] {\n  const result: SignalingConnectDataChannel[] = [];\n  for (const dataChannelConfiguration of dataChannelConfigurations) {\n    result.push(parseDataChannelConfiguration(dataChannelConfiguration));\n  }\n  return result;\n}\n\nexport function isSafari(): boolean {\n  return browser() === \"safari\";\n}\n\nexport function isChrome(): boolean {\n  return browser() === \"chrome\";\n}\n\nexport function createSignalingMessage(\n  offerSDP: string,\n  role: string,\n  channelId: string | null | undefined,\n  metadata: JSONType | undefined,\n  options: ConnectionOptions,\n  redirect: boolean\n): SignalingConnectMessage {\n  if (role !== \"sendrecv\" && role !== \"sendonly\" && role !== \"recvonly\") {\n    throw new Error(\"Unknown role type\");\n  }\n  if (channelId === null || channelId === undefined) {\n    throw new Error(\"channelId can not be null or undefined\");\n  }\n  const message: SignalingConnectMessage = {\n    type: \"connect\",\n    sora_client: \"Sora JavaScript SDK __SORA_JS_SDK_VERSION__\",\n    environment: window.navigator.userAgent,\n    role: role,\n    channel_id: channelId,\n    sdp: offerSDP,\n    audio: true,\n    video: true,\n  };\n  // role: sendrecv で multistream: false の場合は例外を発生させる\n  if (role === \"sendrecv\" && options.multistream !== true) {\n    throw new Error(\"Failed to parse options. Options multistream must be true when connecting using 'sendrecv'\");\n  }\n\n  if (metadata !== undefined) {\n    message.metadata = metadata;\n  }\n\n  if (redirect) {\n    message.redirect = true;\n  }\n\n  if (\"signalingNotifyMetadata\" in options) {\n    message.signaling_notify_metadata = options.signalingNotifyMetadata;\n  }\n\n  if (\"multistream\" in options && options.multistream === true) {\n    // multistream\n    message.multistream = true;\n    // spotlight\n    if (\"spotlight\" in options) {\n      message.spotlight = options.spotlight;\n      if (\"spotlightNumber\" in options) {\n        message.spotlight_number = options.spotlightNumber;\n      }\n    }\n    if (message.spotlight === true) {\n      const spotlightFocusRids = [\"none\", \"r0\", \"r1\", \"r2\"];\n      if (options.spotlightFocusRid !== undefined && 0 <= spotlightFocusRids.indexOf(options.spotlightFocusRid)) {\n        message.spotlight_focus_rid = options.spotlightFocusRid;\n      }\n      if (options.spotlightUnfocusRid !== undefined && 0 <= spotlightFocusRids.indexOf(options.spotlightUnfocusRid)) {\n        message.spotlight_unfocus_rid = options.spotlightUnfocusRid;\n      }\n    }\n  }\n\n  if (\"simulcast\" in options || \"simulcastRid\" in options) {\n    // simulcast\n    if (\"simulcast\" in options && options.simulcast === true) {\n      message.simulcast = true;\n    }\n    const simalcastRids = [\"r0\", \"r1\", \"r2\"];\n    if (options.simulcastRid !== undefined && 0 <= simalcastRids.indexOf(options.simulcastRid)) {\n      message.simulcast_rid = options.simulcastRid;\n    }\n  }\n\n  // client_id\n  if (\"clientId\" in options && options.clientId !== undefined) {\n    message.client_id = options.clientId;\n  }\n\n  if (\"dataChannelSignaling\" in options && typeof options.dataChannelSignaling === \"boolean\") {\n    message.data_channel_signaling = options.dataChannelSignaling;\n  }\n\n  if (\"ignoreDisconnectWebSocket\" in options && typeof options.ignoreDisconnectWebSocket === \"boolean\") {\n    message.ignore_disconnect_websocket = options.ignoreDisconnectWebSocket;\n  }\n\n  // parse options\n  const audioPropertyKeys = [\"audioCodecType\", \"audioBitRate\"];\n  const audioOpusParamsPropertyKeys = [\n    \"audioOpusParamsChannels\",\n    \"audioOpusParamsClockRate\",\n    \"audioOpusParamsMaxplaybackrate\",\n    \"audioOpusParamsStereo\",\n    \"audioOpusParamsSpropStereo\",\n    \"audioOpusParamsMinptime\",\n    \"audioOpusParamsPtime\",\n    \"audioOpusParamsUseinbandfec\",\n    \"audioOpusParamsUsedtx\",\n  ];\n  const videoPropertyKeys = [\"videoCodecType\", \"videoBitRate\"];\n  const copyOptions = Object.assign({}, options);\n  (Object.keys(copyOptions) as (keyof ConnectionOptions)[]).forEach((key) => {\n    if (key === \"audio\" && typeof copyOptions[key] === \"boolean\") {\n      return;\n    }\n    if (key === \"video\" && typeof copyOptions[key] === \"boolean\") {\n      return;\n    }\n    if (0 <= audioPropertyKeys.indexOf(key) && copyOptions[key] !== null) {\n      return;\n    }\n    if (0 <= audioOpusParamsPropertyKeys.indexOf(key) && copyOptions[key] !== null) {\n      return;\n    }\n    if (0 <= videoPropertyKeys.indexOf(key) && copyOptions[key] !== null) {\n      return;\n    }\n    delete copyOptions[key];\n  });\n\n  if (copyOptions.audio !== undefined) {\n    message.audio = copyOptions.audio;\n  }\n  const hasAudioProperty = Object.keys(copyOptions).some((key) => {\n    return 0 <= audioPropertyKeys.indexOf(key);\n  });\n  if (message.audio && hasAudioProperty) {\n    message.audio = {};\n    if (\"audioCodecType\" in copyOptions) {\n      message.audio[\"codec_type\"] = copyOptions.audioCodecType;\n    }\n    if (\"audioBitRate\" in copyOptions) {\n      message.audio[\"bit_rate\"] = copyOptions.audioBitRate;\n    }\n  }\n  const hasAudioOpusParamsProperty = Object.keys(copyOptions).some((key) => {\n    return 0 <= audioOpusParamsPropertyKeys.indexOf(key);\n  });\n  if (message.audio && hasAudioOpusParamsProperty) {\n    if (typeof message.audio != \"object\") {\n      message.audio = {};\n    }\n    message.audio.opus_params = {};\n    if (\"audioOpusParamsChannels\" in copyOptions) {\n      message.audio.opus_params.channels = copyOptions.audioOpusParamsChannels;\n    }\n    if (\"audioOpusParamsClockRate\" in copyOptions) {\n      message.audio.opus_params.clock_rate = copyOptions.audioOpusParamsClockRate;\n    }\n    if (\"audioOpusParamsMaxplaybackrate\" in copyOptions) {\n      message.audio.opus_params.maxplaybackrate = copyOptions.audioOpusParamsMaxplaybackrate;\n    }\n    if (\"audioOpusParamsStereo\" in copyOptions) {\n      message.audio.opus_params.stereo = copyOptions.audioOpusParamsStereo;\n    }\n    if (\"audioOpusParamsSpropStereo\" in copyOptions) {\n      message.audio.opus_params.sprop_stereo = copyOptions.audioOpusParamsSpropStereo;\n    }\n    if (\"audioOpusParamsMinptime\" in copyOptions) {\n      message.audio.opus_params.minptime = copyOptions.audioOpusParamsMinptime;\n    }\n    if (\"audioOpusParamsPtime\" in copyOptions) {\n      message.audio.opus_params.ptime = copyOptions.audioOpusParamsPtime;\n    }\n    if (\"audioOpusParamsUseinbandfec\" in copyOptions) {\n      message.audio.opus_params.useinbandfec = copyOptions.audioOpusParamsUseinbandfec;\n    }\n    if (\"audioOpusParamsUsedtx\" in copyOptions) {\n      message.audio.opus_params.usedtx = copyOptions.audioOpusParamsUsedtx;\n    }\n  }\n\n  if (copyOptions.video !== undefined) {\n    message.video = copyOptions.video;\n  }\n  const hasVideoProperty = Object.keys(copyOptions).some((key) => {\n    return 0 <= videoPropertyKeys.indexOf(key);\n  });\n  if (message.video && hasVideoProperty) {\n    message.video = {};\n    if (\"videoCodecType\" in copyOptions) {\n      message.video[\"codec_type\"] = copyOptions.videoCodecType;\n    }\n    if (\"videoBitRate\" in copyOptions) {\n      message.video[\"bit_rate\"] = copyOptions.videoBitRate;\n    }\n  }\n\n  if (message.simulcast && !enabledSimulcast() && role !== \"recvonly\") {\n    throw new Error(\"Simulcast can not be used with this browser\");\n  }\n\n  if (options.e2ee === true) {\n    if (message.signaling_notify_metadata === undefined) {\n      message.signaling_notify_metadata = {};\n    }\n    if (message.signaling_notify_metadata === null || typeof message.signaling_notify_metadata !== \"object\") {\n      throw new Error(\"E2EE failed. Options signalingNotifyMetadata must be type 'object'\");\n    }\n    if (message.video === true) {\n      message.video = {};\n    }\n    if (message.video) {\n      message.video[\"codec_type\"] = \"VP8\";\n    }\n    message.e2ee = true;\n  }\n\n  if (Array.isArray(options.dataChannels) && 0 < options.dataChannels.length) {\n    message.data_channels = parseDataChannelConfigurations(options.dataChannels);\n  }\n\n  return message;\n}\n\nexport function getSignalingNotifyAuthnMetadata(\n  message: SignalingNotifyConnectionCreated | SignalingNotifyConnectionDestroyed | SignalingNotifyMetadata\n): JSONType {\n  if (message.authn_metadata !== undefined) {\n    return message.authn_metadata;\n  } else if (message.metadata !== undefined) {\n    return message.metadata;\n  }\n  return null;\n}\n\nexport function getSignalingNotifyData(message: SignalingNotifyConnectionCreated): SignalingNotifyMetadata[] {\n  if (message.data && Array.isArray(message.data)) {\n    return message.data;\n  } else if (message.metadata_list && Array.isArray(message.metadata_list)) {\n    return message.metadata_list;\n  }\n  return [];\n}\n\nexport function getPreKeyBundle(message: JSONType): PreKeyBundle | null {\n  if (typeof message === \"object\" && message !== null && \"pre_key_bundle\" in message) {\n    return message.pre_key_bundle as PreKeyBundle;\n  }\n  return null;\n}\n\nexport function trace(clientId: string | null, title: string, value: unknown): void {\n  const dump = (record: unknown) => {\n    if (record && typeof record === \"object\") {\n      let keys = null;\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        keys = Object.keys(JSON.parse(JSON.stringify(record)));\n      } catch (_) {\n        // 何もしない\n      }\n      if (keys && Array.isArray(keys)) {\n        keys.forEach((key) => {\n          console.group(key);\n          dump((record as Record<string, unknown>)[key]);\n          console.groupEnd();\n        });\n      } else {\n        console.info(record);\n      }\n    } else {\n      console.info(record);\n    }\n  };\n  let prefix = \"\";\n  if (window.performance) {\n    prefix = \"[\" + (window.performance.now() / 1000).toFixed(3) + \"]\";\n  }\n  if (clientId) {\n    prefix = prefix + \"[\" + clientId + \"]\";\n  }\n\n  if (console.info !== undefined && console.group !== undefined) {\n    console.group(prefix + \" \" + title);\n    dump(value);\n    console.groupEnd();\n  } else {\n    console.log(prefix + \" \" + title + \"\\n\", value);\n  }\n}\n\nexport class ConnectError extends Error {\n  code?: number;\n  reason?: string;\n}\n\nexport function createSignalingEvent(eventType: string, data: unknown, transportType: TransportType): SignalingEvent {\n  const event = new Event(eventType) as SignalingEvent;\n  // data をコピーする\n  try {\n    event.data = JSON.parse(JSON.stringify(data)) as unknown;\n  } catch (_) {\n    event.data = data;\n  }\n  event.transportType = transportType;\n  return event;\n}\n\nexport function createDataChannelData(channel: RTCDataChannel): Record<string, unknown> {\n  return {\n    binaryType: channel.binaryType,\n    bufferedAmount: channel.bufferedAmount,\n    bufferedAmountLowThreshold: channel.bufferedAmountLowThreshold,\n    id: channel.id,\n    label: channel.label,\n    maxPacketLifeTime: channel.maxPacketLifeTime,\n    maxRetransmits: channel.maxRetransmits,\n    negotiated: channel.negotiated,\n    ordered: channel.ordered,\n    protocol: channel.protocol,\n    readyState: channel.readyState,\n    // @ts-ignore w3c 仕様には存在しない property\n    reliable: channel.reliable,\n  };\n}\n\nexport function createTimelineEvent(\n  eventType: string,\n  data: unknown,\n  logType: TimelineEventLogType,\n  dataChannelId?: number | null,\n  dataChannelLabel?: string\n): TimelineEvent {\n  const event = new Event(eventType) as TimelineEvent;\n  // data をコピーする\n  try {\n    event.data = JSON.parse(JSON.stringify(data)) as unknown;\n  } catch (_) {\n    event.data = data;\n  }\n  event.logType = logType;\n  event.dataChannelId = dataChannelId;\n  event.dataChannelLabel = dataChannelLabel;\n  return event;\n}\n\nexport function createDataChannelMessageEvent(label: string, data: ArrayBuffer): DataChannelMessageEvent {\n  const event = new Event(\"message\") as DataChannelMessageEvent;\n  event.label = label;\n  event.data = data;\n  return event;\n}\n\nexport function createDataChannelEvent(channel: DataChannelConfiguration): DataChannelEvent {\n  const event = new Event(\"datachannel\") as DataChannelEvent;\n  event.datachannel = channel;\n  return event;\n}\n\nexport function parseDataChannelEventData(eventData: unknown, compress: boolean): string {\n  if (compress) {\n    const unzlibMessage = unzlibSync(new Uint8Array(eventData as Uint8Array));\n    return new TextDecoder().decode(unzlibMessage);\n  }\n  return eventData as string;\n}\n","import { unzlibSync, zlibSync } from \"fflate\";\n\nimport {\n  ConnectError,\n  createDataChannelData,\n  createDataChannelEvent,\n  createDataChannelMessageEvent,\n  createSignalingEvent,\n  createSignalingMessage,\n  createTimelineEvent,\n  getPreKeyBundle,\n  getSignalingNotifyAuthnMetadata,\n  getSignalingNotifyData,\n  isSafari,\n  parseDataChannelEventData,\n  trace,\n} from \"./utils\";\nimport {\n  Callbacks,\n  ConnectionOptions,\n  JSONType,\n  DataChannelConfiguration,\n  SignalingConnectMessage,\n  SignalingMessage,\n  SignalingNotifyMessage,\n  SignalingOfferMessage,\n  SignalingOfferMessageDataChannel,\n  SignalingPingMessage,\n  SignalingPushMessage,\n  SignalingReOfferMessage,\n  SignalingRedirectMessage,\n  SignalingReqStatsMessage,\n  SignalingSwitchedMessage,\n  SignalingUpdateMessage,\n  SoraAbendTitle,\n  SoraCloseEvent,\n  SoraCloseEventInitDict,\n  SoraCloseEventType,\n  TransportType,\n} from \"./types\";\nimport SoraE2EE from \"@sora/e2ee\";\n\ndeclare global {\n  interface Algorithm {\n    namedCurve: string;\n  }\n}\n\n/**\n * Sora との WebRTC 接続を扱う基底クラス\n *\n * @param signalingUrlCandidates - シグナリングに使用する URL の候補\n * @param role - ロール\n * @param channelId - チャネルID\n * @param metadata - メタデータ\n * @param options - コネクションオプション\n * @param debug - デバッグフラグ\n */\nexport default class ConnectionBase {\n  /**\n   * ロール(sendonly | sendrecv | recvonly)\n   */\n  role: string;\n  /**\n   * チャネルID\n   */\n  channelId: string;\n  /**\n   * メタデータ\n   */\n  metadata: JSONType | undefined;\n  /**\n   * シグナリングに使用する URL 候補\n   */\n  signalingUrlCandidates: string | string[];\n  /**\n   * 接続オプション\n   */\n  options: ConnectionOptions;\n  /**\n   * PeerConnection に渡す configuration\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constraints: any;\n  /**\n   * デバッグフラグ\n   */\n  debug: boolean;\n  /**\n   * クライアントID\n   */\n  clientId: string | null;\n  /**\n   * コネクションID\n   */\n  connectionId: string | null;\n  /**\n   * リモートコネクションIDのリスト\n   */\n  remoteConnectionIds: string[];\n  /**\n   * メディアストリーム\n   */\n  stream: MediaStream | null;\n  /**\n   * type offer に含まれる認証 metadata\n   */\n  authMetadata: JSONType;\n  /**\n   * PeerConnection インスタンス\n   */\n  pc: RTCPeerConnection | null;\n  /**\n   * サイマルキャストで使用する RTCRtpEncodingParameters のリスト\n   */\n  encodings: RTCRtpEncodingParameters[];\n  /**\n   * WebSocket インスタンス\n   */\n  private ws: WebSocket | null;\n  /**\n   * 初回シグナリング時接続タイムアウト用のタイマーID\n   */\n  private connectionTimeoutTimerId: number;\n  /**\n   * WebSocket 切断監視用のタイマーID\n   */\n  private monitorSignalingWebSocketEventTimerId: number;\n  /**\n   * PeerConnection state 切断監視用のタイマーID\n   */\n  private monitorIceConnectionStateChangeTimerId: number;\n  /**\n   * 接続中の DataChannel リスト\n   */\n  private soraDataChannels: {\n    [key in string]?: RTCDataChannel;\n  };\n  /**\n   * 初回シグナリング接続時のタイムアウトに使用するタイムアウト時間(デフォルト 60000ms)\n   */\n  private connectionTimeout: number;\n  /**\n   * シグナリング候補のURLへの接続確認タイムアウトに使用するタイムアウト時間(デフォルト 3000ms)\n   */\n  private signalingCandidateTimeout: number;\n  /**\n   * 切断処理のタイムアウトに使用するタイムアウト時間(デフォルト 3000ms)\n   */\n  private disconnectWaitTimeout: number;\n  /**\n   * audio / video の msid\n   */\n  private mids: {\n    audio: string;\n    video: string;\n  };\n  /**\n   * シグナリングを DataChannel へ switch したかどうかのフラグ\n   */\n  private signalingSwitched: boolean;\n  /**\n   * シグナリング type offer に含まれる DataChannel レコード\n   */\n  private signalingOfferMessageDataChannels: {\n    [key in string]?: SignalingOfferMessageDataChannel;\n  };\n  /**\n   * イベントコールバックのリスト\n   */\n  protected callbacks: Callbacks;\n  /**\n   * E2EE インスタンス\n   */\n  protected e2ee: SoraE2EE | null;\n\n  constructor(\n    signalingUrlCandidates: string | string[],\n    role: string,\n    channelId: string,\n    metadata: JSONType,\n    options: ConnectionOptions,\n    debug: boolean\n  ) {\n    this.role = role;\n    this.channelId = channelId;\n    this.metadata = metadata;\n    this.signalingUrlCandidates = signalingUrlCandidates;\n    this.options = options;\n    // connection timeout の初期値をセットする\n    this.connectionTimeout = 60000;\n    if (typeof this.options.timeout === \"number\") {\n      console.warn(\"@deprecated timeout option will be removed in a future version. Use connectionTimeout.\");\n      this.connectionTimeout = this.options.timeout;\n    }\n    if (typeof this.options.connectionTimeout === \"number\") {\n      this.connectionTimeout = this.options.connectionTimeout;\n    }\n    // WebSocket/DataChannel の disconnect timeout の初期値をセットする\n    this.disconnectWaitTimeout = 3000;\n    if (typeof this.options.disconnectWaitTimeout === \"number\") {\n      this.disconnectWaitTimeout = this.options.disconnectWaitTimeout;\n    }\n    // signalingUrlCandidates に設定されている URL への接続チェック timeout の初期値をセットする\n    this.signalingCandidateTimeout = 3000;\n    if (typeof this.options.signalingCandidateTimeout === \"number\") {\n      this.signalingCandidateTimeout = this.options.signalingCandidateTimeout;\n    }\n    this.constraints = null;\n    this.debug = debug;\n    this.clientId = null;\n    this.connectionId = null;\n    this.remoteConnectionIds = [];\n    this.stream = null;\n    this.ws = null;\n    this.pc = null;\n    this.encodings = [];\n    this.callbacks = {\n      disconnect: (): void => {},\n      push: (): void => {},\n      addstream: (): void => {},\n      track: (): void => {},\n      removestream: (): void => {},\n      removetrack: (): void => {},\n      notify: (): void => {},\n      log: (): void => {},\n      timeout: (): void => {},\n      timeline: (): void => {},\n      signaling: (): void => {},\n      message: (): void => {},\n      datachannel: (): void => {},\n    };\n    this.authMetadata = null;\n    this.e2ee = null;\n    this.connectionTimeoutTimerId = 0;\n    this.monitorSignalingWebSocketEventTimerId = 0;\n    this.monitorIceConnectionStateChangeTimerId = 0;\n    this.soraDataChannels = {};\n    this.mids = {\n      audio: \"\",\n      video: \"\",\n    };\n    this.signalingSwitched = false;\n    this.signalingOfferMessageDataChannels = {};\n  }\n\n  /**\n   * SendRecv Object で発火するイベントのコールバックを設定するメソッド\n   *\n   * @example\n   * ```\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * sendrecv.on(\"track\", (event) => {\n   *   // callback 処理\n   * });\n   * ```\n   *\n   * @remarks\n   * addstream イベントは非推奨です. track イベントを使用してください\n   *\n   * removestream イベントは非推奨です. removetrack イベントを使用してください\n   *\n   * @param kind - イベントの種類(disconnect, push, track, removetrack, notify, log, timeout, timeline, signaling, message, datachannel)\n   * @param callback - コールバック関数\n   *\n   * @public\n   */\n  on<T extends keyof Callbacks, U extends Callbacks[T]>(kind: T, callback: U): void {\n    // @deprecated message\n    if (kind === \"addstream\") {\n      console.warn(\"@deprecated addstream callback will be removed in a future version. Use track callback.\");\n    } else if (kind === \"removestream\") {\n      console.warn(\"@deprecated removestream callback will be removed in a future version. Use removetrack callback.\");\n    }\n    if (kind in this.callbacks) {\n      this.callbacks[kind] = callback;\n    }\n  }\n\n  /**\n   * audio track を停止するメソッド\n   *\n   * @example\n   * ```\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * const mediaStream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n   * await sendrecv.connect(mediaStream);\n   *\n   * sendrecv.stopAudioTrack(mediaStream);\n   * ```\n   *\n   * @remarks\n   * stream の audio track を停止後、PeerConnection の senders から対象の sender を削除します\n   *\n   * @param stream - audio track を削除する MediaStream\n   *\n   * @public\n   */\n  stopAudioTrack(stream: MediaStream): Promise<void> {\n    for (const track of stream.getAudioTracks()) {\n      track.enabled = false;\n    }\n    return new Promise((resolve) => {\n      // すぐに stop すると視聴側に静止画像が残ってしまうので enabled false にした 100ms 後に stop する\n      setTimeout(async () => {\n        for (const track of stream.getAudioTracks()) {\n          track.stop();\n          stream.removeTrack(track);\n          if (this.pc !== null) {\n            const sender = this.pc.getSenders().find((s) => {\n              return s.track && s.track.id === track.id;\n            });\n            if (sender) {\n              await sender.replaceTrack(null);\n            }\n          }\n        }\n        resolve();\n      }, 100);\n    });\n  }\n\n  /**\n   * video track を停止するメソッド\n   *\n   * @example\n   * ```\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * const mediaStream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n   * await sendrecv.connect(mediaStream);\n   *\n   * sendrecv.stopVideoTrack(mediaStream);\n   * ```\n   *\n   * @remarks\n   * stream の video track を停止後、PeerConnection の senders から対象の sender を削除します\n   *\n   * @param stream - video track を削除する MediaStream\n   *\n   * @public\n   */\n  stopVideoTrack(stream: MediaStream): Promise<void> {\n    for (const track of stream.getVideoTracks()) {\n      track.enabled = false;\n    }\n    return new Promise((resolve) => {\n      // すぐに stop すると視聴側に静止画像が残ってしまうので enabled false にした 100ms 後に stop する\n      setTimeout(async () => {\n        for (const track of stream.getVideoTracks()) {\n          track.stop();\n          stream.removeTrack(track);\n          if (this.pc !== null) {\n            const sender = this.pc.getSenders().find((s) => {\n              return s.track && s.track.id === track.id;\n            });\n            if (sender) {\n              await sender.replaceTrack(null);\n            }\n          }\n        }\n        resolve();\n      }, 100);\n    });\n  }\n\n  /**\n   * audio track を入れ替えするメソッド\n   *\n   * @example\n   * ```\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * const mediaStream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n   * await sendrecv.connect(mediaStream);\n   *\n   * const replacedMediaStream = await navigator.mediaDevices.getUserMedia({audio: true});\n   * await sendrecv.replaceAudioTrack(mediaStream, replacedMediaStream.getAudioTracks()[0]);\n   * ```\n   *\n   * @remarks\n   * stream の audio track を停止後、新しい audio track をセットします\n   *\n   * @param stream - audio track を削除する MediaStream\n   * @param audioTrack - 新しい audio track\n   *\n   * @public\n   */\n  async replaceAudioTrack(stream: MediaStream, audioTrack: MediaStreamTrack): Promise<void> {\n    await this.stopAudioTrack(stream);\n    const transceiver = this.getAudioTransceiver();\n    if (transceiver === null) {\n      throw new Error(\"Unable to set an audio track. Audio track sender is undefined\");\n    }\n    stream.addTrack(audioTrack);\n    await transceiver.sender.replaceTrack(audioTrack);\n  }\n\n  /**\n   * video track を入れ替えするメソッド\n   *\n   * @example\n   * ```\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * const mediaStream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n   * await sendrecv.connect(mediaStream);\n   *\n   * const replacedMediaStream = await navigator.mediaDevices.getUserMedia({video: true});\n   * await sendrecv.replaceVideoTrack(mediaStream, replacedMediaStream.getVideoTracks()[0]);\n   * ```\n   *\n   * @remarks\n   * stream の video track を停止後、新しい video track をセットします\n   *\n   * @param stream - video track を削除する MediaStream\n   * @param videoTrack - 新しい video track\n   *\n   * @public\n   */\n  async replaceVideoTrack(stream: MediaStream, videoTrack: MediaStreamTrack): Promise<void> {\n    await this.stopVideoTrack(stream);\n    const transceiver = this.getVideoTransceiver();\n    if (transceiver === null) {\n      throw new Error(\"Unable to set video track. Video track sender is undefined\");\n    }\n    stream.addTrack(videoTrack);\n    await transceiver.sender.replaceTrack(videoTrack);\n  }\n\n  /**\n   * stream を停止するメソッド\n   */\n  private stopStream(): Promise<void> {\n    return new Promise((resolve, _) => {\n      if (this.debug) {\n        console.warn(\n          \"@deprecated closing MediaStream in disconnect will be removed in a future version. Close every track in the MediaStream by yourself.\"\n        );\n      }\n      if (!this.stream) {\n        return resolve();\n      }\n      this.stream.getTracks().forEach((t) => {\n        t.stop();\n      });\n      this.stream = null;\n      return resolve();\n    });\n  }\n\n  /**\n   * connect 処理中に例外が発生した場合の切断処理をするメソッド\n   */\n  private async signalingTerminate(): Promise<void> {\n    await this.stopStream();\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        dataChannel.close();\n      }\n      delete this.soraDataChannels[key];\n    }\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n    if (this.pc) {\n      this.pc.close();\n    }\n    if (this.e2ee) {\n      this.e2ee.terminateWorker();\n    }\n    this.initializeConnection();\n  }\n\n  /**\n   * PeerConnection の state に異常が発生した場合の切断処理をするメソッド\n   *\n   * @param title - disconnect callback に渡すイベントのタイトル\n   */\n  private async abendPeerConnectionState(title: SoraAbendTitle): Promise<void> {\n    this.clearMonitorIceConnectionStateChange();\n    await this.stopStream();\n    // callback を止める\n    if (this.pc) {\n      this.pc.ondatachannel = null;\n      this.pc.oniceconnectionstatechange = null;\n      this.pc.onicegatheringstatechange = null;\n      this.pc.onconnectionstatechange = null;\n    }\n    if (this.ws) {\n      // onclose はログを吐く専用に残す\n      this.ws.onclose = (event) => {\n        this.writeWebSocketTimelineLog(\"onclose\", { code: event.code, reason: event.reason });\n      };\n      this.ws.onmessage = null;\n      this.ws.onerror = null;\n    }\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        // onclose はログを吐く専用に残す\n        dataChannel.onclose = (event) => {\n          const channel = event.currentTarget as RTCDataChannel;\n          this.writeDataChannelTimelineLog(\"onclose\", channel);\n          this.trace(\"CLOSE DATA CHANNEL\", channel.label);\n        };\n        dataChannel.onmessage = null;\n        dataChannel.onerror = null;\n      }\n    }\n    // DataChannel を終了する\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        dataChannel.close();\n      }\n      delete this.soraDataChannels[key];\n    }\n    // WebSocket を終了する\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n    // PeerConnection を終了する\n    if (this.pc) {\n      this.pc.close();\n    }\n    // E2EE worker を終了する\n    if (this.e2ee) {\n      this.e2ee.terminateWorker();\n    }\n    this.initializeConnection();\n    const event = this.soraCloseEvent(\"abend\", title);\n    this.callbacks.disconnect(event);\n    this.writeSoraTimelineLog(\"disconnect-abend\", event);\n  }\n\n  /**\n   * 何かしらの異常があった場合の切断処理\n   *\n   * @param title - disconnect callback に渡すイベントのタイトル\n   * @param params - 切断時の状況を入れる Record\n   */\n  private async abend(title: SoraAbendTitle, params?: Record<string, unknown>): Promise<void> {\n    this.clearMonitorIceConnectionStateChange();\n    await this.stopStream();\n    // callback を止める\n    if (this.pc) {\n      this.pc.ondatachannel = null;\n      this.pc.oniceconnectionstatechange = null;\n      this.pc.onicegatheringstatechange = null;\n      this.pc.onconnectionstatechange = null;\n    }\n    if (this.ws) {\n      // onclose はログを吐く専用に残す\n      this.ws.onclose = (event) => {\n        this.writeWebSocketTimelineLog(\"onclose\", { code: event.code, reason: event.reason });\n      };\n      this.ws.onmessage = null;\n      this.ws.onerror = null;\n    }\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        // onclose はログを吐く専用に残す\n        dataChannel.onclose = (event) => {\n          const channel = event.currentTarget as RTCDataChannel;\n          this.writeDataChannelTimelineLog(\"onclose\", channel);\n          this.trace(\"CLOSE DATA CHANNEL\", channel.label);\n        };\n        dataChannel.onmessage = null;\n        dataChannel.onerror = null;\n      }\n    }\n    // 終了処理を開始する\n    if (this.soraDataChannels.signaling) {\n      const message = { type: \"disconnect\", reason: title };\n      if (\n        this.signalingOfferMessageDataChannels.signaling &&\n        this.signalingOfferMessageDataChannels.signaling.compress === true\n      ) {\n        const binaryMessage = new TextEncoder().encode(JSON.stringify(message));\n        const zlibMessage = zlibSync(binaryMessage, {});\n        if (this.soraDataChannels.signaling.readyState === \"open\") {\n          // Firefox で readyState が open でも DataChannel send で例外がでる場合があるため処理する\n          try {\n            this.soraDataChannels.signaling.send(zlibMessage);\n            this.writeDataChannelSignalingLog(\"send-disconnect\", this.soraDataChannels.signaling, message);\n          } catch (e) {\n            const errorMessage = (e as Error).message;\n            this.writeDataChannelSignalingLog(\n              \"failed-to-send-disconnect\",\n              this.soraDataChannels.signaling,\n              errorMessage\n            );\n          }\n        }\n      } else {\n        if (this.soraDataChannels.signaling.readyState === \"open\") {\n          // Firefox で readyState が open でも DataChannel send で例外がでる場合があるため処理する\n          try {\n            this.soraDataChannels.signaling.send(JSON.stringify(message));\n            this.writeDataChannelSignalingLog(\"send-disconnect\", this.soraDataChannels.signaling, message);\n          } catch (e) {\n            const errorMessage = (e as Error).message;\n            this.writeDataChannelSignalingLog(\n              \"failed-to-send-disconnect\",\n              this.soraDataChannels.signaling,\n              errorMessage\n            );\n          }\n        }\n      }\n    }\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        dataChannel.onerror = null;\n        dataChannel.close();\n      }\n      delete this.soraDataChannels[key];\n    }\n    await this.disconnectWebSocket(title);\n    await this.disconnectPeerConnection();\n    if (this.e2ee) {\n      this.e2ee.terminateWorker();\n    }\n    this.initializeConnection();\n    if (title === \"WEBSOCKET-ONCLOSE\" && params && (params.code === 1000 || params.code === 1005)) {\n      const event = this.soraCloseEvent(\"normal\", \"DISCONNECT\", params);\n      this.writeSoraTimelineLog(\"disconnect-normal\", event);\n      this.callbacks.disconnect(event);\n      return;\n    }\n    const event = this.soraCloseEvent(\"abend\", title, params);\n    this.writeSoraTimelineLog(\"disconnect-abend\", event);\n    this.callbacks.disconnect(this.soraCloseEvent(\"abend\", title, params));\n  }\n\n  /**\n   * 接続状態の初期化をするメソッド\n   */\n  private initializeConnection(): void {\n    this.clientId = null;\n    this.connectionId = null;\n    this.remoteConnectionIds = [];\n    this.stream = null;\n    this.ws = null;\n    this.pc = null;\n    this.encodings = [];\n    this.authMetadata = null;\n    this.e2ee = null;\n    this.soraDataChannels = {};\n    this.mids = {\n      audio: \"\",\n      video: \"\",\n    };\n    this.signalingSwitched = false;\n    this.signalingOfferMessageDataChannels = {};\n    this.clearConnectionTimeout();\n  }\n\n  /**\n   * WebSocket を切断するメソッド\n   *\n   * @remarks\n   * 正常/異常どちらの切断でも使用する\n   *\n   * @param title - type disconnect 時の reason\n   */\n  private disconnectWebSocket(title: SoraAbendTitle | \"NO-ERROR\"): Promise<{ code: number; reason: string } | null> {\n    let timerId = 0;\n    if (this.signalingSwitched) {\n      if (this.ws) {\n        this.ws.close();\n        this.ws = null;\n      }\n      return Promise.resolve(null);\n    }\n    return new Promise((resolve, _) => {\n      if (!this.ws) {\n        return resolve(null);\n      }\n      this.ws.onclose = (event) => {\n        if (this.ws) {\n          this.ws.close();\n          this.ws = null;\n        }\n        clearTimeout(timerId);\n        this.writeWebSocketTimelineLog(\"onclose\", { code: event.code, reason: event.reason });\n        return resolve({ code: event.code, reason: event.reason });\n      };\n      if (this.ws.readyState === 1) {\n        const message = { type: \"disconnect\", reason: title };\n        this.ws.send(JSON.stringify(message));\n        this.writeWebSocketSignalingLog(\"send-disconnect\", message);\n        // WebSocket 切断を待つ\n        timerId = setTimeout(() => {\n          if (this.ws) {\n            this.ws.close();\n            this.ws = null;\n          }\n          resolve({ code: 1006, reason: \"\" });\n        }, this.disconnectWaitTimeout);\n      } else {\n        // ws の state が open ではない場合は後処理をして終わる\n        this.ws.close();\n        this.ws = null;\n        return resolve(null);\n      }\n    });\n  }\n\n  /**\n   * DataChannel を切断するメソッド\n   *\n   * @remarks\n   * 正常/異常どちらの切断でも使用する\n   */\n  private disconnectDataChannel(): Promise<{ code: number; reason: string } | null> {\n    // DataChannel の強制終了処理\n    const closeDataChannels = () => {\n      for (const key of Object.keys(this.soraDataChannels)) {\n        const dataChannel = this.soraDataChannels[key];\n        if (dataChannel) {\n          dataChannel.onerror = null;\n          dataChannel.close();\n        }\n        delete this.soraDataChannels[key];\n      }\n    };\n    return new Promise((resolve, reject) => {\n      // DataChannel label signaling が存在しない場合は強制終了処理をする\n      if (!this.soraDataChannels.signaling) {\n        closeDataChannels();\n        return resolve({ code: 4999, reason: \"\" });\n      }\n      // disconnectWaitTimeout で指定された時間経過しても切断しない場合は強制終了処理をする\n      const disconnectWaitTimeoutId = setTimeout(() => {\n        closeDataChannels();\n        return reject();\n      }, this.disconnectWaitTimeout);\n\n      const onClosePromises: Promise<void>[] = [];\n      for (const key of Object.keys(this.soraDataChannels)) {\n        const dataChannel = this.soraDataChannels[key];\n        if (dataChannel) {\n          // onerror が発火した場合は強制終了処理をする\n          dataChannel.onerror = () => {\n            clearTimeout(disconnectWaitTimeoutId);\n            closeDataChannels();\n            return resolve({ code: 4999, reason: \"\" });\n          };\n          // すべての DataChannel の readyState が \"closed\" になったことを確認する Promsie を生成する\n          const p = (): Promise<void> => {\n            return new Promise((res, _) => {\n              // disconnectWaitTimeout 時間を過ぎた場合に終了させるための counter を作成する\n              let counter = 0;\n              // onclose 内で readyState の変化を待つと非同期のまま複数回 disconnect を呼んだ場合に\n              // callback が上書きされて必ず DISCONNECT-TIMEOUT になってしまうので setInterval を使う\n              const timerId = setInterval(() => {\n                counter++;\n                if (dataChannel.readyState === \"closed\") {\n                  clearInterval(timerId);\n                  res();\n                }\n                if (this.disconnectWaitTimeout < counter * 100) {\n                  res();\n                  clearInterval(timerId);\n                }\n              }, 100);\n            });\n          };\n          onClosePromises.push(p());\n        }\n      }\n      // すべての DataChannel で onclose が発火した場合は resolve にする\n      Promise.all(onClosePromises)\n        .then(() => {\n          // dataChannels が空の場合は切断処理が終わっているとみなす\n          if (0 === Object.keys(this.soraDataChannels).length) {\n            resolve(null);\n          } else {\n            resolve({ code: 4999, reason: \"\" });\n          }\n        })\n        .finally(() => {\n          closeDataChannels();\n          clearTimeout(disconnectWaitTimeoutId);\n        });\n      const message = { type: \"disconnect\", reason: \"NO-ERROR\" };\n      if (\n        this.signalingOfferMessageDataChannels.signaling &&\n        this.signalingOfferMessageDataChannels.signaling.compress === true\n      ) {\n        const binaryMessage = new TextEncoder().encode(JSON.stringify(message));\n        const zlibMessage = zlibSync(binaryMessage, {});\n        if (this.soraDataChannels.signaling.readyState === \"open\") {\n          // Firefox で readyState が open でも DataChannel send で例外がでる場合があるため処理する\n          try {\n            this.soraDataChannels.signaling.send(zlibMessage);\n            this.writeDataChannelSignalingLog(\"send-disconnect\", this.soraDataChannels.signaling, message);\n          } catch (e) {\n            const errorMessage = (e as Error).message;\n            this.writeDataChannelSignalingLog(\n              \"failed-to-send-disconnect\",\n              this.soraDataChannels.signaling,\n              errorMessage\n            );\n          }\n        }\n      } else {\n        if (this.soraDataChannels.signaling.readyState === \"open\") {\n          // Firefox で readyState が open でも DataChannel send で例外がでる場合があるため処理する\n          try {\n            this.soraDataChannels.signaling.send(JSON.stringify(message));\n            this.writeDataChannelSignalingLog(\"send-disconnect\", this.soraDataChannels.signaling, message);\n          } catch (e) {\n            const errorMessage = (e as Error).message;\n            this.writeDataChannelSignalingLog(\n              \"failed-to-send-disconnect\",\n              this.soraDataChannels.signaling,\n              errorMessage\n            );\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * PeerConnection を切断するメソッド\n   *\n   * @remarks\n   * 正常/異常どちらの切断でも使用する\n   */\n  private disconnectPeerConnection(): Promise<void> {\n    return new Promise((resolve, _) => {\n      if (this.pc && this.pc.connectionState !== \"closed\") {\n        this.pc.close();\n      }\n      return resolve();\n    });\n  }\n\n  /**\n   * 切断処理をするメソッド\n   *\n   * @example\n   * ```\n   * await sendrecv.disconnect();\n   * ```\n   *\n   * @public\n   */\n  async disconnect(): Promise<void> {\n    this.clearMonitorIceConnectionStateChange();\n    await this.stopStream();\n    // callback を止める\n    if (this.pc) {\n      this.pc.ondatachannel = null;\n      this.pc.oniceconnectionstatechange = null;\n      this.pc.onicegatheringstatechange = null;\n      this.pc.onconnectionstatechange = null;\n    }\n    if (this.ws) {\n      // onclose はログを吐く専用に残す\n      this.ws.onclose = (event) => {\n        this.writeWebSocketTimelineLog(\"onclose\", { code: event.code, reason: event.reason });\n      };\n      this.ws.onmessage = null;\n      this.ws.onerror = null;\n    }\n    for (const key of Object.keys(this.soraDataChannels)) {\n      const dataChannel = this.soraDataChannels[key];\n      if (dataChannel) {\n        dataChannel.onmessage = null;\n        // onclose はログを吐く専用に残す\n        dataChannel.onclose = (event): void => {\n          const channel = event.currentTarget as RTCDataChannel;\n          this.writeDataChannelTimelineLog(\"onclose\", channel);\n          this.trace(\"CLOSE DATA CHANNEL\", channel.label);\n        };\n      }\n    }\n    let event = null;\n    if (this.signalingSwitched) {\n      // DataChannel の切断処理がタイムアウトした場合は event を abend に差し替える\n      try {\n        const reason = await this.disconnectDataChannel();\n        if (reason !== null) {\n          event = this.soraCloseEvent(\"normal\", \"DISCONNECT\", reason);\n        }\n      } catch (_) {\n        event = this.soraCloseEvent(\"abend\", \"DISCONNECT-TIMEOUT\");\n      }\n      await this.disconnectWebSocket(\"NO-ERROR\");\n      await this.disconnectPeerConnection();\n    } else {\n      const reason = await this.disconnectWebSocket(\"NO-ERROR\");\n      await this.disconnectPeerConnection();\n      if (reason !== null) {\n        event = this.soraCloseEvent(\"normal\", \"DISCONNECT\", reason);\n      }\n    }\n    if (this.e2ee) {\n      this.e2ee.terminateWorker();\n    }\n    this.initializeConnection();\n    if (event) {\n      if (event.type === \"abend\") {\n        this.writeSoraTimelineLog(\"disconnect-abend\", event);\n      } else if (event.type === \"normal\") {\n        this.writeSoraTimelineLog(\"disconnect-normal\", event);\n      }\n      this.callbacks.disconnect(event);\n    }\n  }\n\n  /**\n   * E2EE の初期設定をするメソッド\n   */\n  protected setupE2EE(): void {\n    if (this.options.e2ee === true) {\n      this.e2ee = new SoraE2EE();\n      this.e2ee.onWorkerDisconnect = async (): Promise<void> => {\n        await this.abend(\"INTERNAL-ERROR\", { reason: \"CRASH-E2EE-WORKER\" });\n      };\n      this.e2ee.startWorker();\n    }\n  }\n\n  /**\n   * E2EE を開始するメソッド\n   */\n  protected startE2EE(): void {\n    if (this.options.e2ee === true && this.e2ee) {\n      if (!this.connectionId) {\n        const error = new Error();\n        error.message = `E2EE failed. Self connectionId is null`;\n        throw error;\n      }\n      this.e2ee.clearWorker();\n      const result = this.e2ee.start(this.connectionId);\n      this.e2ee.postSelfSecretKeyMaterial(this.connectionId, result.selfKeyId, result.selfSecretKeyMaterial);\n    }\n  }\n\n  /**\n   * シグナリングに使う WebSocket インスタンスを作成するメソッド\n   *\n   * @remarks\n   * シグナリング候補の URL 一覧に順に接続します\n   *\n   * 接続できた URL がない場合は例外が発生します\n   *\n   * @param signalingUrlCandidates - シグナリング候補の URL. 後方互換のため string | string[] を受け取る\n   *\n   * @returns\n   * 接続できた WebScoket インスタンスを返します\n   */\n  protected async getSignalingWebSocket(signalingUrlCandidates: string | string[]): Promise<WebSocket> {\n    if (typeof signalingUrlCandidates === \"string\") {\n      // signaling url の候補が文字列の場合\n      const signalingUrl = signalingUrlCandidates;\n      return new Promise((resolve, reject) => {\n        const ws = new WebSocket(signalingUrl);\n        ws.onclose = (event): void => {\n          const error = new ConnectError(\n            `Signaling failed. CloseEventCode:${event.code} CloseEventReason:'${event.reason}'`\n          );\n          error.code = event.code;\n          error.reason = event.reason;\n          this.writeWebSocketTimelineLog(\"onclose\", error);\n          reject(error);\n        };\n        ws.onopen = (_): void => {\n          resolve(ws);\n        };\n      });\n    } else if (Array.isArray(signalingUrlCandidates)) {\n      // signaling url の候補が Array の場合\n      // すでに候補の WebSocket が発見されているかどうかのフラグ\n      let resolved = false;\n      const testSignalingUrlCandidate = (signalingUrl: string): Promise<WebSocket> => {\n        return new Promise((resolve, reject) => {\n          const ws = new WebSocket(signalingUrl);\n          // 一定時間経過しても反応がなかった場合は処理を中断する\n          const timerId = setTimeout(() => {\n            this.writeWebSocketSignalingLog(\"signaling-url-canidate\", {\n              type: \"timeout\",\n              url: ws.url,\n            });\n            if (ws && !resolved) {\n              ws.onclose = null;\n              ws.onerror = null;\n              ws.onopen = null;\n              ws.close();\n              reject();\n            }\n          }, this.signalingCandidateTimeout);\n          ws.onclose = (event): void => {\n            this.writeWebSocketSignalingLog(\"signaling-url-canidate\", {\n              type: \"close\",\n              url: ws.url,\n              message: `WebSocket closed`,\n              code: event.code,\n              reason: event.reason,\n            });\n            if (ws) {\n              ws.close();\n            }\n            clearInterval(timerId);\n            reject();\n          };\n          ws.onerror = (_): void => {\n            this.writeWebSocketSignalingLog(\"signaling-url-canidate\", {\n              type: \"error\",\n              url: ws.url,\n              message: `Failed to connect WebSocket`,\n            });\n            if (ws) {\n              ws.onclose = null;\n              ws.close();\n            }\n            clearInterval(timerId);\n            reject();\n          };\n          ws.onopen = (_): void => {\n            if (ws) {\n              clearInterval(timerId);\n              if (resolved) {\n                this.writeWebSocketSignalingLog(\"signaling-url-canidate\", {\n                  type: \"open\",\n                  url: ws.url,\n                  selected: false,\n                });\n                ws.onerror = null;\n                ws.onclose = null;\n                ws.onopen = null;\n                ws.close();\n                reject();\n              } else {\n                this.writeWebSocketSignalingLog(\"signaling-url-canidate\", {\n                  type: \"open\",\n                  url: ws.url,\n                  selected: true,\n                });\n                ws.onerror = null;\n                ws.onclose = null;\n                ws.onopen = null;\n                resolved = true;\n                resolve(ws);\n              }\n            }\n          };\n        });\n      };\n      try {\n        return await Promise.any(signalingUrlCandidates.map((signalingUrl) => testSignalingUrlCandidate(signalingUrl)));\n      } catch (e) {\n        throw new ConnectError(\"Signaling failed. All signaling URL candidates failed to connect\");\n      }\n    }\n    throw new ConnectError(\"Signaling failed. Invalid format signaling URL candidates\");\n  }\n\n  /**\n   * シグナリング処理を行うメソッド\n   *\n   * @remarks\n   * シグナリング候補の URL 一覧に順に接続します\n   *\n   * 接続できた URL がない場合は例外が発生します\n   *\n   * @param ws - WebSocket インスタンス\n   * @param redirect - クラスター接続時にリダイレクトされた場合のフラグ\n   *\n   * @returns\n   * Sora から受け取った type offer メッセージを返します\n   */\n  protected async signaling(ws: WebSocket, redirect = false): Promise<SignalingOfferMessage> {\n    const offer = await this.createOffer();\n    this.trace(\"CREATE OFFER\", offer);\n    return new Promise((resolve, reject) => {\n      this.writeWebSocketSignalingLog(\"new-websocket\", ws.url);\n      // websocket の各 callback を設定する\n      ws.binaryType = \"arraybuffer\";\n      ws.onclose = async (event): Promise<void> => {\n        const error = new ConnectError(\n          `Signaling failed. CloseEventCode:${event.code} CloseEventReason:'${event.reason}'`\n        );\n        error.code = event.code;\n        error.reason = event.reason;\n        this.writeWebSocketTimelineLog(\"onclose\", error);\n        await this.signalingTerminate();\n        reject(error);\n      };\n      ws.onmessage = async (event): Promise<void> => {\n        // E2EE 時専用処理\n        if (event.data instanceof ArrayBuffer) {\n          this.writeWebSocketSignalingLog(\"onmessage-e2ee\", event.data);\n          this.signalingOnMessageE2EE(event.data);\n          return;\n        }\n        if (typeof event.data !== \"string\") {\n          throw new Error(\"Received invalid signaling data\");\n        }\n        const message = JSON.parse(event.data) as SignalingMessage;\n        if (message.type == \"offer\") {\n          this.writeWebSocketSignalingLog(\"onmessage-offer\", message);\n          this.signalingOnMessageTypeOffer(message);\n          resolve(message);\n        } else if (message.type == \"update\") {\n          this.writeWebSocketSignalingLog(\"onmessage-update\", message);\n          await this.signalingOnMessageTypeUpdate(message);\n        } else if (message.type == \"re-offer\") {\n          this.writeWebSocketSignalingLog(\"onmessage-re-offer\", message);\n          await this.signalingOnMessageTypeReOffer(message);\n        } else if (message.type == \"ping\") {\n          await this.signalingOnMessageTypePing(message);\n        } else if (message.type == \"push\") {\n          this.callbacks.push(message, \"websocket\");\n        } else if (message.type == \"notify\") {\n          if (message.event_type === \"connection.created\") {\n            this.writeWebSocketTimelineLog(\"notify-connection.created\", message);\n          } else if (message.event_type === \"connection.destroyed\") {\n            this.writeWebSocketTimelineLog(\"notify-connection.destroyed\", message);\n          }\n          this.signalingOnMessageTypeNotify(message, \"websocket\");\n        } else if (message.type == \"switched\") {\n          this.writeWebSocketSignalingLog(\"onmessage-switched\", message);\n          this.signalingOnMessageTypeSwitched(message);\n        } else if (message.type == \"redirect\") {\n          this.writeWebSocketSignalingLog(\"onmessage-redirect\", message);\n          try {\n            const redirectMessage = await this.signalingOnMessageTypeRedirect(message);\n            resolve(redirectMessage);\n          } catch (error) {\n            reject(error);\n          }\n        }\n      };\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      (async () => {\n        let signalingMessage: SignalingConnectMessage;\n        try {\n          signalingMessage = createSignalingMessage(\n            offer.sdp || \"\",\n            this.role,\n            this.channelId,\n            this.metadata,\n            this.options,\n            redirect\n          );\n        } catch (error) {\n          reject(error);\n          return;\n        }\n        if (signalingMessage.e2ee && this.e2ee) {\n          const initResult = await this.e2ee.init();\n          // @ts-ignore signalingMessage の e2ee が true の場合は signalingNotifyMetadata が必ず object になる\n          signalingMessage[\"signaling_notify_metadata\"][\"pre_key_bundle\"] = initResult;\n        }\n        this.trace(\"SIGNALING CONNECT MESSAGE\", signalingMessage);\n        if (ws) {\n          ws.send(JSON.stringify(signalingMessage));\n          this.writeWebSocketSignalingLog(`send-${signalingMessage.type}`, signalingMessage);\n          this.ws = ws;\n        }\n      })();\n    });\n  }\n\n  /**\n   * PeerConnection 接続処理をするメソッド\n   *\n   * @param message - シグナリング処理で受け取った type offer メッセージ\n   */\n  protected async connectPeerConnection(message: SignalingOfferMessage): Promise<void> {\n    let config = Object.assign({}, message.config);\n    if (this.e2ee) {\n      // @ts-ignore https://w3c.github.io/webrtc-encoded-transform/#specification\n      config = Object.assign({ encodedInsertableStreams: true }, config);\n    }\n    if (window.RTCPeerConnection.generateCertificate !== undefined) {\n      const certificate = await window.RTCPeerConnection.generateCertificate({ name: \"ECDSA\", namedCurve: \"P-256\" });\n      config = Object.assign({ certificates: [certificate] }, config);\n    }\n    this.trace(\"PEER CONNECTION CONFIG\", config);\n    this.writePeerConnectionTimelineLog(\"new-peerconnection\", config);\n    // @ts-ignore Chrome の場合は第2引数に goog オプションを渡すことができる\n    this.pc = new window.RTCPeerConnection(config, this.constraints);\n    this.pc.oniceconnectionstatechange = (_): void => {\n      if (this.pc) {\n        this.writePeerConnectionTimelineLog(\"oniceconnectionstatechange\", {\n          connectionState: this.pc.connectionState,\n          iceConnectionState: this.pc.iceConnectionState,\n          iceGatheringState: this.pc.iceGatheringState,\n        });\n        this.trace(\"ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE\", this.pc.iceConnectionState);\n      }\n    };\n    this.pc.onicegatheringstatechange = (_): void => {\n      if (this.pc) {\n        this.writePeerConnectionTimelineLog(\"onicegatheringstatechange\", {\n          connectionState: this.pc.connectionState,\n          iceConnectionState: this.pc.iceConnectionState,\n          iceGatheringState: this.pc.iceGatheringState,\n        });\n      }\n    };\n    this.pc.onconnectionstatechange = (_): void => {\n      if (this.pc) {\n        this.writePeerConnectionTimelineLog(\"onconnectionstatechange\", {\n          connectionState: this.pc.connectionState,\n          iceConnectionState: this.pc.iceConnectionState,\n          iceGatheringState: this.pc.iceGatheringState,\n        });\n      }\n    };\n    this.pc.ondatachannel = (event): void => {\n      this.onDataChannel(event);\n    };\n    return;\n  }\n\n  /**\n   * setRemoteDescription 処理を行うメソッド\n   *\n   * @param message - シグナリング処理で受け取った type offer | type update | type re-offer メッセージ\n   */\n  protected async setRemoteDescription(\n    message: SignalingOfferMessage | SignalingUpdateMessage | SignalingReOfferMessage\n  ): Promise<void> {\n    if (!this.pc) {\n      return;\n    }\n    const sessionDescription = new RTCSessionDescription({ type: \"offer\", sdp: message.sdp });\n    await this.pc.setRemoteDescription(sessionDescription);\n    this.writePeerConnectionTimelineLog(\"set-remote-description\", sessionDescription);\n    return;\n  }\n\n  /**\n   * createAnswer 処理を行うメソッド\n   *\n   * @remarks\n   * サイマルキャスト用の setParameters 処理もここで行う\n   *\n   * @param message - シグナリング処理で受け取った type offer | type update | type re-offer メッセージ\n   */\n  protected async createAnswer(\n    message: SignalingOfferMessage | SignalingUpdateMessage | SignalingReOfferMessage\n  ): Promise<void> {\n    if (!this.pc) {\n      return;\n    }\n    // mid と transceiver.direction を合わせる\n    for (const mid of Object.values(this.mids)) {\n      const transceiver = this.pc.getTransceivers().find((t) => t.mid === mid);\n      if (transceiver && transceiver.direction === \"recvonly\") {\n        transceiver.direction = \"sendrecv\";\n      }\n    }\n    // simulcast の場合\n    if (this.options.simulcast && (this.role === \"sendrecv\" || this.role === \"sendonly\")) {\n      const transceiver = this.pc.getTransceivers().find((t) => {\n        if (t.mid === null) {\n          return;\n        }\n        if (t.sender.track === null) {\n          return;\n        }\n        if (t.currentDirection !== null && t.currentDirection !== \"sendonly\") {\n          return;\n        }\n        if (this.mids.video !== \"\" && this.mids.video === t.mid) {\n          return t;\n        }\n        if (0 <= t.mid.indexOf(\"video\")) {\n          return t;\n        }\n      });\n      if (transceiver) {\n        await this.setSenderParameters(transceiver, this.encodings);\n        await this.setRemoteDescription(message);\n        this.trace(\"TRANSCEIVER SENDER GET_PARAMETERS\", transceiver.sender.getParameters());\n        // setRemoteDescription 後でないと active が反映されないのでもう一度呼ぶ\n        await this.setSenderParameters(transceiver, this.encodings);\n        const sessionDescription = await this.pc.createAnswer();\n        await this.pc.setLocalDescription(sessionDescription);\n        this.trace(\"TRANSCEIVER SENDER GET_PARAMETERS\", transceiver.sender.getParameters());\n        return;\n      }\n    }\n    const sessionDescription = await this.pc.createAnswer();\n    this.writePeerConnectionTimelineLog(\"create-answer\", sessionDescription);\n    await this.pc.setLocalDescription(sessionDescription);\n    this.writePeerConnectionTimelineLog(\"set-local-description\", sessionDescription);\n    return;\n  }\n\n  /**\n   * シグナリングサーバーに type answer を投げるメソッド\n   */\n  protected sendAnswer(): void {\n    if (this.pc && this.ws && this.pc.localDescription) {\n      this.trace(\"ANSWER SDP\", this.pc.localDescription.sdp);\n      const message = { type: \"answer\", sdp: this.pc.localDescription.sdp };\n      this.ws.send(JSON.stringify(message));\n      this.writeWebSocketSignalingLog(\"send-answer\", message);\n    }\n    return;\n  }\n\n  /**\n   * iceCnadidate 処理をするメソッド\n   */\n  protected onIceCandidate(): Promise<void> {\n    return new Promise((resolve, _) => {\n      if (this.pc) {\n        this.pc.oniceconnectionstatechange = (_): void => {\n          if (this.pc) {\n            this.writePeerConnectionTimelineLog(\"oniceconnectionstatechange\", {\n              connectionState: this.pc.connectionState,\n              iceConnectionState: this.pc.iceConnectionState,\n              iceGatheringState: this.pc.iceGatheringState,\n            });\n            this.trace(\"ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE\", this.pc.iceConnectionState);\n            if (this.pc.iceConnectionState === \"connected\") {\n              resolve();\n            }\n          }\n        };\n        this.pc.onicecandidate = (event): void => {\n          this.writePeerConnectionTimelineLog(\"onicecandidate\", event.candidate);\n          if (this.pc) {\n            this.trace(\"ONICECANDIDATE ICEGATHERINGSTATE\", this.pc.iceGatheringState);\n          }\n          // TODO(yuito): Firefox は <empty string> を投げてくるようになったので対応する\n          if (event.candidate === null) {\n            resolve();\n          } else {\n            const candidate = event.candidate.toJSON();\n            const message = Object.assign(candidate, { type: \"candidate\" }) as { type: string; [key: string]: unknown };\n            this.trace(\"ONICECANDIDATE CANDIDATE MESSAGE\", message);\n            this.sendSignalingMessage(message);\n          }\n        };\n      }\n    });\n  }\n\n  /**\n   * connectionState が \"connected\" になるのを監視するメソッド\n   *\n   * @remarks\n   * PeerConnection.connectionState が実装されていない場合は何もしない\n   */\n  protected waitChangeConnectionStateConnected(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      // connectionState が存在しない場合はそのまま抜ける\n      if (this.pc && this.pc.connectionState === undefined) {\n        resolve();\n        return;\n      }\n      const timerId = setInterval(() => {\n        if (!this.pc) {\n          const error = new Error();\n          error.message = \"PeerConnection connectionState did not change to 'connected'\";\n          clearInterval(timerId);\n          reject(error);\n        } else if (this.pc && this.pc.connectionState === \"connected\") {\n          clearInterval(timerId);\n          resolve();\n        }\n      }, 10);\n    });\n  }\n\n  /**\n   * 初回シグナリング接続時の WebSocket の切断を監視するメソッド\n   *\n   * @remarks\n   * 意図しない切断があった場合には異常終了処理を実行する\n   */\n  protected monitorSignalingWebSocketEvent(): Promise<void> {\n    return new Promise((_, reject) => {\n      this.monitorSignalingWebSocketEventTimerId = setInterval(() => {\n        if (!this.ws) {\n          return;\n        }\n        this.clearMonitorSignalingWebSocketEvent();\n        this.ws.onclose = async (event) => {\n          const error = new ConnectError(\n            `Signaling failed. CloseEventCode:${event.code} CloseEventReason:'${event.reason}'`\n          );\n          error.code = event.code;\n          error.reason = event.reason;\n          this.writeWebSocketTimelineLog(\"onclose\", error);\n          await this.signalingTerminate();\n          reject(error);\n        };\n        this.ws.onerror = async (_) => {\n          const error = new ConnectError(`Signaling failed. WebSocket onerror was called`);\n          this.writeWebSocketSignalingLog(\"onerror\", error);\n          await this.signalingTerminate();\n          reject(error);\n        };\n      }, 100);\n    });\n  }\n\n  /**\n   * WebSocket の切断を監視するメソッド\n   *\n   * @remarks\n   * 意図しない切断があった場合には異常終了処理を実行する\n   */\n  protected monitorWebSocketEvent(): void {\n    if (!this.ws) {\n      return;\n    }\n    this.ws.onclose = async (event) => {\n      this.writeWebSocketTimelineLog(\"onclose\", { code: event.code, reason: event.reason });\n      await this.abend(\"WEBSOCKET-ONCLOSE\", { code: event.code, reason: event.reason });\n    };\n    this.ws.onerror = async (_) => {\n      this.writeWebSocketSignalingLog(\"onerror\");\n      await this.abend(\"WEBSOCKET-ONERROR\");\n    };\n  }\n\n  /**\n   * 初回シグナリング後 PeerConnection の state を監視するメソッド\n   *\n   * @remarks\n   * connectionState, iceConnectionState を監視して不正な場合に切断する\n   */\n  protected monitorPeerConnectionState(): void {\n    if (!this.pc) {\n      return;\n    }\n    this.pc.oniceconnectionstatechange = async (_): Promise<void> => {\n      // connectionState が undefined の場合は iceConnectionState を見て判定する\n      if (this.pc && this.pc.connectionState === undefined) {\n        this.writePeerConnectionTimelineLog(\"oniceconnectionstatechange\", {\n          connectionState: this.pc.connectionState,\n          iceConnectionState: this.pc.iceConnectionState,\n          iceGatheringState: this.pc.iceGatheringState,\n        });\n        this.trace(\"ONICECONNECTIONSTATECHANGE ICECONNECTIONSTATE\", this.pc.iceConnectionState);\n        clearTimeout(this.monitorIceConnectionStateChangeTimerId);\n        // iceConnectionState \"failed\" で切断する\n        if (this.pc.iceConnectionState === \"failed\") {\n          await this.abendPeerConnectionState(\"ICE-CONNECTION-STATE-FAILED\");\n        }\n        // iceConnectionState \"disconnected\" になってから 10000ms の間変化がない場合切断する\n        else if (this.pc.iceConnectionState === \"disconnected\") {\n          this.monitorIceConnectionStateChangeTimerId = setTimeout(async () => {\n            if (this.pc && this.pc.iceConnectionState === \"disconnected\") {\n              await this.abendPeerConnectionState(\"ICE-CONNECTION-STATE-DISCONNECTED-TIMEOUT\");\n            }\n          }, 10000);\n        }\n      }\n    };\n    this.pc.onconnectionstatechange = async (_): Promise<void> => {\n      if (this.pc) {\n        this.writePeerConnectionTimelineLog(\"onconnectionstatechange\", {\n          connectionState: this.pc.connectionState,\n          iceConnectionState: this.pc.iceConnectionState,\n          iceGatheringState: this.pc.iceGatheringState,\n        });\n        if (this.pc.connectionState === \"failed\") {\n          await this.abendPeerConnectionState(\"CONNECTION-STATE-FAILED\");\n        }\n      }\n    };\n  }\n\n  /**\n   * 初回シグナリングの接続タイムアウト処理をするメソッド\n   */\n  protected setConnectionTimeout(): Promise<MediaStream> {\n    return new Promise((_, reject) => {\n      if (0 < this.connectionTimeout) {\n        this.connectionTimeoutTimerId = setTimeout(async () => {\n          if (\n            !this.pc ||\n            (this.pc && this.pc.connectionState !== undefined && this.pc.connectionState !== \"connected\")\n          ) {\n            const error = new Error();\n            error.message = \"Signaling connection timeout\";\n            this.callbacks.timeout();\n            this.trace(\"DISCONNECT\", \"Signaling connection timeout\");\n            this.writePeerConnectionTimelineLog(\"signaling-connection-timeout\", {\n              connectionTimeout: this.connectionTimeout,\n            });\n            await this.signalingTerminate();\n            reject(error);\n          }\n        }, this.connectionTimeout);\n      }\n    });\n  }\n\n  /**\n   * setConnectionTimeout でセットしたタイマーを止めるメソッド\n   */\n  protected clearConnectionTimeout(): void {\n    clearTimeout(this.connectionTimeoutTimerId);\n  }\n\n  /**\n   * monitorSignalingWebSocketEvent でセットしたタイマーを止めるメソッド\n   */\n  protected clearMonitorSignalingWebSocketEvent(): void {\n    clearInterval(this.monitorSignalingWebSocketEventTimerId);\n  }\n\n  /**\n   * monitorPeerConnectionState でセットしたタイマーを止めるメソッド\n   */\n  protected clearMonitorIceConnectionStateChange(): void {\n    clearInterval(this.monitorIceConnectionStateChangeTimerId);\n  }\n\n  /**\n   * trace log を出力するメソッド\n   *\n   * @param title - ログのタイトル\n   * @param message - ログの本文\n   */\n  protected trace(title: string, message: unknown): void {\n    this.callbacks.log(title, message as JSONType);\n    if (!this.debug) {\n      return;\n    }\n    trace(this.clientId, title, message);\n  }\n\n  /**\n   * WebSocket のシグナリングログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writeWebSocketSignalingLog(eventType: string, data?: unknown): void {\n    this.callbacks.signaling(createSignalingEvent(eventType, data, \"websocket\"));\n    this.writeWebSocketTimelineLog(eventType, data);\n  }\n\n  /**\n   * DataChannel のシグナリングログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writeDataChannelSignalingLog(eventType: string, channel: RTCDataChannel, data?: unknown): void {\n    this.callbacks.signaling(createSignalingEvent(eventType, data, \"datachannel\"));\n    this.writeDataChannelTimelineLog(eventType, channel, data);\n  }\n\n  /**\n   * WebSocket のタイムラインログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writeWebSocketTimelineLog(eventType: string, data?: unknown): void {\n    const event = createTimelineEvent(eventType, data, \"websocket\");\n    this.callbacks.timeline(event);\n  }\n\n  /**\n   * DataChannel のタイムラインログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writeDataChannelTimelineLog(eventType: string, channel: RTCDataChannel, data?: unknown): void {\n    const event = createTimelineEvent(eventType, data, \"datachannel\", channel.id, channel.label);\n    this.callbacks.timeline(event);\n  }\n\n  /**\n   * PeerConnection のタイムラインログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writePeerConnectionTimelineLog(eventType: string, data?: unknown): void {\n    const event = createTimelineEvent(eventType, data, \"peerconnection\");\n    this.callbacks.timeline(event);\n  }\n\n  /**\n   * Sora との接続のタイムラインログ処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   */\n  protected writeSoraTimelineLog(eventType: string, data?: unknown): void {\n    const event = createTimelineEvent(eventType, data, \"sora\");\n    this.callbacks.timeline(event);\n  }\n\n  /**\n   * createOffer 処理をするメソッド\n   *\n   * @param eventType - イベントタイプ\n   * @param data - イベントデータ\n   *\n   * @returns\n   * 生成した RTCSessionDescription を返します\n   */\n  private async createOffer(): Promise<RTCSessionDescriptionInit> {\n    const config = { iceServers: [] };\n    const pc = new window.RTCPeerConnection(config);\n    if (isSafari()) {\n      pc.addTransceiver(\"video\", { direction: \"recvonly\" });\n      pc.addTransceiver(\"audio\", { direction: \"recvonly\" });\n      const offer = await pc.createOffer();\n      pc.close();\n      this.writePeerConnectionTimelineLog(\"create-offer\", offer);\n      return offer;\n    }\n    const offer = await pc.createOffer({ offerToReceiveAudio: true, offerToReceiveVideo: true });\n    pc.close();\n    this.writePeerConnectionTimelineLog(\"create-offer\", offer);\n    return offer;\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type e2ee メッセージを処理をするメソッド\n   *\n   * @param data - E2EE 用バイナリメッセージ\n   */\n  private signalingOnMessageE2EE(data: ArrayBuffer): void {\n    if (this.e2ee) {\n      const message = new Uint8Array(data);\n      const result = this.e2ee.receiveMessage(message);\n      this.e2ee.postRemoteSecretKeyMaterials(result);\n      result.messages.forEach((message) => {\n        this.sendE2EEMessage(message.buffer);\n      });\n    }\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type offer メッセージを処理をするメソッド\n   *\n   * @param message - type offer メッセージ\n   */\n  private signalingOnMessageTypeOffer(message: SignalingOfferMessage): void {\n    this.clientId = message.client_id;\n    this.connectionId = message.connection_id;\n    if (message.metadata !== undefined) {\n      this.authMetadata = message.metadata;\n    }\n    if (Array.isArray(message.encodings)) {\n      this.encodings = message.encodings;\n    }\n    if (message.mid !== undefined && message.mid.audio !== undefined) {\n      this.mids.audio = message.mid.audio;\n    }\n    if (message.mid !== undefined && message.mid.video !== undefined) {\n      this.mids.video = message.mid.video;\n    }\n    if (message.data_channels) {\n      for (const dc of message.data_channels) {\n        this.signalingOfferMessageDataChannels[dc.label] = dc;\n      }\n    }\n    this.trace(\"SIGNALING OFFER MESSAGE\", message);\n    this.trace(\"OFFER SDP\", message.sdp);\n  }\n\n  /**\n   * シグナリングサーバーに type update を投げるメソッド\n   */\n  private sendUpdateAnswer(): void {\n    if (this.pc && this.ws && this.pc.localDescription) {\n      this.trace(\"ANSWER SDP\", this.pc.localDescription.sdp);\n      this.sendSignalingMessage({ type: \"update\", sdp: this.pc.localDescription.sdp });\n    }\n  }\n\n  /**\n   * シグナリングサーバーに type re-answer を投げるメソッド\n   */\n  private sendReAnswer(): void {\n    if (this.pc && this.pc.localDescription) {\n      this.trace(\"RE ANSWER SDP\", this.pc.localDescription.sdp);\n      this.sendSignalingMessage({ type: \"re-answer\", sdp: this.pc.localDescription.sdp });\n    }\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type update メッセージを処理をするメソッド\n   *\n   * @param message - type update メッセージ\n   */\n  private async signalingOnMessageTypeUpdate(message: SignalingUpdateMessage): Promise<void> {\n    this.trace(\"SIGNALING UPDATE MESSGE\", message);\n    this.trace(\"UPDATE SDP\", message.sdp);\n    await this.setRemoteDescription(message);\n    await this.createAnswer(message);\n    this.sendUpdateAnswer();\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type re-offer メッセージを処理をするメソッド\n   *\n   * @param message - type re-offer メッセージ\n   */\n  private async signalingOnMessageTypeReOffer(message: SignalingReOfferMessage): Promise<void> {\n    this.trace(\"SIGNALING RE OFFER MESSGE\", message);\n    this.trace(\"RE OFFER SDP\", message.sdp);\n    await this.setRemoteDescription(message);\n    await this.createAnswer(message);\n    this.sendReAnswer();\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type ping メッセージを処理をするメソッド\n   *\n   * @param message - type ping メッセージ\n   */\n  private async signalingOnMessageTypePing(message: SignalingPingMessage): Promise<void> {\n    const pongMessage: { type: \"pong\"; stats?: RTCStatsReport[] } = { type: \"pong\" };\n    if (message.stats) {\n      const stats = await this.getStats();\n      pongMessage.stats = stats;\n    }\n    if (this.ws) {\n      this.ws.send(JSON.stringify(pongMessage));\n    }\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type notify メッセージを処理をするメソッド\n   *\n   * @param message - type notify メッセージ\n   */\n  private signalingOnMessageTypeNotify(message: SignalingNotifyMessage, transportType: TransportType): void {\n    if (message.event_type === \"connection.created\") {\n      const connectionId = message.connection_id;\n      if (this.connectionId !== connectionId) {\n        const authnMetadata = getSignalingNotifyAuthnMetadata(message);\n        const preKeyBundle = getPreKeyBundle(authnMetadata);\n        if (preKeyBundle && this.e2ee && connectionId) {\n          const result = this.e2ee.startSession(connectionId, preKeyBundle);\n          this.e2ee.postRemoteSecretKeyMaterials(result);\n          result.messages.forEach((message) => {\n            this.sendE2EEMessage(message.buffer);\n          });\n          // messages を送信し終えてから、selfSecretKeyMaterial を更新する\n          this.e2ee.postSelfSecretKeyMaterial(result.selfConnectionId, result.selfKeyId, result.selfSecretKeyMaterial);\n        }\n      }\n      const data = getSignalingNotifyData(message);\n      data.forEach((metadata) => {\n        const authnMetadata = getSignalingNotifyAuthnMetadata(metadata);\n        const preKeyBundle = getPreKeyBundle(authnMetadata);\n        const connectionId = metadata.connection_id;\n        if (connectionId && this.e2ee && preKeyBundle) {\n          this.e2ee.addPreKeyBundle(connectionId, preKeyBundle);\n        }\n      });\n    } else if (message.event_type === \"connection.destroyed\") {\n      const authnMetadata = getSignalingNotifyAuthnMetadata(message);\n      const preKeyBundle = getPreKeyBundle(authnMetadata);\n      const connectionId = message.connection_id;\n      if (preKeyBundle && this.e2ee && connectionId) {\n        const result = this.e2ee.stopSession(connectionId);\n        this.e2ee.postSelfSecretKeyMaterial(\n          result.selfConnectionId,\n          result.selfKeyId,\n          result.selfSecretKeyMaterial,\n          5000\n        );\n        result.messages.forEach((message) => {\n          this.sendE2EEMessage(message.buffer);\n        });\n        this.e2ee.postRemoveRemoteDeriveKey(connectionId);\n      }\n    }\n    this.callbacks.notify(message, transportType);\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type switched メッセージを処理をするメソッド\n   *\n   * @param message - type switched メッセージ\n   */\n  private signalingOnMessageTypeSwitched(message: SignalingSwitchedMessage): void {\n    this.signalingSwitched = true;\n    if (!this.ws) {\n      return;\n    }\n    if (message[\"ignore_disconnect_websocket\"]) {\n      if (this.ws) {\n        this.ws.onclose = null;\n        this.ws.close();\n        this.ws = null;\n      }\n      this.writeWebSocketSignalingLog(\"close\");\n    }\n    for (const channel of this.datachannels) {\n      this.callbacks.datachannel(createDataChannelEvent(channel));\n    }\n  }\n\n  /**\n   * シグナリングサーバーから受け取った type redirect メッセージを処理をするメソッド\n   *\n   * @param message - type redirect メッセージ\n   */\n  private async signalingOnMessageTypeRedirect(message: SignalingRedirectMessage): Promise<SignalingOfferMessage> {\n    if (this.ws) {\n      this.ws.onclose = null;\n      this.ws.onerror = null;\n      this.ws.close();\n      this.ws = null;\n    }\n    const ws = await this.getSignalingWebSocket(message.location);\n    const signalingMessage = await this.signaling(ws, true);\n    return signalingMessage;\n  }\n\n  /**\n   * sender の parameters に encodings をセットするメソッド\n   *\n   * @remarks\n   * サイマルキャスト用の処理\n   */\n  private async setSenderParameters(\n    transceiver: RTCRtpTransceiver,\n    encodings: RTCRtpEncodingParameters[]\n  ): Promise<void> {\n    const originalParameters = transceiver.sender.getParameters();\n    // @ts-ignore\n    originalParameters.encodings = encodings;\n    await transceiver.sender.setParameters(originalParameters);\n    this.trace(\"TRANSCEIVER SENDER SET_PARAMETERS\", originalParameters);\n    this.writePeerConnectionTimelineLog(\"transceiver-sender-set-parameters\", originalParameters);\n    return;\n  }\n\n  /**\n   * PeerConnection から RTCStatsReport を取得するためのメソッド\n   */\n  private async getStats(): Promise<RTCStatsReport[]> {\n    const stats: RTCStatsReport[] = [];\n    if (!this.pc) {\n      return stats;\n    }\n    const reports = await this.pc.getStats();\n    reports.forEach((s) => {\n      stats.push(s as RTCStatsReport);\n    });\n    return stats;\n  }\n\n  /**\n   * PeerConnection の ondatachannel callback メソッド\n   *\n   * @param dataChannelEvent - DataChannel イベント\n   */\n  private onDataChannel(dataChannelEvent: RTCDataChannelEvent): void {\n    const dataChannel = dataChannelEvent.channel;\n    this.writeDataChannelTimelineLog(\"ondatachannel\", dataChannel, createDataChannelData(dataChannel));\n    // onbufferedamountlow\n    dataChannelEvent.channel.onbufferedamountlow = (event): void => {\n      const channel = event.currentTarget as RTCDataChannel;\n      this.writeDataChannelTimelineLog(\"onbufferedamountlow\", channel);\n    };\n    // onopen\n    dataChannelEvent.channel.onopen = (event): void => {\n      const channel = event.currentTarget as RTCDataChannel;\n      channel.bufferedAmountLowThreshold = 65536;\n      channel.binaryType = \"arraybuffer\";\n      this.soraDataChannels[channel.label] = channel;\n      this.trace(\"OPEN DATA CHANNEL\", channel.label);\n      if (channel.label === \"signaling\" && this.ws) {\n        this.writeDataChannelSignalingLog(\"onopen\", channel);\n      } else {\n        this.writeDataChannelTimelineLog(\"onopen\", channel);\n      }\n    };\n    // onclose\n    dataChannelEvent.channel.onclose = async (event): Promise<void> => {\n      const channel = event.currentTarget as RTCDataChannel;\n      this.writeDataChannelTimelineLog(\"onclose\", channel);\n      this.trace(\"CLOSE DATA CHANNEL\", channel.label);\n      await this.disconnect();\n    };\n    // onerror\n    dataChannelEvent.channel.onerror = async (event): Promise<void> => {\n      const channel = event.currentTarget as RTCDataChannel;\n      this.writeDataChannelTimelineLog(\"onerror\", channel);\n      this.trace(\"ERROR DATA CHANNEL\", channel.label);\n      await this.abend(\"DATA-CHANNEL-ONERROR\", { params: { label: channel.label } });\n    };\n    // onmessage\n    if (dataChannelEvent.channel.label === \"signaling\") {\n      dataChannelEvent.channel.onmessage = async (event): Promise<void> => {\n        const channel = event.currentTarget as RTCDataChannel;\n        const label = channel.label;\n        const dataChannelSettings = this.signalingOfferMessageDataChannels[label];\n        if (!dataChannelSettings) {\n          console.warn(\n            `Received onmessage event for '${label}' DataChannel. But '${label}' DataChannel settings doesn't exist`\n          );\n          return;\n        }\n        const data = parseDataChannelEventData(event.data, dataChannelSettings.compress);\n        const message = JSON.parse(data) as SignalingMessage;\n        this.writeDataChannelSignalingLog(`onmessage-${message.type}`, channel, message);\n        if (message.type === \"re-offer\") {\n          await this.signalingOnMessageTypeReOffer(message);\n        }\n      };\n    } else if (dataChannelEvent.channel.label === \"notify\") {\n      dataChannelEvent.channel.onmessage = (event): void => {\n        const channel = event.currentTarget as RTCDataChannel;\n        const label = channel.label;\n        const dataChannelSettings = this.signalingOfferMessageDataChannels[label];\n        if (!dataChannelSettings) {\n          console.warn(\n            `Received onmessage event for '${label}' DataChannel. But '${label}' DataChannel settings doesn't exist`\n          );\n          return;\n        }\n        const data = parseDataChannelEventData(event.data, dataChannelSettings.compress);\n        const message = JSON.parse(data) as SignalingNotifyMessage;\n        if (message.event_type === \"connection.created\") {\n          this.writeDataChannelTimelineLog(\"notify-connection.created\", channel, message);\n        } else if (message.event_type === \"connection.destroyed\") {\n          this.writeDataChannelTimelineLog(\"notify-connection.destroyed\", channel, message);\n        }\n        this.signalingOnMessageTypeNotify(message, \"datachannel\");\n      };\n    } else if (dataChannelEvent.channel.label === \"push\") {\n      dataChannelEvent.channel.onmessage = (event): void => {\n        const channel = event.currentTarget as RTCDataChannel;\n        const label = channel.label;\n        const dataChannelSettings = this.signalingOfferMessageDataChannels[label];\n        if (!dataChannelSettings) {\n          console.warn(\n            `Received onmessage event for '${label}' DataChannel. But '${label}' DataChannel settings doesn't exist`\n          );\n          return;\n        }\n        const data = parseDataChannelEventData(event.data, dataChannelSettings.compress);\n        const message = JSON.parse(data) as SignalingPushMessage;\n        this.callbacks.push(message, \"datachannel\");\n      };\n    } else if (dataChannelEvent.channel.label === \"e2ee\") {\n      dataChannelEvent.channel.onmessage = (event): void => {\n        const channel = event.currentTarget as RTCDataChannel;\n        const data = event.data as ArrayBuffer;\n        this.signalingOnMessageE2EE(data);\n        this.writeDataChannelSignalingLog(\"onmessage-e2ee\", channel, data);\n      };\n    } else if (dataChannelEvent.channel.label === \"stats\") {\n      dataChannelEvent.channel.onmessage = async (event): Promise<void> => {\n        const channel = event.currentTarget as RTCDataChannel;\n        const label = channel.label;\n        const dataChannelSettings = this.signalingOfferMessageDataChannels[label];\n        if (!dataChannelSettings) {\n          console.warn(\n            `Received onmessage event for '${label}' DataChannel. But '${label}' DataChannel settings doesn't exist`\n          );\n          return;\n        }\n        const data = parseDataChannelEventData(event.data, dataChannelSettings.compress);\n        const message = JSON.parse(data) as SignalingReqStatsMessage;\n        if (message.type === \"req-stats\") {\n          const stats = await this.getStats();\n          this.sendStatsMessage(stats);\n        }\n      };\n    } else if (/^#.*/.exec(dataChannelEvent.channel.label)) {\n      dataChannelEvent.channel.onmessage = (event): void => {\n        if (event.currentTarget === null) {\n          return;\n        }\n        const channel = event.currentTarget as RTCDataChannel;\n        const label = channel.label;\n        const dataChannelSettings = this.signalingOfferMessageDataChannels[label];\n        if (!dataChannelSettings) {\n          console.warn(\n            `Received onmessage event for '${label}' DataChannel. But '${label}' DataChannel settings doesn't exist`\n          );\n          return;\n        }\n        let data = event.data as ArrayBuffer;\n        if (dataChannelSettings.compress === true) {\n          data = unzlibSync(new Uint8Array(data)).buffer;\n        }\n        this.callbacks.message(createDataChannelMessageEvent(dataChannel.label, data));\n      };\n    }\n  }\n\n  /**\n   * シグナリングサーバーへメッセージを送信するメソッド\n   *\n   * @param message - 送信するメッセージ\n   */\n  private sendSignalingMessage(message: { type: string; [key: string]: unknown }): void {\n    if (this.soraDataChannels.signaling) {\n      if (\n        this.signalingOfferMessageDataChannels.signaling &&\n        this.signalingOfferMessageDataChannels.signaling.compress === true\n      ) {\n        const binaryMessage = new TextEncoder().encode(JSON.stringify(message));\n        const zlibMessage = zlibSync(binaryMessage, {});\n        this.soraDataChannels.signaling.send(zlibMessage);\n      } else {\n        this.soraDataChannels.signaling.send(JSON.stringify(message));\n      }\n      this.writeDataChannelSignalingLog(`send-${message.type}`, this.soraDataChannels.signaling, message);\n    } else if (this.ws !== null) {\n      this.ws.send(JSON.stringify(message));\n      this.writeWebSocketSignalingLog(`send-${message.type}`, message);\n    }\n  }\n\n  /**\n   * シグナリングサーバーに E2E 用メッセージを投げるメソッド\n   *\n   * @param message - 送信するバイナリメッセージ\n   */\n  private sendE2EEMessage(message: ArrayBuffer): void {\n    if (this.soraDataChannels.e2ee) {\n      this.soraDataChannels.e2ee.send(message);\n      this.writeDataChannelSignalingLog(\"send-e2ee\", this.soraDataChannels.e2ee, message);\n    } else if (this.ws !== null) {\n      this.ws.send(message);\n      this.writeWebSocketSignalingLog(\"send-e2ee\", message);\n    }\n  }\n\n  /**\n   * シグナリングサーバーに stats メッセージを投げるメソッド\n   *\n   * @param reports - RTCStatsReport のリスト\n   */\n  private sendStatsMessage(reports: RTCStatsReport[]): void {\n    if (this.soraDataChannels.stats) {\n      const message = {\n        type: \"stats\",\n        reports: reports,\n      };\n      if (\n        this.signalingOfferMessageDataChannels.stats &&\n        this.signalingOfferMessageDataChannels.stats.compress === true\n      ) {\n        const binaryMessage = new TextEncoder().encode(JSON.stringify(message));\n        const zlibMessage = zlibSync(binaryMessage, {});\n        this.soraDataChannels.stats.send(zlibMessage);\n      } else {\n        this.soraDataChannels.stats.send(JSON.stringify(message));\n      }\n    }\n  }\n\n  /**\n   * audio transceiver を取得するメソッド\n   */\n  private getAudioTransceiver(): RTCRtpTransceiver | null {\n    if (this.pc && this.mids.audio) {\n      const transceiver = this.pc.getTransceivers().find((transceiver) => {\n        return transceiver.mid === this.mids.audio;\n      });\n      return transceiver || null;\n    }\n    return null;\n  }\n\n  /**\n   * video transceiver を取得するメソッド\n   */\n  private getVideoTransceiver(): RTCRtpTransceiver | null {\n    if (this.pc && this.mids.video) {\n      const transceiver = this.pc.getTransceivers().find((transceiver) => {\n        return transceiver.mid === this.mids.video;\n      });\n      return transceiver || null;\n    }\n    return null;\n  }\n\n  /**\n   * disconnect callback に渡す Event オブジェクトを生成するためのメソッド\n   *\n   * @param type - Event タイプ(normal | abend)\n   * @param title - Event タイトル\n   * @param initDict - Event に設定するオプションパラメーター\n   */\n  private soraCloseEvent(type: SoraCloseEventType, title: string, initDict?: SoraCloseEventInitDict): SoraCloseEvent {\n    const soraCloseEvent = class SoraCloseEvent extends Event {\n      title: string;\n      code?: number;\n      reason?: string;\n      params?: Record<string, unknown>;\n\n      constructor(type: SoraCloseEventType, title: string, initDict?: SoraCloseEventInitDict) {\n        super(type);\n        if (initDict) {\n          if (initDict.code) {\n            this.code = initDict.code;\n          }\n          if (initDict.reason) {\n            this.reason = initDict.reason;\n          }\n          if (initDict.params) {\n            this.params = initDict.params;\n          }\n        }\n        this.title = title;\n      }\n    };\n    return new soraCloseEvent(type, title, initDict);\n  }\n\n  /**\n   * DataChannel を使用してメッセージを送信するメソッド\n   *\n   * @param label - メッセージを送信する DataChannel のラベル\n   * @param message - Uint8Array\n   */\n  sendMessage(label: string, message: Uint8Array): void {\n    const dataChannel = this.soraDataChannels[label];\n    // 接続していない場合は何もしない\n    if (this.pc === null) {\n      return;\n    }\n    if (dataChannel === undefined) {\n      throw new Error(\"Could not find DataChannel\");\n    }\n    const settings = this.signalingOfferMessageDataChannels[label];\n    if (settings !== undefined && settings.compress === true) {\n      const zlibMessage = zlibSync(message, {});\n      dataChannel.send(zlibMessage);\n    } else {\n      dataChannel.send(message);\n    }\n  }\n\n  /**\n   * E2EE の自分のフィンガープリント\n   */\n  get e2eeSelfFingerprint(): string | undefined {\n    if (this.options.e2ee && this.e2ee) {\n      return this.e2ee.selfFingerprint();\n    }\n    return;\n  }\n\n  /**\n   * E2EE のリモートのフィンガープリントリスト\n   */\n  get e2eeRemoteFingerprints(): Record<string, string> | undefined {\n    if (this.options.e2ee && this.e2ee) {\n      return this.e2ee.remoteFingerprints();\n    }\n    return;\n  }\n\n  /**\n   * audio が有効かどうか\n   */\n  get audio(): boolean {\n    return this.getAudioTransceiver() !== null;\n  }\n\n  /**\n   * video が有効かどうか\n   */\n  get video(): boolean {\n    return this.getVideoTransceiver() !== null;\n  }\n\n  /**\n   * シグナリングに使用する URL\n   *\n   * @deprecated\n   */\n  get signalingUrl(): string | string[] {\n    return this.signalingUrlCandidates;\n  }\n\n  /**\n   * 接続中のシグナリング URL\n   */\n  get connectedSignalingUrl(): string {\n    if (!this.ws) {\n      return \"\";\n    }\n    return this.ws.url;\n  }\n\n  /**\n   * DataChannel メッセージング用の DataChannel 情報のリスト\n   */\n  get datachannels(): DataChannelConfiguration[] {\n    if (!this.signalingSwitched) {\n      return [];\n    }\n    const messagingDataChannellabels = Object.keys(this.signalingOfferMessageDataChannels).filter((label) => {\n      return /^#.*/.exec(label);\n    });\n    const result: DataChannelConfiguration[] = [];\n    for (const label of messagingDataChannellabels) {\n      const dataChannel = this.soraDataChannels[label];\n      if (!dataChannel) {\n        continue;\n      }\n      const settings = this.signalingOfferMessageDataChannels[label];\n      if (!settings) {\n        continue;\n      }\n      const messagingDataChannel: DataChannelConfiguration = {\n        label: dataChannel.label,\n        ordered: dataChannel.ordered,\n        protocol: dataChannel.protocol,\n        compress: settings.compress,\n        direction: settings.direction,\n      };\n      if (typeof dataChannel.maxPacketLifeTime === \"number\") {\n        messagingDataChannel.maxPacketLifeTime = dataChannel.maxPacketLifeTime;\n      }\n      if (typeof dataChannel.maxRetransmits === \"number\") {\n        messagingDataChannel.maxRetransmits = dataChannel.maxRetransmits;\n      }\n      result.push(messagingDataChannel);\n    }\n    return result;\n  }\n}\n","import ConnectionBase from \"./base\";\n\n/**\n * Role が \"sendonly\" または \"sendrecv\" の場合に Sora との WebRTC 接続を扱うクラス\n */\nexport default class ConnectionPublisher extends ConnectionBase {\n  /**\n   * Sora へ接続するメソッド\n   *\n   * @example\n   * ```typescript\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * const mediaStream = await navigator.mediaDevices.getUserMedia({audio: true, video: true});\n   * await sendrecv.connect(mediaStream);\n   * ```\n   *\n   * @param stream - メディアストリーム\n   *\n   * @public\n   */\n  async connect(stream: MediaStream): Promise<MediaStream> {\n    if (this.options.multistream) {\n      await Promise.race([\n        this.multiStream(stream).finally(() => {\n          this.clearConnectionTimeout();\n          this.clearMonitorSignalingWebSocketEvent();\n        }),\n        this.setConnectionTimeout(),\n        this.monitorSignalingWebSocketEvent(),\n      ]);\n    } else {\n      await Promise.race([\n        this.singleStream(stream).finally(() => {\n          this.clearConnectionTimeout();\n          this.clearMonitorSignalingWebSocketEvent();\n        }),\n        this.setConnectionTimeout(),\n        this.monitorSignalingWebSocketEvent(),\n      ]);\n    }\n    this.monitorWebSocketEvent();\n    this.monitorPeerConnectionState();\n    return stream;\n  }\n\n  /**\n   * シングルストリームで Sora へ接続するメソッド\n   *\n   * @param stream - メディアストリーム\n   */\n  private async singleStream(stream: MediaStream): Promise<MediaStream> {\n    await this.disconnect();\n    this.setupE2EE();\n    const ws = await this.getSignalingWebSocket(this.signalingUrlCandidates);\n    const signalingMessage = await this.signaling(ws);\n    this.startE2EE();\n    await this.connectPeerConnection(signalingMessage);\n    await this.setRemoteDescription(signalingMessage);\n    stream.getTracks().forEach((track) => {\n      if (this.pc) {\n        this.pc.addTrack(track, stream);\n      }\n    });\n    this.stream = stream;\n    await this.createAnswer(signalingMessage);\n    this.sendAnswer();\n    if (this.pc && this.e2ee) {\n      this.pc.getSenders().forEach((sender) => {\n        if (this.e2ee) {\n          this.e2ee.setupSenderTransform(sender);\n        }\n      });\n    }\n    await this.onIceCandidate();\n    await this.waitChangeConnectionStateConnected();\n    return stream;\n  }\n\n  /**\n   * マルチストリームで Sora へ接続するメソッド\n   *\n   * @param stream - メディアストリーム\n   */\n  private async multiStream(stream: MediaStream): Promise<MediaStream> {\n    await this.disconnect();\n    this.setupE2EE();\n    const ws = await this.getSignalingWebSocket(this.signalingUrlCandidates);\n    const signalingMessage = await this.signaling(ws);\n    this.startE2EE();\n    await this.connectPeerConnection(signalingMessage);\n    if (this.pc) {\n      this.pc.ontrack = (event): void => {\n        const stream = event.streams[0];\n        if (!stream) {\n          return;\n        }\n        const data = {\n          \"stream.id\": stream.id,\n          id: event.track.id,\n          label: event.track.label,\n          enabled: event.track.enabled,\n          kind: event.track.kind,\n          muted: event.track.muted,\n          readyState: event.track.readyState,\n        };\n        this.writePeerConnectionTimelineLog(\"ontrack\", data);\n        if (stream.id === \"default\") {\n          return;\n        }\n        if (stream.id === this.connectionId) {\n          return;\n        }\n        if (this.e2ee) {\n          this.e2ee.setupReceiverTransform(event.receiver);\n        }\n        this.callbacks.track(event);\n        stream.onremovetrack = (event): void => {\n          this.callbacks.removetrack(event);\n          if (event.target) {\n            // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n            const index = this.remoteConnectionIds.indexOf(event.target.id as string);\n            if (-1 < index) {\n              delete this.remoteConnectionIds[index];\n              // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n              event.stream = event.target;\n              this.callbacks.removestream(event);\n            }\n          }\n        };\n        if (-1 < this.remoteConnectionIds.indexOf(stream.id)) {\n          return;\n        }\n        // @ts-ignore TODO(yuito): 最新ブラウザでは無くなった API だが後方互換のため残す\n        event.stream = stream;\n        this.remoteConnectionIds.push(stream.id);\n        this.callbacks.addstream(event);\n      };\n    }\n    await this.setRemoteDescription(signalingMessage);\n    stream.getTracks().forEach((track) => {\n      if (this.pc) {\n        this.pc.addTrack(track, stream);\n      }\n    });\n    this.stream = stream;\n    await this.createAnswer(signalingMessage);\n    this.sendAnswer();\n    if (this.pc && this.e2ee) {\n      this.pc.getSenders().forEach((sender) => {\n        if (this.e2ee) {\n          this.e2ee.setupSenderTransform(sender);\n        }\n      });\n    }\n    await this.onIceCandidate();\n    await this.waitChangeConnectionStateConnected();\n    return stream;\n  }\n}\n","import ConnectionBase from \"./base\";\n\n/**\n * Role が \"recvonly\" の場合に Sora との WebRTC 接続を扱うクラス\n */\nexport default class ConnectionSubscriber extends ConnectionBase {\n  /**\n   * Sora へ接続するメソッド\n   *\n   * @example\n   * ```typescript\n   * const recvonly = connection.sendrecv(\"sora\");\n   * await recvonly.connect();\n   * ```\n   *\n   * @param stream - メディアストリーム\n   *\n   * @public\n   */\n  async connect(): Promise<MediaStream | void> {\n    if (this.options.multistream) {\n      await Promise.race([\n        this.multiStream().finally(() => {\n          this.clearConnectionTimeout();\n          this.clearMonitorSignalingWebSocketEvent();\n        }),\n        this.setConnectionTimeout(),\n        this.monitorSignalingWebSocketEvent(),\n      ]);\n      this.monitorWebSocketEvent();\n      this.monitorPeerConnectionState();\n      return;\n    } else {\n      const stream = await Promise.race([\n        this.singleStream().finally(() => {\n          this.clearConnectionTimeout();\n          this.clearMonitorSignalingWebSocketEvent();\n        }),\n        this.setConnectionTimeout(),\n        this.monitorSignalingWebSocketEvent(),\n      ]);\n      this.monitorWebSocketEvent();\n      this.monitorPeerConnectionState();\n      return stream;\n    }\n  }\n\n  /**\n   * シングルストリームで Sora へ接続するメソッド\n   *\n   * @param stream - メディアストリーム\n   */\n  private async singleStream(): Promise<MediaStream> {\n    await this.disconnect();\n    this.setupE2EE();\n    const ws = await this.getSignalingWebSocket(this.signalingUrlCandidates);\n    const signalingMessage = await this.signaling(ws);\n    this.startE2EE();\n    await this.connectPeerConnection(signalingMessage);\n    if (this.pc) {\n      this.pc.ontrack = (event): void => {\n        this.stream = event.streams[0];\n        const streamId = this.stream.id;\n        if (streamId === \"default\") {\n          return;\n        }\n        const data = {\n          \"stream.id\": streamId,\n          id: event.track.id,\n          label: event.track.label,\n          enabled: event.track.enabled,\n          kind: event.track.kind,\n          muted: event.track.muted,\n          readyState: event.track.readyState,\n        };\n        this.writePeerConnectionTimelineLog(\"ontrack\", data);\n        if (this.e2ee) {\n          this.e2ee.setupReceiverTransform(event.receiver);\n        }\n        this.callbacks.track(event);\n        this.stream.onremovetrack = (event): void => {\n          this.callbacks.removetrack(event);\n          if (event.target) {\n            // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n            const targetId = event.target.id as string;\n            const index = this.remoteConnectionIds.indexOf(targetId);\n            if (-1 < index) {\n              delete this.remoteConnectionIds[index];\n              // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n              event.stream = event.target;\n              this.callbacks.removestream(event);\n            }\n          }\n        };\n        if (-1 < this.remoteConnectionIds.indexOf(streamId)) {\n          return;\n        }\n        // @ts-ignore TODO(yuito): 最新ブラウザでは無くなった API だが後方互換のため残す\n        event.stream = this.stream;\n        this.remoteConnectionIds.push(streamId);\n        this.callbacks.addstream(event);\n      };\n    }\n    await this.setRemoteDescription(signalingMessage);\n    await this.createAnswer(signalingMessage);\n    this.sendAnswer();\n    await this.onIceCandidate();\n    await this.waitChangeConnectionStateConnected();\n    return this.stream || new MediaStream();\n  }\n\n  /**\n   * マルチストリームで Sora へ接続するメソッド\n   *\n   * @param stream - メディアストリーム\n   */\n  private async multiStream(): Promise<void> {\n    await this.disconnect();\n    this.setupE2EE();\n    const ws = await this.getSignalingWebSocket(this.signalingUrlCandidates);\n    const signalingMessage = await this.signaling(ws);\n    this.startE2EE();\n    await this.connectPeerConnection(signalingMessage);\n    if (this.pc) {\n      this.pc.ontrack = (event): void => {\n        const stream = event.streams[0];\n        if (stream.id === \"default\") {\n          return;\n        }\n        if (stream.id === this.connectionId) {\n          return;\n        }\n        const data = {\n          \"stream.id\": stream.id,\n          id: event.track.id,\n          label: event.track.label,\n          enabled: event.track.enabled,\n          kind: event.track.kind,\n          muted: event.track.muted,\n          readyState: event.track.readyState,\n        };\n        this.writePeerConnectionTimelineLog(\"ontrack\", data);\n        if (this.e2ee) {\n          this.e2ee.setupReceiverTransform(event.receiver);\n        }\n        this.callbacks.track(event);\n        stream.onremovetrack = (event): void => {\n          this.callbacks.removetrack(event);\n          if (event.target) {\n            // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n            const targetId = event.target.id as string;\n            const index = this.remoteConnectionIds.indexOf(targetId);\n            if (-1 < index) {\n              delete this.remoteConnectionIds[index];\n              // @ts-ignore TODO(yuito): 後方互換のため peerConnection.onremovestream と同じ仕様で残す\n              event.stream = event.target;\n              this.callbacks.removestream(event);\n            }\n          }\n        };\n        if (-1 < this.remoteConnectionIds.indexOf(stream.id)) {\n          return;\n        }\n        // @ts-ignore TODO(yuito): 最新ブラウザでは無くなった API だが後方互換のため残す\n        event.stream = stream;\n        this.remoteConnectionIds.push(stream.id);\n        this.callbacks.addstream(event);\n      };\n    }\n    await this.setRemoteDescription(signalingMessage);\n    await this.createAnswer(signalingMessage);\n    this.sendAnswer();\n    await this.onIceCandidate();\n    await this.waitChangeConnectionStateConnected();\n    return;\n  }\n}\n","import SoraE2EE from \"@sora/e2ee\";\n\nimport ConnectionBase from \"./base\";\nimport ConnectionPublisher from \"./publisher\";\nimport ConnectionSubscriber from \"./subscriber\";\nimport { applyMediaStreamConstraints } from \"./helpers\";\nimport type {\n  AudioCodecType,\n  Callbacks,\n  ConnectionOptions,\n  DataChannelConfiguration,\n  DataChannelDirection,\n  DataChannelEvent,\n  DataChannelMessageEvent,\n  JSONType,\n  Role,\n  SignalingEvent,\n  SignalingNotifyConnectionCreated,\n  SignalingNotifyConnectionDestroyed,\n  SignalingNotifyConnectionUpdated,\n  SignalingNotifyMessage,\n  SignalingNotifyMetadata,\n  SignalingNotifyNetworkStatus,\n  SignalingNotifySpotlightChanged,\n  SignalingNotifySpotlightFocused,\n  SignalingNotifySpotlightUnfocused,\n  SignalingPushMessage,\n  Simulcast,\n  SimulcastRid,\n  SoraAbendTitle,\n  SoraCloseEvent,\n  SoraCloseEventInitDict,\n  SoraCloseEventType,\n  SpotlightFocusRid,\n  TimelineEvent,\n  TimelineEventLogType,\n  TransportType,\n  VideoCodecType,\n} from \"./types\";\n\n/**\n * Role 毎の Connection インスタンスを生成するためのクラス\n *\n * @param signalingUrlCandidates - シグナリングに使用する URL の候補\n * @param debug - デバッグフラグ\n */\nclass SoraConnection {\n  /**\n   * シグナリングに使用する URL の候補\n   */\n  signalingUrlCandidates: string | string[];\n  /**\n   * デバッグフラグ\n   */\n  debug: boolean;\n\n  constructor(signalingUrlCandidates: string | string[], debug = false) {\n    this.signalingUrlCandidates = signalingUrlCandidates;\n    this.debug = debug;\n  }\n  /**\n   * role sendrecv で接続するための Connecion インスタンスを生成するメソッド\n   *\n   * @example\n   * ```typescript\n   * const connection = Sora.connection('ws://192.0.2.100:5000/signaling', true);\n   * const sendrecv = connection.sendrecv(\"sora\");\n   * ```\n   *\n   * @param channelId - チャネルID\n   * @param metadata - メタデータ\n   * @param options - コネクションオプション\n   *\n   * @returns\n   * role sendrecv な Connection オブジェクトを返します\n   *\n   * @public\n   */\n  sendrecv(\n    channelId: string,\n    metadata: JSONType = null,\n    options: ConnectionOptions = { audio: true, video: true }\n  ): ConnectionPublisher {\n    // sendrecv の場合、multistream に初期値を指定する\n    const sendrecvOptions: ConnectionOptions = Object.assign({ multistream: true }, options);\n    return new ConnectionPublisher(\n      this.signalingUrlCandidates,\n      \"sendrecv\",\n      channelId,\n      metadata,\n      sendrecvOptions,\n      this.debug\n    );\n  }\n  /**\n   * role sendonly で接続するための Connecion インスタンスを生成するメソッド\n   *\n   * @param channelId - チャネルID\n   * @param metadata - メタデータ\n   * @param options - コネクションオプション\n   *\n   * @example\n   * ```typescript\n   * const connection = Sora.connection('ws://192.0.2.100:5000/signaling', true);\n   * const sendonly = connection.sendonly(\"sora\");\n   * ```\n   *\n   * @returns\n   * role sendonly な Connection オブジェクトを返します\n   *\n   * @public\n   */\n  sendonly(\n    channelId: string,\n    metadata: JSONType = null,\n    options: ConnectionOptions = { audio: true, video: true }\n  ): ConnectionPublisher {\n    return new ConnectionPublisher(this.signalingUrlCandidates, \"sendonly\", channelId, metadata, options, this.debug);\n  }\n  /**\n   * role recvonly で接続するための Connecion インスタンスを生成するメソッド\n   *\n   * @example\n   * ```typescript\n   * const connection = Sora.connection('ws://192.0.2.100:5000/signaling', true);\n   * const recvonly = connection.recvonly(\"sora\");\n   * ```\n   *\n   * @param channelId - チャネルID\n   * @param metadata - メタデータ\n   * @param options - コネクションオプション\n   *\n   * @returns\n   * role recvonly な Connection オブジェクトを返します\n   *\n   * @public\n   */\n  recvonly(\n    channelId: string,\n    metadata: JSONType = null,\n    options: ConnectionOptions = { audio: true, video: true }\n  ): ConnectionSubscriber {\n    return new ConnectionSubscriber(this.signalingUrlCandidates, \"recvonly\", channelId, metadata, options, this.debug);\n  }\n  /**\n   * シグナリングに使用する URL の候補\n   *\n   * @public\n   * @deprecated\n   */\n  get signalingUrl(): string | string[] {\n    return this.signalingUrlCandidates;\n  }\n}\n\n/**\n * Sora JS SDK package\n */\nexport default {\n  /**\n   * E2EE で使用する WASM の読み込みを行うメソッド\n   *\n   * @example\n   * ```typescript\n   * Sora.initE2EE(\"http://192.0.2.100/wasm.wasm\");\n   * ```\n   * @param wasmUrl - E2EE WASM の URL\n   *\n   * @public\n   */\n  initE2EE: async function (wasmUrl: string): Promise<void> {\n    await SoraE2EE.loadWasm(wasmUrl);\n  },\n  /**\n   * SoraConnection インスタンスを生成するメソッド\n   *\n   * @example\n   * ```typescript\n   * const connection = Sora.connection('ws://192.0.2.100:5000/signaling', true);\n   * ```\n   *\n   * @param signalingUrlCandidates - シグナリングに使用する URL 候補\n   * @param debug - デバッグフラグ\n   *\n   * @public\n   *\n   */\n  connection: function (signalingUrlCandidates: string | string[], debug = false): SoraConnection {\n    return new SoraConnection(signalingUrlCandidates, debug);\n  },\n  /**\n   * SDK のバージョンを返すメソッド\n   *\n   * @public\n   */\n  version: function (): string {\n    return \"__SORA_JS_SDK_VERSION__\";\n  },\n  /**\n   * WebRTC のユーティリティ関数群\n   *\n   * @public\n   */\n  helpers: {\n    applyMediaStreamConstraints,\n  },\n};\n\nexport type {\n  AudioCodecType,\n  Callbacks,\n  ConnectionBase,\n  ConnectionOptions,\n  ConnectionPublisher,\n  ConnectionSubscriber,\n  DataChannelConfiguration,\n  DataChannelDirection,\n  DataChannelEvent,\n  DataChannelMessageEvent,\n  JSONType,\n  Role,\n  SignalingEvent,\n  SignalingNotifyConnectionCreated,\n  SignalingNotifyConnectionDestroyed,\n  SignalingNotifyConnectionUpdated,\n  SignalingNotifyMessage,\n  SignalingNotifyMetadata,\n  SignalingNotifyNetworkStatus,\n  SignalingNotifySpotlightChanged,\n  SignalingNotifySpotlightFocused,\n  SignalingNotifySpotlightUnfocused,\n  SignalingPushMessage,\n  Simulcast,\n  SimulcastRid,\n  SoraAbendTitle,\n  SoraCloseEvent,\n  SoraCloseEventInitDict,\n  SoraCloseEventType,\n  SoraConnection,\n  SpotlightFocusRid,\n  TimelineEvent,\n  TimelineEventLogType,\n  TransportType,\n  VideoCodecType,\n};\n","/**\n *  MediaStream の constraints を動的に変更するメソッド.\n *\n * @param mediastream - メディアストリーム\n *\n * @param constraints - メディアストリーム制約\n *\n * @public\n */\nasync function applyMediaStreamConstraints(\n  mediastream: MediaStream,\n  constraints: MediaStreamConstraints\n): Promise<void> {\n  if (constraints.audio && typeof constraints.audio !== \"boolean\") {\n    for (const track of mediastream.getAudioTracks()) {\n      await track.applyConstraints(constraints.audio);\n    }\n  }\n  if (constraints.video && typeof constraints.video !== \"boolean\") {\n    for (const track of mediastream.getVideoTracks()) {\n      await track.applyConstraints(constraints.video);\n    }\n  }\n}\n\nexport { applyMediaStreamConstraints };\n"],"names":["SoraE2EE","constructor","RTCRtpSender","prototype","createEncodedStreams","Error","this","worker","onWorkerDisconnect","startWorker","workerScript","atob","Worker","URL","createObjectURL","Blob","type","onmessage","event","operation","data","clearWorker","postMessage","terminateWorker","terminate","async","preKeyBundle","window","e2ee","init","setupSenderTransform","sender","track","senderStreams","readableStream","readable","writableStream","writable","message","setupReceiverTransform","receiver","receiverStreams","postRemoteSecretKeyMaterials","result","remoteSecretKeyMaterials","postRemoveRemoteDeriveKey","connectionId","postSelfSecretKeyMaterial","selfConnectionId","selfKeyId","selfSecretKeyMaterial","waitingTime","startSession","err","identityKey","signedPreKey","preKeySignature","stopSession","receiveMessage","start","addPreKeyBundle","selfFingerprint","remoteFingerprints","static","wasmUrl","undefined","console","warn","global","self","require","fs","Object","keys","enosys","code","outputBuf","constants","O_WRONLY","O_RDWR","O_CREAT","O_TRUNC","O_APPEND","O_EXCL","writeSync","fd","buf","decoder","decode","nl","lastIndexOf","log","substr","length","write","offset","position","callback","chmod","path","mode","chown","uid","gid","close","fchmod","fchown","fstat","fsync","ftruncate","lchown","link","lstat","mkdir","perm","open","flags","read","buffer","readdir","readlink","rename","from","to","rmdir","stat","symlink","truncate","unlink","utimes","atime","mtime","process","getuid","getgid","geteuid","getegid","getgroups","pid","ppid","umask","cwd","chdir","crypto","nodeCrypto","getRandomValues","b","randomFillSync","performance","now","sec","nsec","hrtime","TextEncoder","TextDecoder","encoder","Go","argv","env","exit","_exitPromise","Promise","resolve","_resolveExitPromise","_pendingEvent","_scheduledTimeouts","Map","_nextCallbackTimeoutID","setInt64","addr","v","mem","setUint32","Math","floor","getInt64","getUint32","getInt32","loadValue","f","getFloat64","isNaN","id","_values","storeValue","nanHead","setFloat64","_ids","get","_idPool","pop","_goRefCounts","set","typeFlag","loadSlice","array","len","Uint8Array","_inst","exports","loadSliceOfValues","a","Array","i","loadString","saddr","DataView","timeOrigin","Date","importObject","go","sp","exited","p","n","msec","getTime","setInt32","setTimeout","_resume","has","clearTimeout","delete","push","Reflect","getsp","deleteProperty","m","args","apply","setUint8","construct","parseInt","str","encode","String","dst","src","Uint8ClampedArray","toCopy","subarray","debug","value","instance","NaN","fill","Infinity","strPtr","ptr","bytes","argc","argvPtrs","forEach","arg","sort","key","run","resume","_makeFuncWrapper","arguments","main","module","versions","electron","error","slice","assign","TMPDIR","tmpdir","WebAssembly","instantiate","readFileSync","then","on","catch","instantiateStreaming","fetch","version","u8","u16","Uint16Array","u32","Uint32Array","fleb","fdeb","clim","freb","eb","r","j","_a","fl","revfl","_b","revfd","rev","x","hMap","cd","mb","s","l","co","le","rvb","sv","r_1","flt","fdt","flm","flrm","fdm","fdrm","max","bits","d","o","bits16","shft","slc","e","ec","ind","msg","nt","captureStackTrace","wbits","wbits16","hTree","t","t2","et","i0","i1","i2","maxSym","tr","mbt","ln","dt","lft","cst","i2_1","i2_2","i2_3","lc","c","cl","cli","cln","cls","w","clen","cf","wfblk","out","pos","dat","wblk","final","syms","lf","df","li","bs","bl","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","lm","ll","dm","dl","flen","ftlen","dtlen","llm","lcts","it","clct","deo","dopt","opt","pre","post","st","lvl","plvl","lst","ceil","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","min","maxd","ml","mmd","md","ti","lin","din","dflt","level","zlibSync","opts","adler","lv","zlh","wbytes","unzlibSync","sl","noBuf","noSt","cbuf","nbuf","bt","lbt","dbt","tbts","hLit","hcLen","tl","ldt","clt","clb","clbmsk","clm","lt","lms","dms","lpos","sym","add","dsym","end","inflt","td","stream","parseDataChannelConfiguration","dataChannelConfiguration","configuration","label","direction","ordered","compress","maxPacketLifeTime","max_packet_life_time","maxRetransmits","max_retransmits","protocol","isSafari","ua","navigator","userAgent","toLocaleLowerCase","indexOf","browser","createSignalingMessage","offerSDP","role","channelId","metadata","options","redirect","sora_client","environment","channel_id","sdp","audio","video","multistream","signaling_notify_metadata","signalingNotifyMetadata","spotlight","spotlight_number","spotlightNumber","spotlightFocusRids","spotlightFocusRid","spotlight_focus_rid","spotlightUnfocusRid","spotlight_unfocus_rid","simulcast","simalcastRids","simulcastRid","simulcast_rid","clientId","client_id","dataChannelSignaling","data_channel_signaling","ignoreDisconnectWebSocket","ignore_disconnect_websocket","audioPropertyKeys","audioOpusParamsPropertyKeys","videoPropertyKeys","copyOptions","hasAudioProperty","some","audioCodecType","audioBitRate","hasAudioOpusParamsProperty","opus_params","channels","audioOpusParamsChannels","clock_rate","audioOpusParamsClockRate","maxplaybackrate","audioOpusParamsMaxplaybackrate","stereo","audioOpusParamsStereo","sprop_stereo","audioOpusParamsSpropStereo","minptime","audioOpusParamsMinptime","ptime","audioOpusParamsPtime","useinbandfec","audioOpusParamsUseinbandfec","usedtx","audioOpusParamsUsedtx","hasVideoProperty","videoCodecType","videoBitRate","getCapabilities","capabilities","headerExtensions","map","h","uri","every","includes","enabledSimulcast","isArray","dataChannels","data_channels","dataChannelConfigurations","parseDataChannelConfigurations","getSignalingNotifyAuthnMetadata","authn_metadata","getPreKeyBundle","pre_key_bundle","ConnectError","createSignalingEvent","eventType","transportType","Event","JSON","parse","stringify","_","createTimelineEvent","logType","dataChannelId","dataChannelLabel","createDataChannelEvent","channel","datachannel","parseDataChannelEventData","eventData","unzlibMessage","ConnectionBase","signalingUrlCandidates","connectionTimeout","timeout","disconnectWaitTimeout","signalingCandidateTimeout","constraints","remoteConnectionIds","ws","pc","encodings","callbacks","disconnect","addstream","removestream","removetrack","notify","timeline","signaling","authMetadata","connectionTimeoutTimerId","monitorSignalingWebSocketEventTimerId","monitorIceConnectionStateChangeTimerId","soraDataChannels","mids","signalingSwitched","signalingOfferMessageDataChannels","kind","stopAudioTrack","getAudioTracks","enabled","stop","removeTrack","getSenders","find","replaceTrack","stopVideoTrack","getVideoTracks","audioTrack","transceiver","getAudioTransceiver","addTrack","videoTrack","getVideoTransceiver","stopStream","getTracks","dataChannel","initializeConnection","title","clearMonitorIceConnectionStateChange","ondatachannel","oniceconnectionstatechange","onicegatheringstatechange","onconnectionstatechange","onclose","writeWebSocketTimelineLog","reason","onerror","currentTarget","writeDataChannelTimelineLog","trace","soraCloseEvent","writeSoraTimelineLog","params","zlibMessage","readyState","send","writeDataChannelSignalingLog","errorMessage","disconnectWebSocket","disconnectPeerConnection","clearConnectionTimeout","timerId","writeWebSocketSignalingLog","disconnectDataChannel","closeDataChannels","reject","disconnectWaitTimeoutId","onClosePromises","res","counter","setInterval","clearInterval","all","finally","connectionState","setupE2EE","abend","startE2EE","signalingUrl","WebSocket","onopen","resolved","testSignalingUrlCandidate","url","selected","any","offer","createOffer","binaryType","signalingTerminate","ArrayBuffer","signalingOnMessageE2EE","signalingOnMessageTypeOffer","signalingOnMessageTypeUpdate","signalingOnMessageTypeReOffer","signalingOnMessageTypePing","event_type","signalingOnMessageTypeNotify","signalingOnMessageTypeSwitched","redirectMessage","signalingOnMessageTypeRedirect","signalingMessage","initResult","config","encodedInsertableStreams","RTCPeerConnection","generateCertificate","certificate","name","namedCurve","certificates","writePeerConnectionTimelineLog","iceConnectionState","iceGatheringState","onDataChannel","sessionDescription","RTCSessionDescription","setRemoteDescription","mid","values","getTransceivers","currentDirection","setSenderParameters","getParameters","createAnswer","setLocalDescription","sendAnswer","localDescription","onIceCandidate","onicecandidate","candidate","toJSON","sendSignalingMessage","waitChangeConnectionStateConnected","monitorSignalingWebSocketEvent","clearMonitorSignalingWebSocketEvent","monitorWebSocketEvent","monitorPeerConnectionState","abendPeerConnectionState","setConnectionTimeout","dump","record","group","groupEnd","info","prefix","toFixed","iceServers","addTransceiver","offerToReceiveAudio","offerToReceiveVideo","messages","sendE2EEMessage","connection_id","dc","sendUpdateAnswer","sendReAnswer","pongMessage","stats","getStats","metadata_list","getSignalingNotifyData","datachannels","getSignalingWebSocket","location","originalParameters","setParameters","dataChannelEvent","bufferedAmount","bufferedAmountLowThreshold","negotiated","reliable","onbufferedamountlow","dataChannelSettings","sendStatsMessage","exec","createDataChannelMessageEvent","reports","initDict","super","sendMessage","settings","e2eeSelfFingerprint","e2eeRemoteFingerprints","connectedSignalingUrl","messagingDataChannellabels","filter","messagingDataChannel","ConnectionPublisher","race","multiStream","singleStream","connectPeerConnection","ontrack","streams","muted","onremovetrack","target","index","ConnectionSubscriber","streamId","targetId","MediaStream","SoraConnection","sendrecv","sendrecvOptions","sendonly","recvonly","initE2EE","loadWasm","connection","helpers","applyMediaStreamConstraints","mediastream","applyConstraints"],"mappings":"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"}